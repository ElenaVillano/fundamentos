<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Sección 6 Intervalos de confianza y remuestreo | EST-46111: Fundamentos de Estadística con Remuestreo</title>
  <meta name="description" content="Curso de Fundamentos de Estadística con Remuestreo, maestría en Ciencia de Datos, ITAM, Otoño 2020." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Sección 6 Intervalos de confianza y remuestreo | EST-46111: Fundamentos de Estadística con Remuestreo" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Curso de Fundamentos de Estadística con Remuestreo, maestría en Ciencia de Datos, ITAM, Otoño 2020." />
  <meta name="github-repo" content="tereom/fundamentos" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Sección 6 Intervalos de confianza y remuestreo | EST-46111: Fundamentos de Estadística con Remuestreo" />
  
  <meta name="twitter:description" content="Curso de Fundamentos de Estadística con Remuestreo, maestría en Ciencia de Datos, ITAM, Otoño 2020." />
  

<meta name="author" content="Teresa Ortiz (001), Alfredo Garbuno (002), Felipe González" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="S-distribucion-muestreo.html"/>
<link rel="next" href="S-max-verosimilitud.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.5.2/htmlwidgets.js"></script>
<script src="libs/plotly-binding-4.9.2.1/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.1.0.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.0.1/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-1.52.2/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-1.52.2/plotly-latest.min.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
<link rel="stylesheet" href="css/toc.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Fundamentos de Estadística con Remuestreo</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Información del curso</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#temario"><i class="fa fa-check"></i>Temario</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#evaluación"><i class="fa fa-check"></i>Evaluación</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="principios-de-visualización.html"><a href="principios-de-visualización.html"><i class="fa fa-check"></i><b>1</b> Principios de visualización</a><ul>
<li class="chapter" data-level="" data-path="principios-de-visualización.html"><a href="principios-de-visualización.html#el-cuarteto-de-ascombe"><i class="fa fa-check"></i>El cuarteto de Ascombe</a></li>
<li class="chapter" data-level="" data-path="principios-de-visualización.html"><a href="principios-de-visualización.html#introducción"><i class="fa fa-check"></i>Introducción</a></li>
<li class="chapter" data-level="" data-path="principios-de-visualización.html"><a href="principios-de-visualización.html#visualización-popular-de-datos"><i class="fa fa-check"></i>Visualización popular de datos</a></li>
<li class="chapter" data-level="" data-path="principios-de-visualización.html"><a href="principios-de-visualización.html#teoría-de-visualización-de-datos"><i class="fa fa-check"></i>Teoría de visualización de datos</a><ul>
<li class="chapter" data-level="" data-path="principios-de-visualización.html"><a href="principios-de-visualización.html#principios-generales-del-diseño-analítico"><i class="fa fa-check"></i>Principios generales del diseño analítico</a></li>
<li class="chapter" data-level="" data-path="principios-de-visualización.html"><a href="principios-de-visualización.html#técnicas-de-visualización"><i class="fa fa-check"></i>Técnicas de visualización</a></li>
<li class="chapter" data-level="" data-path="principios-de-visualización.html"><a href="principios-de-visualización.html#indicadores-de-calidad-gráfica"><i class="fa fa-check"></i>Indicadores de calidad gráfica</a></li>
<li class="chapter" data-level="" data-path="principios-de-visualización.html"><a href="principios-de-visualización.html#factor-de-engaño-y-chartjunk"><i class="fa fa-check"></i>Factor de engaño y Chartjunk</a></li>
<li class="chapter" data-level="" data-path="principios-de-visualización.html"><a href="principios-de-visualización.html#pequeños-múltiplos-y-densidad-gráfica"><i class="fa fa-check"></i>Pequeños múltiplos y densidad gráfica</a></li>
<li class="chapter" data-level="" data-path="principios-de-visualización.html"><a href="principios-de-visualización.html#tinta-de-datos"><i class="fa fa-check"></i>Tinta de datos</a></li>
<li class="chapter" data-level="" data-path="principios-de-visualización.html"><a href="principios-de-visualización.html#decoración"><i class="fa fa-check"></i>Decoración</a></li>
<li class="chapter" data-level="" data-path="principios-de-visualización.html"><a href="principios-de-visualización.html#percepción-de-escala"><i class="fa fa-check"></i>Percepción de escala</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="principios-de-visualización.html"><a href="principios-de-visualización.html#ejemplo-gráfica-de-minard"><i class="fa fa-check"></i>Ejemplo: gráfica de Minard</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="análisis-exploratorio.html"><a href="análisis-exploratorio.html"><i class="fa fa-check"></i><b>2</b> Análisis exploratorio</a><ul>
<li class="chapter" data-level="" data-path="análisis-exploratorio.html"><a href="análisis-exploratorio.html#el-papel-de-la-exploración-en-el-análisis-de-datos"><i class="fa fa-check"></i>El papel de la exploración en el análisis de datos</a></li>
<li class="chapter" data-level="" data-path="análisis-exploratorio.html"><a href="análisis-exploratorio.html#algunos-conceptos-básicos"><i class="fa fa-check"></i>Algunos conceptos básicos</a><ul>
<li class="chapter" data-level="" data-path="análisis-exploratorio.html"><a href="análisis-exploratorio.html#media-y-desviación-estándar"><i class="fa fa-check"></i>Media y desviación estándar</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="análisis-exploratorio.html"><a href="análisis-exploratorio.html#ejemplos"><i class="fa fa-check"></i>Ejemplos</a><ul>
<li class="chapter" data-level="" data-path="análisis-exploratorio.html"><a href="análisis-exploratorio.html#precios-de-casas"><i class="fa fa-check"></i>Precios de casas</a></li>
<li class="chapter" data-level="" data-path="análisis-exploratorio.html"><a href="análisis-exploratorio.html#prueba-enlace"><i class="fa fa-check"></i>Prueba Enlace</a></li>
<li class="chapter" data-level="" data-path="análisis-exploratorio.html"><a href="análisis-exploratorio.html#estados-y-calificaciones-en-sat"><i class="fa fa-check"></i>Estados y calificaciones en SAT</a></li>
<li class="chapter" data-level="" data-path="análisis-exploratorio.html"><a href="análisis-exploratorio.html#tablas-de-conteos"><i class="fa fa-check"></i>Tablas de conteos</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="análisis-exploratorio.html"><a href="análisis-exploratorio.html#loess"><i class="fa fa-check"></i>Loess</a><ul>
<li class="chapter" data-level="" data-path="análisis-exploratorio.html"><a href="análisis-exploratorio.html#ajustando-curvas-loess"><i class="fa fa-check"></i>Ajustando curvas loess</a></li>
<li class="chapter" data-level="" data-path="análisis-exploratorio.html"><a href="análisis-exploratorio.html#series-de-tiempo"><i class="fa fa-check"></i>Series de tiempo</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="tipos-de-estudio-y-experimentos.html"><a href="tipos-de-estudio-y-experimentos.html"><i class="fa fa-check"></i><b>3</b> Tipos de estudio y experimentos</a><ul>
<li class="chapter" data-level="" data-path="tipos-de-estudio-y-experimentos.html"><a href="tipos-de-estudio-y-experimentos.html#motivación"><i class="fa fa-check"></i>Motivación</a></li>
<li class="chapter" data-level="" data-path="tipos-de-estudio-y-experimentos.html"><a href="tipos-de-estudio-y-experimentos.html#proceso-generador-de-datos"><i class="fa fa-check"></i>Proceso Generador de Datos</a></li>
<li class="chapter" data-level="" data-path="tipos-de-estudio-y-experimentos.html"><a href="tipos-de-estudio-y-experimentos.html#ejemplo-prevalencia-de-anemia"><i class="fa fa-check"></i>Ejemplo: Prevalencia de anemia</a></li>
<li class="chapter" data-level="" data-path="tipos-de-estudio-y-experimentos.html"><a href="tipos-de-estudio-y-experimentos.html#muestreo-aleatorio"><i class="fa fa-check"></i>Muestreo aleatorio</a></li>
<li class="chapter" data-level="" data-path="tipos-de-estudio-y-experimentos.html"><a href="tipos-de-estudio-y-experimentos.html#pero-si-no-podemos-hacer-muestreo-aleatorio"><i class="fa fa-check"></i>Pero si no podemos hacer muestreo aleatorio?</a><ul>
<li class="chapter" data-level="" data-path="tipos-de-estudio-y-experimentos.html"><a href="tipos-de-estudio-y-experimentos.html#ejemplo-policías-y-tráfico"><i class="fa fa-check"></i>Ejemplo: Policías y tráfico</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tipos-de-estudio-y-experimentos.html"><a href="tipos-de-estudio-y-experimentos.html#el-estimador-estándar"><i class="fa fa-check"></i>El estimador estándar</a></li>
<li class="chapter" data-level="" data-path="tipos-de-estudio-y-experimentos.html"><a href="tipos-de-estudio-y-experimentos.html#experimentos-tradicionales"><i class="fa fa-check"></i>Experimentos tradicionales</a></li>
<li class="chapter" data-level="" data-path="tipos-de-estudio-y-experimentos.html"><a href="tipos-de-estudio-y-experimentos.html#bloqueo"><i class="fa fa-check"></i>Bloqueo</a></li>
<li class="chapter" data-level="" data-path="tipos-de-estudio-y-experimentos.html"><a href="tipos-de-estudio-y-experimentos.html#variables-desconocidas"><i class="fa fa-check"></i>Variables desconocidas</a></li>
<li class="chapter" data-level="" data-path="tipos-de-estudio-y-experimentos.html"><a href="tipos-de-estudio-y-experimentos.html#aleatorizando-el-tratamiento"><i class="fa fa-check"></i>Aleatorizando el tratamiento</a></li>
<li class="chapter" data-level="" data-path="tipos-de-estudio-y-experimentos.html"><a href="tipos-de-estudio-y-experimentos.html#resumen-selección-de-unidades-y-tratamiento"><i class="fa fa-check"></i>Resumen: selección de unidades y tratamiento</a></li>
<li class="chapter" data-level="" data-path="tipos-de-estudio-y-experimentos.html"><a href="tipos-de-estudio-y-experimentos.html#asignación-natural-del-tratamiento"><i class="fa fa-check"></i>Asignación natural del tratamiento</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="pruebas-de-hipótesis.html"><a href="pruebas-de-hipótesis.html"><i class="fa fa-check"></i><b>4</b> Pruebas de hipótesis</a><ul>
<li class="chapter" data-level="" data-path="pruebas-de-hipótesis.html"><a href="pruebas-de-hipótesis.html#comparación-con-poblaciones-de-referencia"><i class="fa fa-check"></i>Comparación con poblaciones de referencia</a><ul>
<li class="chapter" data-level="" data-path="pruebas-de-hipótesis.html"><a href="pruebas-de-hipótesis.html#ejemplo"><i class="fa fa-check"></i>Ejemplo</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="pruebas-de-hipótesis.html"><a href="pruebas-de-hipótesis.html#comparando-distribuciones"><i class="fa fa-check"></i>Comparando distribuciones</a></li>
<li><a href="pruebas-de-hipótesis.html#prueba-de-permutaciones-y-el-lineup">Prueba de permutaciones y el <em>lineup</em></a></li>
<li><a href="pruebas-de-hipótesis.html#comparaciones-usando-lineup-continuación">Comparaciones usando <em>lineup</em> (continuación)</a></li>
<li class="chapter" data-level="" data-path="pruebas-de-hipótesis.html"><a href="pruebas-de-hipótesis.html#prueba-de-permutaciones-para-proporciones"><i class="fa fa-check"></i>Prueba de permutaciones para proporciones</a></li>
<li class="chapter" data-level="" data-path="pruebas-de-hipótesis.html"><a href="pruebas-de-hipótesis.html#pruebas-de-hipótesis-tradicionales"><i class="fa fa-check"></i>Pruebas de hipótesis tradicionales</a></li>
<li class="chapter" data-level="" data-path="pruebas-de-hipótesis.html"><a href="pruebas-de-hipótesis.html#tomadores-de-té-continuación"><i class="fa fa-check"></i>Tomadores de té (continuación)</a></li>
<li class="chapter" data-level="" data-path="pruebas-de-hipótesis.html"><a href="pruebas-de-hipótesis.html#pruebas-de-permutación-implementación"><i class="fa fa-check"></i>Pruebas de permutación: Implementación</a></li>
<li class="chapter" data-level="" data-path="pruebas-de-hipótesis.html"><a href="pruebas-de-hipótesis.html#ejemplo-tiempos-de-fusión"><i class="fa fa-check"></i>Ejemplo: tiempos de fusión</a></li>
<li class="chapter" data-level="" data-path="pruebas-de-hipótesis.html"><a href="pruebas-de-hipótesis.html#ejemplo-tiempos-de-fusión-continuación"><i class="fa fa-check"></i>Ejemplo: tiempos de fusión (continuación)</a></li>
<li class="chapter" data-level="" data-path="pruebas-de-hipótesis.html"><a href="pruebas-de-hipótesis.html#separación-de-grupos"><i class="fa fa-check"></i>Separación de grupos</a><ul>
<li class="chapter" data-level="" data-path="pruebas-de-hipótesis.html"><a href="pruebas-de-hipótesis.html#avispas-opcional"><i class="fa fa-check"></i>Avispas (opcional)</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="pruebas-de-hipótesis.html"><a href="pruebas-de-hipótesis.html#la-crisis-de-replicabilidad"><i class="fa fa-check"></i>La “crisis de replicabilidad”</a></li>
<li class="chapter" data-level="" data-path="pruebas-de-hipótesis.html"><a href="pruebas-de-hipótesis.html#el-jardín-de-los-senderos-que-se-bifurcan"><i class="fa fa-check"></i>El jardín de los senderos que se bifurcan</a></li>
<li><a href="pruebas-de-hipótesis.html#ejemplo-decisiones-de-análisis-y-valores-p">Ejemplo: decisiones de análisis y valores <em>p</em></a></li>
<li class="chapter" data-level="" data-path="pruebas-de-hipótesis.html"><a href="pruebas-de-hipótesis.html#alternativas-o-soluciones"><i class="fa fa-check"></i>Alternativas o soluciones</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="S-distribucion-muestreo.html"><a href="S-distribucion-muestreo.html"><i class="fa fa-check"></i><b>5</b> Estimación y distribución de muestreo</a><ul>
<li class="chapter" data-level="" data-path="S-distribucion-muestreo.html"><a href="S-distribucion-muestreo.html#ejemplo-precios-de-casas"><i class="fa fa-check"></i>Ejemplo: precios de casas</a></li>
<li class="chapter" data-level="" data-path="S-distribucion-muestreo.html"><a href="S-distribucion-muestreo.html#distribución-de-muestreo"><i class="fa fa-check"></i>Distribución de muestreo</a></li>
<li class="chapter" data-level="" data-path="S-distribucion-muestreo.html"><a href="S-distribucion-muestreo.html#más-ejemplos"><i class="fa fa-check"></i>Más ejemplos</a></li>
<li class="chapter" data-level="" data-path="S-distribucion-muestreo.html"><a href="S-distribucion-muestreo.html#el-error-estándar"><i class="fa fa-check"></i>El error estándar</a><ul>
<li class="chapter" data-level="" data-path="S-distribucion-muestreo.html"><a href="S-distribucion-muestreo.html#ejemplo-valor-de-casas"><i class="fa fa-check"></i>Ejemplo: valor de casas</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="S-distribucion-muestreo.html"><a href="S-distribucion-muestreo.html#calculando-la-distribución-de-muestreo"><i class="fa fa-check"></i>Calculando la distribución de muestreo</a><ul>
<li class="chapter" data-level="" data-path="S-distribucion-muestreo.html"><a href="S-distribucion-muestreo.html#ejemplo-1"><i class="fa fa-check"></i>Ejemplo</a></li>
<li class="chapter" data-level="" data-path="S-distribucion-muestreo.html"><a href="S-distribucion-muestreo.html#ejemplo-2"><i class="fa fa-check"></i>Ejemplo</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="S-distribucion-muestreo.html"><a href="S-distribucion-muestreo.html#teorema-central-del-límite"><i class="fa fa-check"></i>Teorema central del límite</a></li>
<li class="chapter" data-level="" data-path="S-distribucion-muestreo.html"><a href="S-distribucion-muestreo.html#normalidad-y-gráficas-de-cuantiles-normales"><i class="fa fa-check"></i>Normalidad y gráficas de cuantiles normales</a></li>
<li class="chapter" data-level="" data-path="S-distribucion-muestreo.html"><a href="S-distribucion-muestreo.html#prueba-de-hipótesis-de-normalidad"><i class="fa fa-check"></i>Prueba de hipótesis de normalidad</a><ul>
<li class="chapter" data-level="" data-path="S-distribucion-muestreo.html"><a href="S-distribucion-muestreo.html#ejemplo-3"><i class="fa fa-check"></i>Ejemplo</a></li>
<li class="chapter" data-level="" data-path="S-distribucion-muestreo.html"><a href="S-distribucion-muestreo.html#ejemplo-4"><i class="fa fa-check"></i>Ejemplo</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="S-distribucion-muestreo.html"><a href="S-distribucion-muestreo.html#ejemplo-5"><i class="fa fa-check"></i>Ejemplo</a></li>
<li class="chapter" data-level="" data-path="S-distribucion-muestreo.html"><a href="S-distribucion-muestreo.html#más-del-teorema-central-del-límite"><i class="fa fa-check"></i>Más del Teorema central del límite</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="intervalos-de-confianza-y-remuestreo.html"><a href="intervalos-de-confianza-y-remuestreo.html"><i class="fa fa-check"></i><b>6</b> Intervalos de confianza y remuestreo</a><ul>
<li class="chapter" data-level="" data-path="intervalos-de-confianza-y-remuestreo.html"><a href="intervalos-de-confianza-y-remuestreo.html#ejemplo-introductorio"><i class="fa fa-check"></i>Ejemplo introductorio</a></li>
<li class="chapter" data-level="" data-path="intervalos-de-confianza-y-remuestreo.html"><a href="intervalos-de-confianza-y-remuestreo.html#la-idea-del-bootstrap"><i class="fa fa-check"></i>La idea del bootstrap</a></li>
<li class="chapter" data-level="" data-path="intervalos-de-confianza-y-remuestreo.html"><a href="intervalos-de-confianza-y-remuestreo.html#el-principio-de-plug-in"><i class="fa fa-check"></i>El principio de plug-in</a><ul>
<li class="chapter" data-level="" data-path="intervalos-de-confianza-y-remuestreo.html"><a href="intervalos-de-confianza-y-remuestreo.html#ejemplo-6"><i class="fa fa-check"></i>Ejemplo</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="intervalos-de-confianza-y-remuestreo.html"><a href="intervalos-de-confianza-y-remuestreo.html#discusión-propiedades-de-la-distribución-bootstrap"><i class="fa fa-check"></i>Discusión: propiedades de la distribución bootstrap</a><ul>
<li class="chapter" data-level="" data-path="intervalos-de-confianza-y-remuestreo.html"><a href="intervalos-de-confianza-y-remuestreo.html#ejemplo-7"><i class="fa fa-check"></i>Ejemplo</a></li>
<li class="chapter" data-level="" data-path="intervalos-de-confianza-y-remuestreo.html"><a href="intervalos-de-confianza-y-remuestreo.html#variación-en-distribuciones-bootstrap"><i class="fa fa-check"></i>Variación en distribuciones bootstrap</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="intervalos-de-confianza-y-remuestreo.html"><a href="intervalos-de-confianza-y-remuestreo.html#error-estándar-bootstrap-e-intervalos-normales"><i class="fa fa-check"></i>Error estándar bootstrap e intervalos normales</a><ul>
<li class="chapter" data-level="" data-path="intervalos-de-confianza-y-remuestreo.html"><a href="intervalos-de-confianza-y-remuestreo.html#ejemplo-tomadores-de-té-negro"><i class="fa fa-check"></i>Ejemplo: tomadores de té negro</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="intervalos-de-confianza-y-remuestreo.html"><a href="intervalos-de-confianza-y-remuestreo.html#ejemplo-inventario-de-casas-vendidas"><i class="fa fa-check"></i>Ejemplo: inventario de casas vendidas</a></li>
<li class="chapter" data-level="" data-path="intervalos-de-confianza-y-remuestreo.html"><a href="intervalos-de-confianza-y-remuestreo.html#calibración-de-intervalos-de-confianza"><i class="fa fa-check"></i>Calibración de intervalos de confianza</a></li>
<li class="chapter" data-level="" data-path="intervalos-de-confianza-y-remuestreo.html"><a href="intervalos-de-confianza-y-remuestreo.html#interpretación-de-intervalos-de-confianza"><i class="fa fa-check"></i>Interpretación de intervalos de confianza</a></li>
<li class="chapter" data-level="" data-path="intervalos-de-confianza-y-remuestreo.html"><a href="intervalos-de-confianza-y-remuestreo.html#intervalos-bootstrap-de-percentiles"><i class="fa fa-check"></i>Intervalos bootstrap de percentiles</a><ul>
<li class="chapter" data-level="" data-path="intervalos-de-confianza-y-remuestreo.html"><a href="intervalos-de-confianza-y-remuestreo.html#ejemplo-8"><i class="fa fa-check"></i>Ejemplo</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="intervalos-de-confianza-y-remuestreo.html"><a href="intervalos-de-confianza-y-remuestreo.html#bootstrap-para-dos-muestras"><i class="fa fa-check"></i>Bootstrap para dos muestras</a><ul>
<li class="chapter" data-level="" data-path="intervalos-de-confianza-y-remuestreo.html"><a href="intervalos-de-confianza-y-remuestreo.html#ejemplo-9"><i class="fa fa-check"></i>Ejemplo</a></li>
<li class="chapter" data-level="" data-path="intervalos-de-confianza-y-remuestreo.html"><a href="intervalos-de-confianza-y-remuestreo.html#datos-pareados"><i class="fa fa-check"></i>Datos pareados</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="intervalos-de-confianza-y-remuestreo.html"><a href="intervalos-de-confianza-y-remuestreo.html#bootstrap-y-otras-estadísticas"><i class="fa fa-check"></i>Bootstrap y otras estadísticas</a><ul>
<li class="chapter" data-level="" data-path="intervalos-de-confianza-y-remuestreo.html"><a href="intervalos-de-confianza-y-remuestreo.html#ejemplo-estimadores-de-razón"><i class="fa fa-check"></i>Ejemplo: estimadores de razón</a></li>
<li class="chapter" data-level="" data-path="intervalos-de-confianza-y-remuestreo.html"><a href="intervalos-de-confianza-y-remuestreo.html#ejemplo-suavizadores"><i class="fa fa-check"></i>Ejemplo: suavizadores</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="intervalos-de-confianza-y-remuestreo.html"><a href="intervalos-de-confianza-y-remuestreo.html#bootstrap-y-estimadores-complejos-tablas-de-perfiles"><i class="fa fa-check"></i>Bootstrap y estimadores complejos: tablas de perfiles</a></li>
<li class="chapter" data-level="" data-path="intervalos-de-confianza-y-remuestreo.html"><a href="intervalos-de-confianza-y-remuestreo.html#bootstrap-y-muestras-complejas"><i class="fa fa-check"></i>Bootstrap y muestras complejas</a></li>
<li class="chapter" data-level="" data-path="intervalos-de-confianza-y-remuestreo.html"><a href="intervalos-de-confianza-y-remuestreo.html#conclusiones-y-observaciones"><i class="fa fa-check"></i>Conclusiones y observaciones</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="S-max-verosimilitud.html"><a href="S-max-verosimilitud.html"><i class="fa fa-check"></i><b>7</b> Estimación por máxima verosimilitud</a><ul>
<li class="chapter" data-level="" data-path="S-max-verosimilitud.html"><a href="S-max-verosimilitud.html#introducción-a-estimación-por-máxima-verosimilitud"><i class="fa fa-check"></i>Introducción a estimación por máxima verosimilitud</a></li>
<li class="chapter" data-level="" data-path="S-max-verosimilitud.html"><a href="S-max-verosimilitud.html#máxima-verosimilitud-para-observaciones-continuas"><i class="fa fa-check"></i>Máxima verosimilitud para observaciones continuas</a></li>
<li class="chapter" data-level="" data-path="S-max-verosimilitud.html"><a href="S-max-verosimilitud.html#aspectos-numéricos"><i class="fa fa-check"></i>Aspectos numéricos</a><ul>
<li class="chapter" data-level="" data-path="S-max-verosimilitud.html"><a href="S-max-verosimilitud.html#el-método-de-momentos"><i class="fa fa-check"></i>El método de momentos</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="S-max-verosimilitud.html"><a href="S-max-verosimilitud.html#máxima-verosimilitud-para-más-de-un-parámetro"><i class="fa fa-check"></i>Máxima verosimilitud para más de un parámetro</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="bootstrap-paramétrico.html"><a href="bootstrap-paramétrico.html"><i class="fa fa-check"></i><b>8</b> <em>Bootstrap</em> paramétrico</a><ul>
<li><a href="bootstrap-paramétrico.html#ventajas-y-desventajas-de-bootstrap-paramétrico">Ventajas y desventajas de <em>bootstrap</em> paramétrico</a></li>
<li class="chapter" data-level="" data-path="bootstrap-paramétrico.html"><a href="bootstrap-paramétrico.html#verificando-los-supuestos-distribucionales"><i class="fa fa-check"></i>Verificando los supuestos distribucionales</a></li>
<li class="chapter" data-level="" data-path="bootstrap-paramétrico.html"><a href="bootstrap-paramétrico.html#modelos-mal-identificados"><i class="fa fa-check"></i>Modelos mal identificados</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="propiedades-teóricas-de-mle.html"><a href="propiedades-teóricas-de-mle.html"><i class="fa fa-check"></i><b>9</b> Propiedades teóricas de MLE</a><ul>
<li class="chapter" data-level="" data-path="propiedades-teóricas-de-mle.html"><a href="propiedades-teóricas-de-mle.html#ejemplo-10"><i class="fa fa-check"></i>Ejemplo</a></li>
<li class="chapter" data-level="" data-path="propiedades-teóricas-de-mle.html"><a href="propiedades-teóricas-de-mle.html#consistencia"><i class="fa fa-check"></i>Consistencia</a><ul>
<li class="chapter" data-level="" data-path="propiedades-teóricas-de-mle.html"><a href="propiedades-teóricas-de-mle.html#ejemplo-11"><i class="fa fa-check"></i>Ejemplo</a></li>
</ul></li>
<li><a href="propiedades-teóricas-de-mle.html#equivarianza-del-textsfmle">Equivarianza del <span class="math inline">\(\textsf{MLE}\)</span></a><ul>
<li class="chapter" data-level="" data-path="propiedades-teóricas-de-mle.html"><a href="propiedades-teóricas-de-mle.html#ejemplo-12"><i class="fa fa-check"></i>Ejemplo</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="propiedades-teóricas-de-mle.html"><a href="propiedades-teóricas-de-mle.html#normalidad-asintótica"><i class="fa fa-check"></i>Normalidad asintótica</a><ul>
<li class="chapter" data-level="" data-path="propiedades-teóricas-de-mle.html"><a href="propiedades-teóricas-de-mle.html#ejemplo-13"><i class="fa fa-check"></i>Ejemplo</a></li>
<li class="chapter" data-level="" data-path="propiedades-teóricas-de-mle.html"><a href="propiedades-teóricas-de-mle.html#el-método-delta"><i class="fa fa-check"></i>El método delta</a></li>
</ul></li>
<li><a href="propiedades-teóricas-de-mle.html#optimalidad-del-textsfmle">Optimalidad del <span class="math inline">\(\textsf{MLE}\)</span></a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="más-de-pruebas-de-hipótesis-e-intervalos.html"><a href="más-de-pruebas-de-hipótesis-e-intervalos.html"><i class="fa fa-check"></i><b>10</b> Más de pruebas de hipótesis e intervalos</a><ul>
<li class="chapter" data-level="" data-path="más-de-pruebas-de-hipótesis-e-intervalos.html"><a href="más-de-pruebas-de-hipótesis-e-intervalos.html#prueba-de-wald"><i class="fa fa-check"></i>Prueba de Wald</a></li>
<li><a href="más-de-pruebas-de-hipótesis-e-intervalos.html#observación-pruebas-t-y-práctica-estadística">Observación: pruebas <span class="math inline">\(t\)</span> y práctica estadística</a></li>
<li class="chapter" data-level="" data-path="más-de-pruebas-de-hipótesis-e-intervalos.html"><a href="más-de-pruebas-de-hipótesis-e-intervalos.html#prueba-de-wald-para-dos-medias-o-proporciones"><i class="fa fa-check"></i>Prueba de Wald para dos medias o proporciones</a></li>
<li class="chapter" data-level="" data-path="más-de-pruebas-de-hipótesis-e-intervalos.html"><a href="más-de-pruebas-de-hipótesis-e-intervalos.html#datos-pareados-1"><i class="fa fa-check"></i>Datos pareados</a></li>
<li class="chapter" data-level="" data-path="más-de-pruebas-de-hipótesis-e-intervalos.html"><a href="más-de-pruebas-de-hipótesis-e-intervalos.html#pruebas-de-cociente-de-verosimilitud"><i class="fa fa-check"></i>Pruebas de cociente de verosimilitud</a><ul>
<li class="chapter" data-level="" data-path="más-de-pruebas-de-hipótesis-e-intervalos.html"><a href="más-de-pruebas-de-hipótesis-e-intervalos.html#distribución-de-referencia-para-pruebas-de-cocientes"><i class="fa fa-check"></i>Distribución de referencia para pruebas de cocientes</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="más-de-pruebas-de-hipótesis-e-intervalos.html"><a href="más-de-pruebas-de-hipótesis-e-intervalos.html#otro-tipo-de-pruebas"><i class="fa fa-check"></i>Otro tipo de pruebas</a></li>
<li class="chapter" data-level="" data-path="más-de-pruebas-de-hipótesis-e-intervalos.html"><a href="más-de-pruebas-de-hipótesis-e-intervalos.html#errores-tipo-i-y-tipo-ii"><i class="fa fa-check"></i>Errores tipo I y tipo II</a></li>
<li class="chapter" data-level="" data-path="más-de-pruebas-de-hipótesis-e-intervalos.html"><a href="más-de-pruebas-de-hipótesis-e-intervalos.html#consideraciones-prácticas"><i class="fa fa-check"></i>Consideraciones prácticas</a></li>
<li class="chapter" data-level="" data-path="más-de-pruebas-de-hipótesis-e-intervalos.html"><a href="más-de-pruebas-de-hipótesis-e-intervalos.html#pruebas-múltiples"><i class="fa fa-check"></i>Pruebas múltiples</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="introducción-a-inferencia-bayesiana-1.html"><a href="introducción-a-inferencia-bayesiana-1.html"><i class="fa fa-check"></i><b>11</b> Introducción a inferencia bayesiana</a><ul>
<li class="chapter" data-level="" data-path="introducción-a-inferencia-bayesiana-1.html"><a href="introducción-a-inferencia-bayesiana-1.html#un-primer-ejemplo-completo-de-inferencia-bayesiana"><i class="fa fa-check"></i>Un primer ejemplo completo de inferencia bayesiana</a></li>
<li class="chapter" data-level="" data-path="introducción-a-inferencia-bayesiana-1.html"><a href="introducción-a-inferencia-bayesiana-1.html#ejemplo-estimando-una-proporción"><i class="fa fa-check"></i>Ejemplo: estimando una proporción</a></li>
<li class="chapter" data-level="" data-path="introducción-a-inferencia-bayesiana-1.html"><a href="introducción-a-inferencia-bayesiana-1.html#ejemplo-observaciones-uniformes"><i class="fa fa-check"></i>Ejemplo: observaciones uniformes</a></li>
<li class="chapter" data-level="" data-path="introducción-a-inferencia-bayesiana-1.html"><a href="introducción-a-inferencia-bayesiana-1.html#probabilidad-a-priori"><i class="fa fa-check"></i>Probabilidad a priori</a></li>
<li class="chapter" data-level="" data-path="introducción-a-inferencia-bayesiana-1.html"><a href="introducción-a-inferencia-bayesiana-1.html#análisis-conjugado"><i class="fa fa-check"></i>Análisis conjugado</a><ul>
<li class="chapter" data-level="" data-path="introducción-a-inferencia-bayesiana-1.html"><a href="introducción-a-inferencia-bayesiana-1.html#ejemplo-14"><i class="fa fa-check"></i>Ejemplo</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="introducción-a-inferencia-bayesiana-1.html"><a href="introducción-a-inferencia-bayesiana-1.html#pasos-de-un-análisis-de-datos-bayesiano"><i class="fa fa-check"></i>Pasos de un análisis de datos bayesiano</a></li>
<li class="chapter" data-level="" data-path="introducción-a-inferencia-bayesiana-1.html"><a href="introducción-a-inferencia-bayesiana-1.html#verificación-predictiva-posterior"><i class="fa fa-check"></i>Verificación predictiva posterior</a><ul>
<li class="chapter" data-level="" data-path="introducción-a-inferencia-bayesiana-1.html"><a href="introducción-a-inferencia-bayesiana-1.html#ejemplo-estaturas-de-tenores"><i class="fa fa-check"></i>Ejemplo: estaturas de tenores</a></li>
<li class="chapter" data-level="" data-path="introducción-a-inferencia-bayesiana-1.html"><a href="introducción-a-inferencia-bayesiana-1.html#ejemplo-modelo-poisson"><i class="fa fa-check"></i>Ejemplo: modelo Poisson</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="introducción-a-inferencia-bayesiana-1.html"><a href="introducción-a-inferencia-bayesiana-1.html#predicción"><i class="fa fa-check"></i>Predicción</a><ul>
<li class="chapter" data-level="" data-path="introducción-a-inferencia-bayesiana-1.html"><a href="introducción-a-inferencia-bayesiana-1.html#ejemplo-cantantes"><i class="fa fa-check"></i>Ejemplo: cantantes</a></li>
<li class="chapter" data-level="" data-path="introducción-a-inferencia-bayesiana-1.html"><a href="introducción-a-inferencia-bayesiana-1.html#ejemplo-posterior-predictiva-de-pareto-uniforme."><i class="fa fa-check"></i>Ejemplo: posterior predictiva de Pareto-Uniforme.</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="calibración-bayesiana-y-regularización.html"><a href="calibración-bayesiana-y-regularización.html"><i class="fa fa-check"></i><b>12</b> Calibración bayesiana y Regularización</a><ul>
<li class="chapter" data-level="" data-path="calibración-bayesiana-y-regularización.html"><a href="calibración-bayesiana-y-regularización.html#enfoque-bayesiano-y-frecuentista"><i class="fa fa-check"></i>Enfoque bayesiano y frecuentista</a></li>
<li class="chapter" data-level="" data-path="calibración-bayesiana-y-regularización.html"><a href="calibración-bayesiana-y-regularización.html#ejemplo-estimación-de-una-proporción"><i class="fa fa-check"></i>Ejemplo: estimación de una proporción</a></li>
<li class="chapter" data-level="" data-path="calibración-bayesiana-y-regularización.html"><a href="calibración-bayesiana-y-regularización.html#intervalos-de-agresti-coull"><i class="fa fa-check"></i>Intervalos de Agresti-Coull</a></li>
<li class="chapter" data-level="" data-path="calibración-bayesiana-y-regularización.html"><a href="calibración-bayesiana-y-regularización.html#incorporando-información-inicial"><i class="fa fa-check"></i>Incorporando información inicial</a><ul>
<li class="chapter" data-level="" data-path="calibración-bayesiana-y-regularización.html"><a href="calibración-bayesiana-y-regularización.html#ejemplo-porporción-de-hogares-de-ingresos-grandes"><i class="fa fa-check"></i>Ejemplo: porporción de hogares de ingresos grandes</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="calibración-bayesiana-y-regularización.html"><a href="calibración-bayesiana-y-regularización.html#inferencia-bayesiana-y-regularización"><i class="fa fa-check"></i>Inferencia bayesiana y regularización</a></li>
<li class="chapter" data-level="" data-path="calibración-bayesiana-y-regularización.html"><a href="calibración-bayesiana-y-regularización.html#ejemplo-modelo-normal-y-estaturas"><i class="fa fa-check"></i>Ejemplo: modelo normal y estaturas</a></li>
<li class="chapter" data-level="" data-path="calibración-bayesiana-y-regularización.html"><a href="calibración-bayesiana-y-regularización.html#ejemplo-estimación-de-proporciones"><i class="fa fa-check"></i>Ejemplo: estimación de proporciones</a></li>
<li class="chapter" data-level="" data-path="calibración-bayesiana-y-regularización.html"><a href="calibración-bayesiana-y-regularización.html#teoría-de-decisión"><i class="fa fa-check"></i>Teoría de decisión</a><ul>
<li class="chapter" data-level="" data-path="calibración-bayesiana-y-regularización.html"><a href="calibración-bayesiana-y-regularización.html#ejemplo-riesgo-frecuentista"><i class="fa fa-check"></i>Ejemplo: riesgo frecuentista</a></li>
<li class="chapter" data-level="" data-path="calibración-bayesiana-y-regularización.html"><a href="calibración-bayesiana-y-regularización.html#ejemplo-riesgo-posterior"><i class="fa fa-check"></i>Ejemplo: riesgo posterior</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="calibración-bayesiana-y-regularización.html"><a href="calibración-bayesiana-y-regularización.html#riesgo-de-bayes"><i class="fa fa-check"></i>Riesgo de Bayes</a><ul>
<li class="chapter" data-level="" data-path="calibración-bayesiana-y-regularización.html"><a href="calibración-bayesiana-y-regularización.html#ejemplo-15"><i class="fa fa-check"></i>Ejemplo</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="tareas.html"><a href="tareas.html"><i class="fa fa-check"></i>Tareas</a><ul>
<li class="chapter" data-level="" data-path="tareas.html"><a href="tareas.html#anáslisis-exploratorio"><i class="fa fa-check"></i>1. Anáslisis Exploratorio</a></li>
<li class="chapter" data-level="" data-path="tareas.html"><a href="tareas.html#loess-1"><i class="fa fa-check"></i>2. Loess</a><ul>
<li class="chapter" data-level="" data-path="tareas.html"><a href="tareas.html#solución-series-de-tiempo"><i class="fa fa-check"></i>Solución: Series de tiempo</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tareas.html"><a href="tareas.html#tipos-de-estudio-y-pgd"><i class="fa fa-check"></i>3. Tipos de estudio y PGD</a></li>
<li class="chapter" data-level="" data-path="tareas.html"><a href="tareas.html#pruebas-de-hipótesis-visuales-y-permutación"><i class="fa fa-check"></i>4. Pruebas de hipótesis visuales y permutación</a><ul>
<li class="chapter" data-level="" data-path="tareas.html"><a href="tareas.html#solución-pruebas-pareadas"><i class="fa fa-check"></i>Solución: Pruebas pareadas</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tareas.html"><a href="tareas.html#distribución-muestral-y-remuestreo"><i class="fa fa-check"></i>5. Distribución muestral y remuestreo</a></li>
<li class="chapter" data-level="" data-path="tareas.html"><a href="tareas.html#tcl-e-introducción-a-bootstrap"><i class="fa fa-check"></i>6. TCL e introducción a bootstrap</a><ul>
<li class="chapter" data-level="" data-path="tareas.html"><a href="tareas.html#solución-y-discusión-de-media"><i class="fa fa-check"></i>Solución y discusión de media</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tareas.html"><a href="tareas.html#bootstrap-en-el-conteo-rápido"><i class="fa fa-check"></i>7. Bootstrap en el conteo rápido</a></li>
<li class="chapter" data-level="" data-path="tareas.html"><a href="tareas.html#bootstrap-en-muestras-complejas"><i class="fa fa-check"></i>8. Bootstrap en muestras complejas</a><ul>
<li class="chapter" data-level="" data-path="tareas.html"><a href="tareas.html#solución"><i class="fa fa-check"></i>Solución</a></li>
<li class="chapter" data-level="" data-path="tareas.html"><a href="tareas.html#mapas"><i class="fa fa-check"></i>Mapas</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tareas.html"><a href="tareas.html#examen-parcial"><i class="fa fa-check"></i>Examen Parcial</a></li>
<li class="chapter" data-level="" data-path="tareas.html"><a href="tareas.html#más-pruebas-de-hipótesis"><i class="fa fa-check"></i>10. Más pruebas de hipótesis</a></li>
<li class="chapter" data-level="" data-path="tareas.html"><a href="tareas.html#introducción-modelo-beta-binomial"><i class="fa fa-check"></i>11. Introducción: modelo Beta-Binomial</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="referencias.html"><a href="referencias.html"><i class="fa fa-check"></i>Referencias</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Publicado con bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">EST-46111: Fundamentos de Estadística con Remuestreo</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="intervalos-de-confianza-y-remuestreo" class="section level1">
<h1><span class="header-section-number">Sección 6</span> Intervalos de confianza y remuestreo</h1>
<p>En la sección anterior, vimos el concepto de distribución de muestreo
de una estadística que queremos utilizar para estimar un valor poblacional, y
vimos que con esta distribución podíamos evaluar <strong>qué tan preciso es nuestro
estimador</strong> evaluando qué tan concentrada está esta distribución alrededor
del valor poblacion que queremos estimar.</p>
<p>Sin embargo, en los ejemplos que vimos la población era conocida: ya sea que
tuviéramos toda la población finita disponible (como el ejemplo de las casas), o
donde la población estaba definida por un modelo teórico de probabilidad (como
los ejemplos de las distribuciones uniforme o exponencial).</p>
<p>Ahora vemos qué hacer en el caso que realmente nos interesa: solo tenemos una
muestra disponible, y la población es desconocida. Todo lo que tenemos es una
muestra y una estimación basada en la muestra, y requerimos estimar la
distribución de muestreo de la estadística de interés. El enfoque que
presentaremos aquí es uno de los más flexibles y poderosos que están disponibles
para este problema: el método <strong>bootstrap</strong> o de <strong>remuestreo</strong>.</p>
<p>En primer lugar explicamos el concepto de intervalo de confianza, que es una
manera resumida de evaluar la precisión de nuestras estimaciones.</p>
<div id="ejemplo-introductorio" class="section level2 unnumbered">
<h2>Ejemplo introductorio</h2>
<p>Regresamos a nuestro ejemplo anterior donde muestreamos 3 grupos, y nos preguntábamos
acerca de la diferencia de sus medianas. En lugar de hacer pruebas de permutaciones
(ya sea pruebas gráficas o alguna prueba de permutaciones para media o mediana, por ejemplo),
podríamos considerar qué tan precisa es cada una de nuestras estimaciones
para las medianas de los grupos.</p>
<p>Nuestros resultados podríamos presentarlos como sigue. Este código lo explicaremos
más adelante, por el momento consideramos la gŕafica resultante:</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="intervalos-de-confianza-y-remuestreo.html#cb143-1"></a><span class="kw">set.seed</span>(<span class="dv">8</span>)</span>
<span id="cb143-2"><a href="intervalos-de-confianza-y-remuestreo.html#cb143-2"></a>pob_tab &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">id =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">2000</span>, <span class="dt">x =</span> <span class="kw">rgamma</span>(<span class="dv">2000</span>, <span class="dv">4</span>, <span class="dv">1</span>), </span>
<span id="cb143-3"><a href="intervalos-de-confianza-y-remuestreo.html#cb143-3"></a>    <span class="dt">grupo =</span> <span class="kw">sample</span>(<span class="kw">c</span>(<span class="st">&quot;a&quot;</span>,<span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>), <span class="dv">2000</span>, <span class="dt">prob =</span> <span class="kw">c</span>(<span class="dv">4</span>,<span class="dv">2</span>,<span class="dv">1</span>), <span class="dt">replace =</span> T))</span>
<span id="cb143-4"><a href="intervalos-de-confianza-y-remuestreo.html#cb143-4"></a>muestra_tab &lt;-<span class="st"> </span>pob_tab <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb143-5"><a href="intervalos-de-confianza-y-remuestreo.html#cb143-5"></a><span class="st">  </span><span class="kw">sample_n</span>(<span class="dv">125</span>)</span>
<span id="cb143-6"><a href="intervalos-de-confianza-y-remuestreo.html#cb143-6"></a>g_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw">ggplot</span>(muestra_tab, <span class="kw">aes</span>(<span class="dt">x =</span> grupo, <span class="dt">y =</span> x)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb143-7"><a href="intervalos-de-confianza-y-remuestreo.html#cb143-7"></a><span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="dt">outlier.alpha =</span> <span class="dv">0</span>) <span class="op">+</span></span>
<span id="cb143-8"><a href="intervalos-de-confianza-y-remuestreo.html#cb143-8"></a><span class="st">  </span><span class="kw">geom_jitter</span>(<span class="dt">alpha =</span> <span class="fl">0.3</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb143-9"><a href="intervalos-de-confianza-y-remuestreo.html#cb143-9"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;Muestra </span><span class="ch">\n</span><span class="st">&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylim</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">14</span>))</span>
<span id="cb143-10"><a href="intervalos-de-confianza-y-remuestreo.html#cb143-10"></a><span class="co">## Hacemos bootstrap</span></span>
<span id="cb143-11"><a href="intervalos-de-confianza-y-remuestreo.html#cb143-11"></a>fun_boot &lt;-<span class="st"> </span><span class="cf">function</span>(datos){</span>
<span id="cb143-12"><a href="intervalos-de-confianza-y-remuestreo.html#cb143-12"></a>    datos <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(grupo) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">sample_n</span>(<span class="kw">n</span>(), <span class="dt">replace =</span> <span class="ot">TRUE</span>)</span>
<span id="cb143-13"><a href="intervalos-de-confianza-y-remuestreo.html#cb143-13"></a>}</span>
<span id="cb143-14"><a href="intervalos-de-confianza-y-remuestreo.html#cb143-14"></a>reps_boot &lt;-<span class="st"> </span><span class="kw">map_df</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">2000</span>, <span class="cf">function</span>(i){</span>
<span id="cb143-15"><a href="intervalos-de-confianza-y-remuestreo.html#cb143-15"></a>  muestra_tab <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb143-16"><a href="intervalos-de-confianza-y-remuestreo.html#cb143-16"></a><span class="st">    </span>fun_boot <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb143-17"><a href="intervalos-de-confianza-y-remuestreo.html#cb143-17"></a><span class="st">    </span><span class="kw">group_by</span>(grupo) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb143-18"><a href="intervalos-de-confianza-y-remuestreo.html#cb143-18"></a><span class="st">    </span><span class="kw">summarise</span>(<span class="dt">mediana =</span> <span class="kw">median</span>(x), <span class="dt">.groups =</span> <span class="st">&quot;drop&quot;</span>)}, </span>
<span id="cb143-19"><a href="intervalos-de-confianza-y-remuestreo.html#cb143-19"></a>  <span class="dt">.id =</span> <span class="st">&#39;rep&#39;</span>) </span>
<span id="cb143-20"><a href="intervalos-de-confianza-y-remuestreo.html#cb143-20"></a>resumen_boot &lt;-<span class="st"> </span>reps_boot <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(grupo) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb143-21"><a href="intervalos-de-confianza-y-remuestreo.html#cb143-21"></a><span class="st">    </span><span class="kw">summarise</span>(<span class="dt">ymin =</span> <span class="kw">quantile</span>(mediana, <span class="fl">0.025</span>), </span>
<span id="cb143-22"><a href="intervalos-de-confianza-y-remuestreo.html#cb143-22"></a>              <span class="dt">ymax =</span> <span class="kw">quantile</span>(mediana, <span class="fl">0.975</span>), <span class="dt">.groups =</span> <span class="st">&quot;drop&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb143-23"><a href="intervalos-de-confianza-y-remuestreo.html#cb143-23"></a><span class="st">    </span><span class="kw">left_join</span>(muestra_tab <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb143-24"><a href="intervalos-de-confianza-y-remuestreo.html#cb143-24"></a><span class="st">                </span><span class="kw">group_by</span>(grupo) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb143-25"><a href="intervalos-de-confianza-y-remuestreo.html#cb143-25"></a><span class="st">                </span><span class="kw">summarise</span>(<span class="dt">mediana =</span> <span class="kw">median</span>(x)), <span class="dt">.groups =</span> <span class="st">&quot;drop&quot;</span>)</span>
<span id="cb143-26"><a href="intervalos-de-confianza-y-remuestreo.html#cb143-26"></a>g_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">ggplot</span>(resumen_boot, <span class="kw">aes</span>(<span class="dt">x =</span> grupo, <span class="dt">y =</span> mediana, <span class="dt">ymin =</span> ymin, </span>
<span id="cb143-27"><a href="intervalos-de-confianza-y-remuestreo.html#cb143-27"></a>                                <span class="dt">ymax =</span> ymax)) <span class="op">+</span></span>
<span id="cb143-28"><a href="intervalos-de-confianza-y-remuestreo.html#cb143-28"></a><span class="st">    </span><span class="kw">geom_linerange</span>() <span class="op">+</span></span>
<span id="cb143-29"><a href="intervalos-de-confianza-y-remuestreo.html#cb143-29"></a><span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">colour =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">size =</span> <span class="dv">2</span>) <span class="op">+</span><span class="st">  </span><span class="kw">ylim</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">14</span>)) <span class="op">+</span></span>
<span id="cb143-30"><a href="intervalos-de-confianza-y-remuestreo.html#cb143-30"></a><span class="st">    </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;Intervalos de 95% </span><span class="ch">\n</span><span class="st"> para la mediana&quot;</span>)</span>
<span id="cb143-31"><a href="intervalos-de-confianza-y-remuestreo.html#cb143-31"></a>g_<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>g_<span class="dv">2</span></span></code></pre></div>
<p><img src="06-remuestreo_files/figure-html/unnamed-chunk-1-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Donde:</p>
<ul>
<li>En rojo está nuestro estimador puntual de la mediana de cada
grupo (la mediana muestral), y</li>
<li>Las segmentos muestran un intervalo de confianza del 95%
para nuestra estimación de la mediana: esto quiere decir que
los valores poblacionales tienen probabilidad aproximada de 95% de estar
dentro del intervalo.</li>
</ul>
<p>Este análisis comunica correctamente que tenemos <strong>incertidumbre</strong> alta acerca
de nuestras estimaciones (especialmente grupos b y c), y que no tenemos mucha
evidencia de que el grupo b tenga una mediana poblacional considerablemente más
alta que a o c. <strong>En muchos casos es más útil presentar la información de esta
manera que usando alguna prueba de hipótesis.</strong></p>
</div>
<div id="la-idea-del-bootstrap" class="section level2 unnumbered">
<h2>La idea del bootstrap</h2>
<p>Como explicamos, el problema que tenemos ahora es que normalmente sólo tenemos
una muestra, así que no es posible calcular las distribuciones de muestreo como
hicimos arriba y evaluar qué tan preciso es nuestro estimador. Sin embargo,
podemos hacer lo siguiente:</p>
<p>Supongamos que tenemos una muestra <span class="math inline">\(X_1,X_2,\dots, X_n\)</span> independientes de alguna
población desconocida y un estimador <span class="math inline">\(T=t(X_1,\dots, X_n)\)</span></p>
<p><strong>Mundo poblacional</strong></p>
<ol style="list-style-type: decimal">
<li>Si tuviéramos la distribución poblacional, simulamos muestras iid para
aproximar la distribución de muestreo de nuestro estimador, y así entender su
variabilidad.</li>
<li>Pero <strong>no</strong> tenemos la distribución poblacional.</li>
<li><strong>Sin embargo, podemos estimar la distribución poblacional con nuestros valores muestrales</strong>.</li>
</ol>
<p><strong>Mundo bootstrap</strong></p>
<ol start="4" style="list-style-type: decimal">
<li>Si usamos la estimación del inciso 3, entonces usando el inciso 1 podríamos
tomar muestras de nuestros datos muestrales, como si fueran de la población, y
usando el mismo tamaño de muestra. El muestreo lo hacemos con reemplazo de
manera que produzcamos muestras independientes de la misma “población estimada”,
que es la muestra.</li>
<li>Evaluamos nuestra estadística en cada una de estas remuestras.</li>
<li>A la distribución resultante le llamamos <strong>distribución bootstrap</strong> o
<strong>distribución de remuestreo</strong> del estimador.</li>
<li>Usamos la distribución bootstrap de la muestra para estimar la variabilidad
en nuestra estimación con <strong>la muestra original</strong>.</li>
</ol>
<p>Veamos que sucede para un ejemplo concreto, donde nos interesa estimar
la media de los precios de venta de una población de casas. Tenemos nuestra muestra:</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="intervalos-de-confianza-y-remuestreo.html#cb144-1"></a><span class="kw">set.seed</span>(<span class="dv">2112</span>)</span>
<span id="cb144-2"><a href="intervalos-de-confianza-y-remuestreo.html#cb144-2"></a>poblacion_casas &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/casas.csv&quot;</span>)</span>
<span id="cb144-3"><a href="intervalos-de-confianza-y-remuestreo.html#cb144-3"></a>casas_muestra &lt;-<span class="st"> </span><span class="kw">sample_n</span>(poblacion_casas, <span class="dv">200</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)</span>
<span id="cb144-4"><a href="intervalos-de-confianza-y-remuestreo.html#cb144-4"></a><span class="kw">mean</span>(casas_muestra<span class="op">$</span>precio_miles)</span></code></pre></div>
<pre><code>## [1] 182.5114</code></pre>
<p>Esta muestra nos da nuestro estimador de la distribución poblacional:</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="intervalos-de-confianza-y-remuestreo.html#cb146-1"></a><span class="kw">bind_rows</span>(casas_muestra <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">tipo =</span> <span class="st">&quot;muestra&quot;</span>),</span>
<span id="cb146-2"><a href="intervalos-de-confianza-y-remuestreo.html#cb146-2"></a>    poblacion_casas <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">tipo =</span> <span class="st">&quot;población&quot;)) %&gt;% </span></span>
<span id="cb146-3"><a href="intervalos-de-confianza-y-remuestreo.html#cb146-3"></a><span class="st">ggplot(aes(sample = precio_miles, colour = tipo, group = tipo)) + </span></span>
<span id="cb146-4"><a href="intervalos-de-confianza-y-remuestreo.html#cb146-4"></a><span class="st">    geom_qq(distribution = stats::qunif, alpha = 0.4, size = 1) +</span></span>
<span id="cb146-5"><a href="intervalos-de-confianza-y-remuestreo.html#cb146-5"></a><span class="st">  facet_wrap(~ tipo)</span></span></code></pre></div>
<p><img src="06-remuestreo_files/figure-html/unnamed-chunk-3-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>O con histogramas:</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="intervalos-de-confianza-y-remuestreo.html#cb147-1"></a><span class="kw">bind_rows</span>(casas_muestra <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">tipo =</span> <span class="st">&quot;muestra&quot;</span>),</span>
<span id="cb147-2"><a href="intervalos-de-confianza-y-remuestreo.html#cb147-2"></a>    poblacion_casas <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">tipo =</span> <span class="st">&quot;población&quot;)) %&gt;% </span></span>
<span id="cb147-3"><a href="intervalos-de-confianza-y-remuestreo.html#cb147-3"></a><span class="st">ggplot(aes(x = precio_miles, group = tipo)) + </span></span>
<span id="cb147-4"><a href="intervalos-de-confianza-y-remuestreo.html#cb147-4"></a><span class="st">    geom_histogram(aes(y=..density..), binwidth = 50) + </span></span>
<span id="cb147-5"><a href="intervalos-de-confianza-y-remuestreo.html#cb147-5"></a><span class="st">    facet_wrap(~ tipo)</span></span></code></pre></div>
<p><img src="06-remuestreo_files/figure-html/unnamed-chunk-4-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>Y vemos que la aproximación es razonable en las partes centrales de la
distribución.</p>
<p>Ahora supongamos que nos interesa cuantificar la precisión de nuestra
estimación de la media poblacional de precios de casas, y usaremos la media
muestral para hacer esto. Para nuestra muestra, nuestra estimación puntual es:</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="intervalos-de-confianza-y-remuestreo.html#cb148-1"></a>media &lt;-<span class="st"> </span><span class="kw">mean</span>(casas_muestra<span class="op">$</span>precio_miles)</span>
<span id="cb148-2"><a href="intervalos-de-confianza-y-remuestreo.html#cb148-2"></a>media</span></code></pre></div>
<pre><code>## [1] 182.5114</code></pre>
<p>Y recordamos que para aproximar la distribución de muestreo
podíamos muestrear repetidamente la población y calcular el valor del
estimador en cada una de estas muestras. Aquí no tenemos la población,
<strong>pero tenemos una estimación de la población</strong>: la muestra obtenida.</p>
<p>Así que para evaluar la variabilidad de nuestro estimador, entramos en el mundo
boostrap, y consideramos que la población es nuestra muestra.</p>
<p>Podemos entonces extraer un número grande de muestras con reemplazo de tamaño
200 <strong>de la muestra</strong>: el muestreo debe ser análogo al que se tomó para nuestra
muestra original. Evaluamos nuestra estadística (en este caso la media) en cada
una de estas remuestras:</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="intervalos-de-confianza-y-remuestreo.html#cb150-1"></a>media_muestras &lt;-<span class="st"> </span><span class="kw">map_dbl</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">5000</span>, <span class="op">~</span><span class="st"> </span>casas_muestra <span class="op">%&gt;%</span><span class="st">  </span></span>
<span id="cb150-2"><a href="intervalos-de-confianza-y-remuestreo.html#cb150-2"></a><span class="st">    </span><span class="kw">sample_n</span>(<span class="dv">200</span>, <span class="dt">replace =</span> T) <span class="op">%&gt;%</span></span>
<span id="cb150-3"><a href="intervalos-de-confianza-y-remuestreo.html#cb150-3"></a><span class="st">    </span><span class="kw">summarise</span>(<span class="dt">media_precio =</span> <span class="kw">mean</span>(precio_miles), <span class="dt">.groups =</span> <span class="st">&quot;drop&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">pull</span>(media_precio)) </span></code></pre></div>
<p>Y nuestra estimación de la distribución de muestreo para la media es entonces:</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="intervalos-de-confianza-y-remuestreo.html#cb151-1"></a>bootstrap &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">media =</span> media_muestras)</span>
<span id="cb151-2"><a href="intervalos-de-confianza-y-remuestreo.html#cb151-2"></a>g_cuantiles &lt;-<span class="st"> </span><span class="kw">ggplot</span>(bootstrap, <span class="kw">aes</span>(<span class="dt">sample =</span> media)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_qq</span>(<span class="dt">distribution =</span> stats<span class="op">::</span>qunif)</span>
<span id="cb151-3"><a href="intervalos-de-confianza-y-remuestreo.html#cb151-3"></a>g_histograma &lt;-<span class="st"> </span><span class="kw">ggplot</span>(bootstrap, <span class="kw">aes</span>(<span class="dt">x =</span> media)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="dv">2</span>)</span>
<span id="cb151-4"><a href="intervalos-de-confianza-y-remuestreo.html#cb151-4"></a>g_cuantiles <span class="op">+</span><span class="st"> </span>g_histograma</span></code></pre></div>
<p><img src="06-remuestreo_files/figure-html/unnamed-chunk-7-1.png" width="576" style="display: block; margin: auto;" />
A esta le llamamos la distribución de remuestreo de la media, que definimos más
abajo. Ahora podemos calcular un intervalo de confianza del 90% simplemente
calculando los cuantiles de esta distribución (no son los cuantiles de la
muestra original!):</p>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="intervalos-de-confianza-y-remuestreo.html#cb152-1"></a>limites_ic &lt;-<span class="st"> </span><span class="kw">quantile</span>(media_muestras, <span class="kw">c</span>(<span class="fl">0.05</span>,  <span class="fl">0.95</span>)) <span class="op">%&gt;%</span><span class="st"> </span>round</span>
<span id="cb152-2"><a href="intervalos-de-confianza-y-remuestreo.html#cb152-2"></a>limites_ic</span></code></pre></div>
<pre><code>##  5% 95% 
## 174 192</code></pre>
<p>Presentaríamos nuestro resultado como sigue: nuestra estimación puntual de la
mediana es 182.5, con un intervalo de
confianza del 90% de (174, 192)</p>
<p>Otra cosa que podríamos hacer para describir la dispersión de nuestro estimador
es calcular el error estándar de remuestreo, que estima el error estándar de la
distribución de muestreo:</p>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="intervalos-de-confianza-y-remuestreo.html#cb154-1"></a>ee_boot &lt;-<span class="st"> </span><span class="kw">sd</span>(media_muestras)</span>
<span id="cb154-2"><a href="intervalos-de-confianza-y-remuestreo.html#cb154-2"></a><span class="kw">round</span>(ee_boot, <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] 5.45</code></pre>

<div class="mathblock">
<p><strong>Definición.</strong> Sea <span class="math inline">\(X_1,X_2,\ldots,X_n\)</span> una muestra independiente y idénticamente
distribuida, y <span class="math inline">\(T=t(X_1, X_2, \ldots, X_n)\)</span> una estadística. Supongamos que sus valores
que obervamos son <span class="math inline">\(x_1, x_2,\ldots, x_n\)</span>.</p>
<p>La <strong>distribución de remuestreo</strong> de <span class="math inline">\(T\)</span> es la
distribución de <span class="math inline">\(T^*=t(X_1^*, X_2^*, \dots X_n^*)\)</span>, donde cada <span class="math inline">\(X_i^*\)</span> se obtiene
tomando al azar uno de los valores de <span class="math inline">\(x_1,x_2,\ldots, x_n\)</span>.</p>
</div>

<ul>
<li>Otra manera de decir esto es que la remuestra <span class="math inline">\(X_1^*, X_2^*, \ldots, X_n^*\)</span> es una muestra
con reemplazo de los valores observados <span class="math inline">\(x_1, x_2, \ldots, x_n\)</span></li>
</ul>
<p><strong>Ejemplo.</strong> Si observamos la muestra</p>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="intervalos-de-confianza-y-remuestreo.html#cb156-1"></a>muestra &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">20</span>, <span class="dv">5</span>)</span>
<span id="cb156-2"><a href="intervalos-de-confianza-y-remuestreo.html#cb156-2"></a>muestra</span></code></pre></div>
<pre><code>## [1] 16  7 19  9  6</code></pre>
<p>Una remuestra se obtiene:</p>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb158-1"><a href="intervalos-de-confianza-y-remuestreo.html#cb158-1"></a><span class="kw">sample</span>(muestra, <span class="dt">size =</span> <span class="dv">5</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] 19  6 16 16  6</code></pre>
<p>Nótese que algunos valores de la muestra original pueden aparecer varias veces, y otros no aparecen del todo.</p>

<div class="comentario">
<strong>La idea del bootstrap</strong>. La muestra original es una aproximación de la población
de donde fue extraída. Así que remuestrear la muestra aproxima lo que pasaría si
tomáramos muestras de la población. La <strong>distribución de remuestreo</strong> de una estadística,
que se construye tomando muchas remuestras, aproxima la distribución de muestreo
de la estadística.
</div>

<p>Y el proceso que hacemos es:</p>

<div class="comentario">
<p><strong>Remuestreo para una población.</strong> Dada una muestra de tamaño <span class="math inline">\(n\)</span> de una población,</p>
<ol style="list-style-type: decimal">
<li>Obtenemos una remuestra de tamaño <span class="math inline">\(n\)</span> con reemplazo de la muestra original</li>
<li>Repetimos este remuestreo muchas veces (por ejemplo, 10,000).</li>
<li>Construímos la distribución bootstrap, y examinamos sus características
(dónde está centrada, dispersión y forma).</li>
</ol>
</div>

</div>
<div id="el-principio-de-plug-in" class="section level2 unnumbered">
<h2>El principio de plug-in</h2>
<p>La idea básica detrás del bootstrap es el principio de plug-in para estimar
parámetros poblacionales: si queremos estimar una cantidad poblacional,
calculamos esa cantidad poblacional con la muestra obtenida. Es un principio
común en estadística.</p>
<p>Por ejemplo, si queremos estimar la media o desviación estándar poblacional,
usamos la media muestral o la desviación estándar muestral. Si queremos estimar
un cuantil de la población usamos el cuantil correspondiente de la muestra, y
así sucesivamente.</p>
<p>En todos estos casos, lo que estamos haciendo es:</p>
<ul>
<li>Tenemos una fórmula para la cantidad poblacional de interés en términos de la
distribución poblacional.<br />
</li>
<li>Tenemos una muestra, que usamos para estimar la cantidad poblacional. La
distribución que da una muestra se llama distribución <em>empírica</em>.</li>
<li>Contruimos nuestro estimador “enchufando” la distribución empírica de la
muestra en la fórmula del estimador.</li>
</ul>
<p>En el bootstrap aplicamos este principio simple a la <strong>distribución de
muestreo</strong>:</p>
<ul>
<li><em>Si tenemos la población</em>, podemos <em>calcular</em> la distribución de muestreo de
nuestro estimador tomando muchas muestras de la <em>población</em>.</li>
<li>Estimamos la <em>poblacion</em> con la <em>muestra</em> y enchufamos en la frase anterior:</li>
<li>Podemos <em>estimar</em> la distribucion de muestreo de nuestro estimador
tomando muchas muestras de la <em>muestra</em> (bootstrap).</li>
</ul>
<p>Nótese que el proceso de muestreo en el último paso <strong>debe ser el mismo</strong> que
se usó para tomar la muestra original. Estas dos imágenes simuladas con base en
un ejemplo de <span class="citation">Chihara and Hesterberg (<a href="#ref-Chihara" role="doc-biblioref">2018</a>)</span> muestran lo que acabamos de describir:</p>
<div class="figure" style="text-align: center"><span id="fig:mundo-real"></span>
<img src="06-remuestreo_files/figure-html/mundo-real-1.png" alt="Mundo Real" width="672" />
<p class="caption">
Figure 6.1: Mundo Real
</p>
</div>
<div class="figure" style="text-align: center"><span id="fig:mundo-bootstrap"></span>
<img src="06-remuestreo_files/figure-html/mundo-bootstrap-1.png" alt="Mundo Bootstrap" width="672" />
<p class="caption">
Figure 6.2: Mundo Bootstrap
</p>
</div>
<p><strong>Observación 1</strong>. Veremos ejemplos más complejos, pero nótese que si la muestra
original son observaciones independientes obtenidas de la distribución poblacional,
entonces logramos esto en las remuestras tomando observaciones con reemplazo
de la muestra. Igualmente, las remuestras deben ser del mismo tamaño que la muestra
original.</p>

<div class="ejercicio">
<ul>
<li>¿Porqué no funcionaría tomar muestras sin reemplazo? Piensa si hay independencia
entre las observaciones de la remuestra, y cómo serían las remuestras sin reemplazo.</li>
<li>¿Por qué no se puede hacer bootstrap si no conocemos cómo se obtuvo la muestra original?
</div></li>
</ul>
<p><strong>Observación 2</strong>. Estos argumentos se pueden escribir con fórmulas usando por
ejemplo la función de distribución acumulada <span class="math inline">\(F\)</span> de la población y su estimador,
que es la función empírica <span class="math inline">\(\hat{F}\)</span>, como en <span class="citation">Efron and Tibshirani (<a href="#ref-Efron" role="doc-biblioref">1993</a>)</span>.
Si <span class="math inline">\(\theta = t(F)\)</span> es una
cantidad poblacional que queremos estimar, su estimador plug-in es
<span class="math inline">\(\hat{\theta} = t(\hat{F})\)</span>.</p>
<p><strong>Observación 3</strong>: La distribución empírica <span class="math inline">\(\hat{F}\)</span> es un estimador “razonable” de
la distribución poblacional <span class="math inline">\(F,\)</span> pues por el teorema de Glivenko-Cantelli (ver <span class="citation">Wasserman (<a href="#ref-Wasserman" role="doc-biblioref">2013</a>)</span>,
o <a href="https://en.wikipedia.org/wiki/Glivenko-Cantelli_theorem">aquí</a>),
<span class="math inline">\(\hat{F}\)</span> converge a <span class="math inline">\(F\)</span> cuando el tamaño de muestra <span class="math inline">\(n\to\infty\)</span>, lo cual es
intuitivamente claro.</p>
<div id="ejemplo-6" class="section level3 unnumbered">
<h3>Ejemplo</h3>
<p>En el ejemplo de tomadores de té, podemos estimar la proporción de tomadores
de té que prefiere el té negro usando nuestra muestra:</p>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="intervalos-de-confianza-y-remuestreo.html#cb160-1"></a>te &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/tea.csv&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb160-2"><a href="intervalos-de-confianza-y-remuestreo.html#cb160-2"></a><span class="st">  </span><span class="kw">rowid_to_column</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb160-3"><a href="intervalos-de-confianza-y-remuestreo.html#cb160-3"></a><span class="st">  </span><span class="kw">select</span>(rowid, Tea, sugar)</span>
<span id="cb160-4"><a href="intervalos-de-confianza-y-remuestreo.html#cb160-4"></a>te <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">negro =</span> <span class="kw">ifelse</span>(Tea <span class="op">==</span><span class="st"> &quot;black&quot;</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb160-5"><a href="intervalos-de-confianza-y-remuestreo.html#cb160-5"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">prop_negro =</span> <span class="kw">mean</span>(negro), <span class="dt">n =</span> <span class="kw">length</span>(negro), <span class="dt">.groups =</span> <span class="st">&quot;drop&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 2
##   prop_negro     n
##        &lt;dbl&gt; &lt;int&gt;
## 1      0.247   300</code></pre>
<p>¿Cómo evaluamos la precisión de este estimador? Supondremos que el estudio se
hizo tomando una muestra aleatoria simple de tamaño 300 de la población de tomadores de té que
nos interesa. Podemos entonces usar el boostrap:</p>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb162-1"><a href="intervalos-de-confianza-y-remuestreo.html#cb162-1"></a><span class="co"># paso 1: define el estimador</span></span>
<span id="cb162-2"><a href="intervalos-de-confianza-y-remuestreo.html#cb162-2"></a>calc_estimador &lt;-<span class="st"> </span><span class="cf">function</span>(datos){</span>
<span id="cb162-3"><a href="intervalos-de-confianza-y-remuestreo.html#cb162-3"></a>  prop_negro &lt;-<span class="st"> </span>datos <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb162-4"><a href="intervalos-de-confianza-y-remuestreo.html#cb162-4"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">negro =</span> <span class="kw">ifelse</span>(Tea <span class="op">==</span><span class="st"> &quot;black&quot;</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb162-5"><a href="intervalos-de-confianza-y-remuestreo.html#cb162-5"></a><span class="st">    </span><span class="kw">summarise</span>(<span class="dt">prop_negro =</span> <span class="kw">mean</span>(negro), <span class="dt">n =</span> <span class="kw">length</span>(negro), <span class="dt">.groups =</span> <span class="st">&quot;drop&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb162-6"><a href="intervalos-de-confianza-y-remuestreo.html#cb162-6"></a><span class="st">    </span><span class="kw">pull</span>(prop_negro)</span>
<span id="cb162-7"><a href="intervalos-de-confianza-y-remuestreo.html#cb162-7"></a>  prop_negro</span>
<span id="cb162-8"><a href="intervalos-de-confianza-y-remuestreo.html#cb162-8"></a>}</span>
<span id="cb162-9"><a href="intervalos-de-confianza-y-remuestreo.html#cb162-9"></a><span class="co"># paso 2: define el proceso de remuestreo</span></span>
<span id="cb162-10"><a href="intervalos-de-confianza-y-remuestreo.html#cb162-10"></a>muestra_boot &lt;-<span class="st"> </span><span class="cf">function</span>(datos){</span>
<span id="cb162-11"><a href="intervalos-de-confianza-y-remuestreo.html#cb162-11"></a>  <span class="co">#tomar muestra con reemplazo del mismo tamaño</span></span>
<span id="cb162-12"><a href="intervalos-de-confianza-y-remuestreo.html#cb162-12"></a>  <span class="kw">sample_n</span>(datos, <span class="dt">size =</span> <span class="kw">nrow</span>(datos), <span class="dt">replace =</span> <span class="ot">TRUE</span>)</span>
<span id="cb162-13"><a href="intervalos-de-confianza-y-remuestreo.html#cb162-13"></a>}</span>
<span id="cb162-14"><a href="intervalos-de-confianza-y-remuestreo.html#cb162-14"></a><span class="co"># paso 3: remuestrea y calcula el estimador</span></span>
<span id="cb162-15"><a href="intervalos-de-confianza-y-remuestreo.html#cb162-15"></a>prop_negro_tbl &lt;-<span class="st"> </span><span class="kw">map_dbl</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">2000</span>,  <span class="op">~</span><span class="st"> </span><span class="kw">calc_estimador</span>(<span class="kw">muestra_boot</span>(<span class="dt">datos =</span> te))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb162-16"><a href="intervalos-de-confianza-y-remuestreo.html#cb162-16"></a><span class="st">  </span><span class="kw">tibble</span>(<span class="dt">prop_negro =</span> .)</span>
<span id="cb162-17"><a href="intervalos-de-confianza-y-remuestreo.html#cb162-17"></a><span class="co"># paso 4: examina la distribución bootstrap</span></span>
<span id="cb162-18"><a href="intervalos-de-confianza-y-remuestreo.html#cb162-18"></a>prop_negro_tbl <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb162-19"><a href="intervalos-de-confianza-y-remuestreo.html#cb162-19"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> prop_negro)) <span class="op">+</span></span>
<span id="cb162-20"><a href="intervalos-de-confianza-y-remuestreo.html#cb162-20"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">bins =</span> <span class="dv">15</span>)</span></code></pre></div>
<p><img src="06-remuestreo_files/figure-html/unnamed-chunk-17-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Y podemos evaluar varios aspectos, por ejemplo dónde está centrada y
qué tan dispersa es la distribución bootstrap:</p>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb163-1"><a href="intervalos-de-confianza-y-remuestreo.html#cb163-1"></a>prop_negro_tbl <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb163-2"><a href="intervalos-de-confianza-y-remuestreo.html#cb163-2"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">media =</span> <span class="kw">mean</span>(prop_negro),</span>
<span id="cb163-3"><a href="intervalos-de-confianza-y-remuestreo.html#cb163-3"></a>            <span class="dt">sesgo =</span> <span class="kw">mean</span>(prop_negro) <span class="op">-</span><span class="st"> </span><span class="fl">0.2499</span>,</span>
<span id="cb163-4"><a href="intervalos-de-confianza-y-remuestreo.html#cb163-4"></a>            <span class="dt">ee =</span> <span class="kw">sd</span>(prop_negro),</span>
<span id="cb163-5"><a href="intervalos-de-confianza-y-remuestreo.html#cb163-5"></a>            <span class="dt">cuantil_75 =</span> <span class="kw">quantile</span>(prop_negro, <span class="fl">0.75</span>), </span>
<span id="cb163-6"><a href="intervalos-de-confianza-y-remuestreo.html#cb163-6"></a>            <span class="dt">cuantil_25 =</span> <span class="kw">quantile</span>(prop_negro, <span class="fl">0.25</span>),</span>
<span id="cb163-7"><a href="intervalos-de-confianza-y-remuestreo.html#cb163-7"></a>            <span class="dt">.groups =</span> <span class="st">&quot;drop&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb163-8"><a href="intervalos-de-confianza-y-remuestreo.html#cb163-8"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="kw">across</span>(<span class="kw">where</span>(is.numeric), round, <span class="dv">3</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb163-9"><a href="intervalos-de-confianza-y-remuestreo.html#cb163-9"></a><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="dt">cols =</span> <span class="kw">everything</span>())</span></code></pre></div>
<pre><code>## # A tibble: 5 x 2
##   name        value
##   &lt;chr&gt;       &lt;dbl&gt;
## 1 media       0.248
## 2 sesgo      -0.002
## 3 ee          0.025
## 4 cuantil_75  0.263
## 5 cuantil_25  0.23</code></pre>
</div>
</div>
<div id="discusión-propiedades-de-la-distribución-bootstrap" class="section level2 unnumbered">
<h2>Discusión: propiedades de la distribución bootstrap</h2>
<p>Uasremos la distribución bootstrap principalmente para evaluar la variabilidad
de nuestros estimadores (y también otros aspectos como sesgo) estimando
la dispersión de la distribución de muestreo. Sin embargo, es importante notar
que no la usamos, por ejemplo, para saber dónde está centrada la distribución
de muestreo, o para “mejorar” la estimación remuestreando.</p>
<div id="ejemplo-7" class="section level3 unnumbered">
<h3>Ejemplo</h3>
<p>En nuestro ejemplo, podemos ver varias muestras (por ejemplo 20) de tamaño 200, y
vemos cómo se ve la aproximación a la distribución de la población:</p>
<p><img src="06-remuestreo_files/figure-html/unnamed-chunk-19-1.png" width="384" style="display: block; margin: auto;" /></p>
<p>Podemos calcular las distribuciones de remuestreo para cada muestra bootstrap,
y compararlas con la distribución de muestreo real.</p>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb165-1"><a href="intervalos-de-confianza-y-remuestreo.html#cb165-1"></a><span class="co"># paso 1: define el estimador</span></span>
<span id="cb165-2"><a href="intervalos-de-confianza-y-remuestreo.html#cb165-2"></a>calc_estimador &lt;-<span class="st"> </span><span class="cf">function</span>(datos){</span>
<span id="cb165-3"><a href="intervalos-de-confianza-y-remuestreo.html#cb165-3"></a>  media_precio &lt;-<span class="st"> </span>datos <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb165-4"><a href="intervalos-de-confianza-y-remuestreo.html#cb165-4"></a><span class="st">    </span><span class="kw">summarise</span>(<span class="dt">media =</span> <span class="kw">mean</span>(precio_miles), <span class="dt">.groups =</span> <span class="st">&quot;drop&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb165-5"><a href="intervalos-de-confianza-y-remuestreo.html#cb165-5"></a><span class="st">    </span><span class="kw">pull</span>(media)</span>
<span id="cb165-6"><a href="intervalos-de-confianza-y-remuestreo.html#cb165-6"></a>  media_precio</span>
<span id="cb165-7"><a href="intervalos-de-confianza-y-remuestreo.html#cb165-7"></a>}</span>
<span id="cb165-8"><a href="intervalos-de-confianza-y-remuestreo.html#cb165-8"></a><span class="co"># paso 2: define el proceso de remuestreo</span></span>
<span id="cb165-9"><a href="intervalos-de-confianza-y-remuestreo.html#cb165-9"></a>muestra_boot &lt;-<span class="st"> </span><span class="cf">function</span>(datos, <span class="dt">n =</span> <span class="ot">NULL</span>){</span>
<span id="cb165-10"><a href="intervalos-de-confianza-y-remuestreo.html#cb165-10"></a>  <span class="co">#tomar muestra con reemplazo del mismo tamaño</span></span>
<span id="cb165-11"><a href="intervalos-de-confianza-y-remuestreo.html#cb165-11"></a>  <span class="cf">if</span>(<span class="kw">is.null</span>(n)){</span>
<span id="cb165-12"><a href="intervalos-de-confianza-y-remuestreo.html#cb165-12"></a>    m &lt;-<span class="st"> </span><span class="kw">sample_n</span>(datos, <span class="dt">size =</span> <span class="kw">nrow</span>(datos), <span class="dt">replace =</span> <span class="ot">TRUE</span>)}</span>
<span id="cb165-13"><a href="intervalos-de-confianza-y-remuestreo.html#cb165-13"></a>  <span class="cf">else</span> {</span>
<span id="cb165-14"><a href="intervalos-de-confianza-y-remuestreo.html#cb165-14"></a>    m &lt;-<span class="st"> </span><span class="kw">sample_n</span>(datos, <span class="dt">size =</span> n, <span class="dt">replace =</span> <span class="ot">TRUE</span>)</span>
<span id="cb165-15"><a href="intervalos-de-confianza-y-remuestreo.html#cb165-15"></a>  }</span>
<span id="cb165-16"><a href="intervalos-de-confianza-y-remuestreo.html#cb165-16"></a>  m</span>
<span id="cb165-17"><a href="intervalos-de-confianza-y-remuestreo.html#cb165-17"></a>}</span>
<span id="cb165-18"><a href="intervalos-de-confianza-y-remuestreo.html#cb165-18"></a>dist_boot &lt;-<span class="st"> </span>datos_sim <span class="op">%&gt;%</span></span>
<span id="cb165-19"><a href="intervalos-de-confianza-y-remuestreo.html#cb165-19"></a><span class="st">  </span><span class="kw">filter</span>(tipo <span class="op">==</span><span class="st"> &quot;muestras&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb165-20"><a href="intervalos-de-confianza-y-remuestreo.html#cb165-20"></a><span class="st">  </span><span class="kw">select</span>(precio_miles, rep) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb165-21"><a href="intervalos-de-confianza-y-remuestreo.html#cb165-21"></a><span class="st">  </span><span class="kw">group_by</span>(rep) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">nest</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb165-22"><a href="intervalos-de-confianza-y-remuestreo.html#cb165-22"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">precio_miles =</span>  <span class="kw">map</span>(data, <span class="cf">function</span>(data){</span>
<span id="cb165-23"><a href="intervalos-de-confianza-y-remuestreo.html#cb165-23"></a>    <span class="kw">tibble</span>(<span class="dt">precio_miles =</span> <span class="kw">map_dbl</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">1000</span>, <span class="op">~</span><span class="st"> </span><span class="kw">calc_estimador</span>(<span class="kw">muestra_boot</span>(data))))</span>
<span id="cb165-24"><a href="intervalos-de-confianza-y-remuestreo.html#cb165-24"></a>  })) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb165-25"><a href="intervalos-de-confianza-y-remuestreo.html#cb165-25"></a><span class="st">  </span><span class="kw">select</span>(rep, precio_miles) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb165-26"><a href="intervalos-de-confianza-y-remuestreo.html#cb165-26"></a><span class="st">  </span><span class="kw">unnest</span>()</span>
<span id="cb165-27"><a href="intervalos-de-confianza-y-remuestreo.html#cb165-27"></a>  </span>
<span id="cb165-28"><a href="intervalos-de-confianza-y-remuestreo.html#cb165-28"></a>dist_muestreo &lt;-<span class="st"> </span>datos_sim <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb165-29"><a href="intervalos-de-confianza-y-remuestreo.html#cb165-29"></a><span class="st">  </span><span class="kw">filter</span>(tipo <span class="op">==</span><span class="st"> &quot;población&quot;) %&gt;% </span></span>
<span id="cb165-30"><a href="intervalos-de-confianza-y-remuestreo.html#cb165-30"></a><span class="st">  group_by(rep) %&gt;% nest() %&gt;% </span></span>
<span id="cb165-31"><a href="intervalos-de-confianza-y-remuestreo.html#cb165-31"></a><span class="st">  mutate(precio_miles =  map(data, function(data){</span></span>
<span id="cb165-32"><a href="intervalos-de-confianza-y-remuestreo.html#cb165-32"></a><span class="st">    tibble(precio_miles = map_dbl(1:1000, ~ calc_estimador(muestra_boot(data, n = 200))))</span></span>
<span id="cb165-33"><a href="intervalos-de-confianza-y-remuestreo.html#cb165-33"></a><span class="st">  })) %&gt;% </span></span>
<span id="cb165-34"><a href="intervalos-de-confianza-y-remuestreo.html#cb165-34"></a><span class="st">  select(rep, precio_miles) %&gt;% </span></span>
<span id="cb165-35"><a href="intervalos-de-confianza-y-remuestreo.html#cb165-35"></a><span class="st">  unnest()</span></span></code></pre></div>
<p><img src="06-remuestreo_files/figure-html/unnamed-chunk-21-1.png" width="384" style="display: block; margin: auto;" /></p>
<p>Obsérvese que:</p>
<ul>
<li>En algunos casos la aproximación es mejor que en otros (a veces
la muestra tiene valores ligeramente más altos o más bajos).</li>
<li>La dispersión de cada una de estas distribuciones bootstrap es similar a la de la verdadera
distribución de muestreo (en rojo), pero puede está desplazada dependiendo
de la muestra original que utilizamos.</li>
<li>Adicionalmente, los valores centrales de la distribución de bootstrap
tiende cubrir el verdadero valor que buscamos estimar, que es:</li>
</ul>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="intervalos-de-confianza-y-remuestreo.html#cb166-1"></a>poblacion_casas <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarise</span>(<span class="dt">media =</span> <span class="kw">mean</span>(precio_miles), <span class="dt">.groups =</span> <span class="st">&quot;drop&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 1
##   media
##   &lt;dbl&gt;
## 1  183.</code></pre>
</div>
<div id="variación-en-distribuciones-bootstrap" class="section level3 unnumbered">
<h3>Variación en distribuciones bootstrap</h3>
<p>En el proceso de estimación bootstrap hay dos fuentes de variación pues:</p>
<ul>
<li><p>La muestra original se selecciona con aleatoriedad de una población.</p></li>
<li><p>Las muestras bootstrap se seleccionan con aleatoriedad de la muestra
original. Esto es: <em>La estimación bootstrap ideal es un resultado asintótico
<span class="math inline">\(B=\infty\)</span>, en esta caso <span class="math inline">\(\hat{\textsf{ee}}_{boot}\)</span> iguala la estimación <em>plug-in</em>
<span class="math inline">\(ee_{\hat{F}}\)</span>.</em></p></li>
</ul>
<p>En el proceso de <em>bootstrap</em> podemos controlar la variación del segundo aspecto,
conocida como <strong>implementación de muestreo Monte Carlo</strong>, y la variación
Monte Carlo decrece conforme incrementamos el número de muestras.</p>
<p>Podemos eliminar la variación Monte Carlo si seleccionamos todas las posibles
muestras con reemplazo de tamaño <span class="math inline">\(n\)</span>, hay <span class="math inline">\({2n-1}\choose{n}\)</span> posibles muestras
y si seleccionamos todas obtenemos <span class="math inline">\(\hat{\textsf{se}}_\infty\)</span> (bootstrap ideal),
sin embargo, en la mayor parte de los problemas no es factible proceder así.</p>
<p>En la siguiente gráfica mostramos 6 posibles muestras de tamaño 50 simuladas de
la población, para cada una de ellas se graficó la distribución empírica y se
se realizan histogramas de la distribución bootstrap con <span class="math inline">\(B=30\)</span> y <span class="math inline">\(B=1000\)</span>, en
cada caso hacemos dos repeticiones, notemos que cuando el número de muestras
bootstrap es grande las distribuciones bootstrap son muy similares (para una
muestra de la población dada), esto es porque disminuimos el erro Monte Carlo.
También vale la pena recalcar que la distribución bootstrap está centrada en el
valor observado en la muestra (línea azúl punteada) y no en el valor poblacional
sin embargo la forma de la distribución es similar a lo largo de las filas.</p>
<p><img src="images/bootstrap_mc_error.png" /></p>
<p>Entonces, ¿cuántas muestras bootstrap?</p>
<ol style="list-style-type: decimal">
<li><p>Incluso un número chico de replicaciones bootstrap, digamos <span class="math inline">\(B=25\)</span> es
informativo, y <span class="math inline">\(B=50\)</span> con frecuencia es suficiente para dar una buena
estimación de <span class="math inline">\(se_P(\hat{\theta})\)</span> (<span class="citation">Efron and Tibshirani (<a href="#ref-Efron" role="doc-biblioref">1993</a>)</span>).</p></li>
<li><p>Cuando se busca estimar error estándar <span class="citation">Chihara and Hesterberg (<a href="#ref-Chihara" role="doc-biblioref">2018</a>)</span> recomienda <span class="math inline">\(B=1000\)</span> muestras, o
<span class="math inline">\(B=10,000\)</span> muestras dependiendo la presición que se busque.</p></li>
</ol>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="intervalos-de-confianza-y-remuestreo.html#cb168-1"></a>se_media_boot &lt;-<span class="st"> </span><span class="cf">function</span>(x, B){</span>
<span id="cb168-2"><a href="intervalos-de-confianza-y-remuestreo.html#cb168-2"></a>    thetas_boot &lt;-<span class="st"> </span><span class="kw">rerun</span>(B, <span class="kw">mean</span>(<span class="kw">sample</span>(x, <span class="dt">replace =</span> <span class="ot">TRUE</span>))) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">flatten_dbl</span>()</span>
<span id="cb168-3"><a href="intervalos-de-confianza-y-remuestreo.html#cb168-3"></a>    <span class="kw">sd</span>(thetas_boot)</span>
<span id="cb168-4"><a href="intervalos-de-confianza-y-remuestreo.html#cb168-4"></a>}</span>
<span id="cb168-5"><a href="intervalos-de-confianza-y-remuestreo.html#cb168-5"></a>B_muestras &lt;-<span class="st"> </span><span class="kw">data_frame</span>(<span class="dt">n_sims =</span> <span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">25</span>, <span class="dv">50</span>, <span class="dv">100</span>, <span class="dv">200</span>, <span class="dv">400</span>, <span class="dv">1000</span>, <span class="dv">1500</span>, <span class="dv">3000</span>, </span>
<span id="cb168-6"><a href="intervalos-de-confianza-y-remuestreo.html#cb168-6"></a>    <span class="dv">5000</span>, <span class="dv">10000</span>, <span class="dv">20000</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb168-7"><a href="intervalos-de-confianza-y-remuestreo.html#cb168-7"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">est =</span> <span class="kw">map_dbl</span>(n_sims, <span class="op">~</span><span class="kw">se_media_boot</span>(<span class="dt">x =</span> casas_muestra<span class="op">$</span>precio_m2, <span class="dt">B =</span> .)))</span>
<span id="cb168-8"><a href="intervalos-de-confianza-y-remuestreo.html#cb168-8"></a>B_muestras</span></code></pre></div>
<pre><code>## # A tibble: 12 x 2
##    n_sims   est
##     &lt;dbl&gt; &lt;dbl&gt;
##  1      5  25.8
##  2     25  24.2
##  3     50  25.6
##  4    100  24.8
##  5    200  22.7
##  6    400  23.2
##  7   1000  23.2
##  8   1500  23.1
##  9   3000  23.5
## 10   5000  23.5
## 11  10000  23.8
## 12  20000  23.3</code></pre>
</div>
</div>
<div id="error-estándar-bootstrap-e-intervalos-normales" class="section level2 unnumbered">
<h2>Error estándar bootstrap e intervalos normales</h2>
<p>Ahora podemos construir nuestra primera versión de intervalos de confianza
basados en la distribución bootstrap.</p>
<ul>
<li><p>Supongamos que queremos estimar una cantidad poblacional <span class="math inline">\(\theta\)</span> con una
estadística <span class="math inline">\(\hat{\theta} = t(X_1,\ldots, X_n)\)</span>, donde <span class="math inline">\(X_1,\ldots, X_n\)</span> es una muestra
independiente e idénticamente distribuida de la población.</p></li>
<li><p>Suponemos además que la distribución muestral de <span class="math inline">\(\hat{\theta}\)</span> es aproximadamente normal (el teorema
central del límite aplica), y está centrada en el verdadero valor poblacional <span class="math inline">\(\theta\)</span>.</p></li>
</ul>
<p>Ahora queremos construir un intervalo que tenga probabilidad 95% de cubrir al
valor poblacional <span class="math inline">\(\theta\)</span>. Tenemos que</p>
<p><span class="math display">\[P(-2\mathsf{ee}(\hat{\theta}) &lt;  \hat{\theta} - \theta &lt; 2\mathsf{ee}(\hat{\theta})) \approx 0.95\]</span>
por las propiedades de la distribución normal (<span class="math inline">\(P(-2\sigma &lt; X -\mu &lt; 2\sigma)\approx 0.95\)</span> si <span class="math inline">\(X\)</span> es
normal con media <span class="math inline">\(\mu\)</span> y desviación estándar <span class="math inline">\(\sigma\)</span>). Entonces</p>
<p><span class="math display">\[P(\hat{\theta} - 2\mathsf{ee}(\hat{\theta}) &lt; \theta &lt; \hat{\theta} + 2\mathsf{ee}(\hat{\theta})) \approx 0.95\]</span>
Es decir, la probabilidad de que el verdadero valor poblacional <span class="math inline">\(\theta\)</span> esté en el intervalo
<span class="math display">\[[\hat{\theta} - 2\mathsf{ee}(\hat{\theta}), \hat{\theta} + 2\mathsf{ee}(\hat{\theta})]\]</span>
es cercano a 0.95. En este intervalo no conocemos el error estándar (es la desviación estándar
de la distribución de muestreo de <span class="math inline">\(\hat{\theta}\)</span>), y aquí es donde
entre la distribución bootstrap, que aproxima la distribución de muestreo. Lo estimamos con</p>
<p><span class="math display">\[\hat{\mathsf{ee}}_{\textrm{boot}}(\hat{\theta})\]</span>
que es la desviación estándar de la <strong>distribución bootsrap</strong>.</p>

<div class="mathblock">
<p><strong>Definición.</strong> El <strong>error estándar bootstrap</strong> <span class="math inline">\(\hat{\mathsf{ee}}_{\textrm{boot}}(\hat{\theta})\)</span> se
define como la desviación estándar de la distribución bootstrap de <span class="math inline">\(\theta\)</span>.</p>
El <strong>intervalo de confianza normal bootstrap</strong> al 95% está dado por
<span class="math display">\[[\hat{\theta} - 2\mathsf{ee}(\hat{\theta}), \hat{\theta} + 2\mathsf{ee}(\hat{\theta})].\]</span>
</div>

<p>Nótese que hay varias cosas qué checar aquí: que el teorema central del límite aplica y
que la distribución de muestreo de nuestro estimador está centrado en el valor verdadero.
Esto en algunos casos se puede demostrar usando la teoría, pero más abajo veremos
comprobaciones empíricas.</p>
<div id="ejemplo-tomadores-de-té-negro" class="section level3 unnumbered">
<h3>Ejemplo: tomadores de té negro</h3>
<p>Consideremos la estimación que hicimos de el procentaje de tomadores de té que toma
té negro:</p>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb170-1"><a href="intervalos-de-confianza-y-remuestreo.html#cb170-1"></a><span class="co"># paso 1: define el estimador</span></span>
<span id="cb170-2"><a href="intervalos-de-confianza-y-remuestreo.html#cb170-2"></a>calc_estimador &lt;-<span class="st"> </span><span class="cf">function</span>(datos){</span>
<span id="cb170-3"><a href="intervalos-de-confianza-y-remuestreo.html#cb170-3"></a>  prop_negro &lt;-<span class="st"> </span>datos <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb170-4"><a href="intervalos-de-confianza-y-remuestreo.html#cb170-4"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">negro =</span> <span class="kw">ifelse</span>(Tea <span class="op">==</span><span class="st"> &quot;black&quot;</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb170-5"><a href="intervalos-de-confianza-y-remuestreo.html#cb170-5"></a><span class="st">    </span><span class="kw">summarise</span>(<span class="dt">prop_negro =</span> <span class="kw">mean</span>(negro), <span class="dt">n =</span> <span class="kw">length</span>(negro)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb170-6"><a href="intervalos-de-confianza-y-remuestreo.html#cb170-6"></a><span class="st">    </span><span class="kw">pull</span>(prop_negro)</span>
<span id="cb170-7"><a href="intervalos-de-confianza-y-remuestreo.html#cb170-7"></a>  prop_negro</span>
<span id="cb170-8"><a href="intervalos-de-confianza-y-remuestreo.html#cb170-8"></a>}</span>
<span id="cb170-9"><a href="intervalos-de-confianza-y-remuestreo.html#cb170-9"></a>prop_hat &lt;-<span class="st"> </span><span class="kw">calc_estimador</span>(te)</span>
<span id="cb170-10"><a href="intervalos-de-confianza-y-remuestreo.html#cb170-10"></a>prop_hat <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] 0.25</code></pre>
<p>Podemos graficar su distribución bootstrap —la cual simulamos arriba—.</p>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb172-1"><a href="intervalos-de-confianza-y-remuestreo.html#cb172-1"></a>g_hist &lt;-<span class="st"> </span><span class="kw">ggplot</span>(prop_negro_tbl, <span class="kw">aes</span>(<span class="dt">x =</span> prop_negro)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>(<span class="dt">bins =</span> <span class="dv">15</span>)</span>
<span id="cb172-2"><a href="intervalos-de-confianza-y-remuestreo.html#cb172-2"></a>g_qq_normal &lt;-<span class="st"> </span><span class="kw">ggplot</span>(prop_negro_tbl, <span class="kw">aes</span>(<span class="dt">sample =</span> prop_negro)) <span class="op">+</span></span>
<span id="cb172-3"><a href="intervalos-de-confianza-y-remuestreo.html#cb172-3"></a><span class="st">  </span><span class="kw">geom_qq</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_qq_line</span>(<span class="dt">colour =</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="cb172-4"><a href="intervalos-de-confianza-y-remuestreo.html#cb172-4"></a>g_hist <span class="op">+</span><span class="st"> </span>g_qq_normal</span></code></pre></div>
<p><img src="06-remuestreo_files/figure-html/unnamed-chunk-27-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Y notamos que la distribución bootstrap es aproximadamente normal.
Adicionalmente, vemos que el sesgo tiene un valor estimado de:</p>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb173-1"><a href="intervalos-de-confianza-y-remuestreo.html#cb173-1"></a>media_boot &lt;-<span class="st"> </span>prop_negro_tbl <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">pull</span>(prop_negro) <span class="op">%&gt;%</span><span class="st"> </span>mean</span>
<span id="cb173-2"><a href="intervalos-de-confianza-y-remuestreo.html#cb173-2"></a>media_boot <span class="op">-</span><span class="st"> </span>prop_hat</span></code></pre></div>
<pre><code>## [1] 0.001126667</code></pre>
<p>De esta forma, hemos verificado que:</p>
<ul>
<li>La distribución bootstrap es aproximadamente normal (ver gráfica de cuantiles normales);</li>
<li>La distribución bootstrap es aproximadamente insesgada.</li>
</ul>
<p>Lo cual nos lleva a construir intervalos de confianza basados en la distribución
normal. Estimamos el error estándar con la desviación estándar de la
distribución bootstrap</p>
<div class="sourceCode" id="cb175"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb175-1"><a href="intervalos-de-confianza-y-remuestreo.html#cb175-1"></a>ee_boot &lt;-<span class="st"> </span>prop_negro_tbl <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">pull</span>(prop_negro) <span class="op">%&gt;%</span><span class="st"> </span>sd</span>
<span id="cb175-2"><a href="intervalos-de-confianza-y-remuestreo.html#cb175-2"></a>ee_boot</span></code></pre></div>
<pre><code>## [1] 0.02478898</code></pre>
<p>y construimos un intervalo de confianza del 95%:</p>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb177-1"><a href="intervalos-de-confianza-y-remuestreo.html#cb177-1"></a>intervalo_<span class="dv">95</span> &lt;-<span class="st"> </span><span class="kw">c</span>(prop_hat <span class="op">-</span><span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>ee_boot, prop_hat <span class="op">+</span><span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>ee_boot)</span>
<span id="cb177-2"><a href="intervalos-de-confianza-y-remuestreo.html#cb177-2"></a>intervalo_<span class="dv">95</span> <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] 0.2 0.3</code></pre>
<p>Este intervalo tiene probabilidad del 95% de capturar al verdadero poblacional. Con
<em>alta</em> probabilidad, entonces, el porcentaje de tomadores de té en la población
está entre 0.2 y 0.3.</p>
</div>
</div>
<div id="ejemplo-inventario-de-casas-vendidas" class="section level2 unnumbered">
<h2>Ejemplo: inventario de casas vendidas</h2>
<p>Ahora consideremos el problema de estimar el total del valor de las casas
vendidas en un periodo. Tenemos una muestra de tamaño <span class="math inline">\(n=150\)</span>:</p>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="intervalos-de-confianza-y-remuestreo.html#cb179-1"></a><span class="co"># muestra original</span></span>
<span id="cb179-2"><a href="intervalos-de-confianza-y-remuestreo.html#cb179-2"></a><span class="kw">set.seed</span>(<span class="dv">121</span>)</span>
<span id="cb179-3"><a href="intervalos-de-confianza-y-remuestreo.html#cb179-3"></a>muestra_casas &lt;-<span class="st"> </span><span class="kw">sample_n</span>(poblacion_casas, <span class="dt">size =</span> <span class="dv">150</span>)</span>
<span id="cb179-4"><a href="intervalos-de-confianza-y-remuestreo.html#cb179-4"></a><span class="co"># paso 1: define el estimador</span></span>
<span id="cb179-5"><a href="intervalos-de-confianza-y-remuestreo.html#cb179-5"></a>calc_estimador_casas &lt;-<span class="st"> </span><span class="cf">function</span>(datos){</span>
<span id="cb179-6"><a href="intervalos-de-confianza-y-remuestreo.html#cb179-6"></a>  N &lt;-<span class="st"> </span><span class="kw">nrow</span>(poblacion_casas)</span>
<span id="cb179-7"><a href="intervalos-de-confianza-y-remuestreo.html#cb179-7"></a>  n &lt;-<span class="st"> </span><span class="kw">nrow</span>(datos)</span>
<span id="cb179-8"><a href="intervalos-de-confianza-y-remuestreo.html#cb179-8"></a>  total_muestra &lt;-<span class="st"> </span><span class="kw">sum</span>(datos<span class="op">$</span>precio_miles)</span>
<span id="cb179-9"><a href="intervalos-de-confianza-y-remuestreo.html#cb179-9"></a>  estimador_total &lt;-<span class="st"> </span>(N <span class="op">/</span><span class="st"> </span>n) <span class="op">*</span><span class="st"> </span>total_muestra</span>
<span id="cb179-10"><a href="intervalos-de-confianza-y-remuestreo.html#cb179-10"></a>  estimador_total</span>
<span id="cb179-11"><a href="intervalos-de-confianza-y-remuestreo.html#cb179-11"></a>}</span>
<span id="cb179-12"><a href="intervalos-de-confianza-y-remuestreo.html#cb179-12"></a><span class="co"># paso 2: define el proceso de remuestreo</span></span>
<span id="cb179-13"><a href="intervalos-de-confianza-y-remuestreo.html#cb179-13"></a>muestra_boot &lt;-<span class="st"> </span><span class="cf">function</span>(datos){</span>
<span id="cb179-14"><a href="intervalos-de-confianza-y-remuestreo.html#cb179-14"></a>  <span class="co">#tomar muestra con reemplazo del mismo tamaño</span></span>
<span id="cb179-15"><a href="intervalos-de-confianza-y-remuestreo.html#cb179-15"></a>  <span class="kw">sample_n</span>(datos, <span class="dt">size =</span> <span class="kw">nrow</span>(datos), <span class="dt">replace =</span> <span class="ot">TRUE</span>)</span>
<span id="cb179-16"><a href="intervalos-de-confianza-y-remuestreo.html#cb179-16"></a>}</span>
<span id="cb179-17"><a href="intervalos-de-confianza-y-remuestreo.html#cb179-17"></a><span class="co"># paso 3: remuestrea y calcula el estimador</span></span>
<span id="cb179-18"><a href="intervalos-de-confianza-y-remuestreo.html#cb179-18"></a>totales_boot &lt;-<span class="st"> </span><span class="kw">map_dbl</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">5000</span>,  <span class="op">~</span><span class="st"> </span><span class="kw">calc_estimador_casas</span>(<span class="kw">muestra_boot</span>(muestra_casas))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb179-19"><a href="intervalos-de-confianza-y-remuestreo.html#cb179-19"></a><span class="st">  </span><span class="kw">tibble</span>(<span class="dt">total_boot =</span> .)</span>
<span id="cb179-20"><a href="intervalos-de-confianza-y-remuestreo.html#cb179-20"></a><span class="co"># paso 4: examina la distribución bootstrap</span></span>
<span id="cb179-21"><a href="intervalos-de-confianza-y-remuestreo.html#cb179-21"></a>g_hist &lt;-<span class="st"> </span>totales_boot <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb179-22"><a href="intervalos-de-confianza-y-remuestreo.html#cb179-22"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> total_boot)) <span class="op">+</span></span>
<span id="cb179-23"><a href="intervalos-de-confianza-y-remuestreo.html#cb179-23"></a><span class="st">  </span><span class="kw">geom_histogram</span>()</span>
<span id="cb179-24"><a href="intervalos-de-confianza-y-remuestreo.html#cb179-24"></a>g_qq &lt;-<span class="st"> </span>totales_boot <span class="op">%&gt;%</span></span>
<span id="cb179-25"><a href="intervalos-de-confianza-y-remuestreo.html#cb179-25"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">sample =</span> total_boot)) <span class="op">+</span></span>
<span id="cb179-26"><a href="intervalos-de-confianza-y-remuestreo.html#cb179-26"></a><span class="st">  </span><span class="kw">geom_qq</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_qq_line</span>(<span class="dt">colour =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span></span>
<span id="cb179-27"><a href="intervalos-de-confianza-y-remuestreo.html#cb179-27"></a><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="kw">quantile</span>(totales_boot<span class="op">$</span>total_boot, <span class="fl">0.975</span>), <span class="dt">colour =</span> <span class="st">&quot;gray&quot;</span>) <span class="op">+</span></span>
<span id="cb179-28"><a href="intervalos-de-confianza-y-remuestreo.html#cb179-28"></a><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="kw">quantile</span>(totales_boot<span class="op">$</span>total_boot, <span class="fl">0.025</span>), <span class="dt">colour =</span> <span class="st">&quot;gray&quot;</span>) </span>
<span id="cb179-29"><a href="intervalos-de-confianza-y-remuestreo.html#cb179-29"></a>g_hist <span class="op">+</span><span class="st"> </span>g_qq</span></code></pre></div>
<p><img src="06-remuestreo_files/figure-html/unnamed-chunk-31-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>En este caso, distribución de muestreo presenta cierta asimetría, pero la
desviación no es grande. En la parte central la aproximación normal es
razonable. Procedemos a checar sesgo</p>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="intervalos-de-confianza-y-remuestreo.html#cb180-1"></a>total_est &lt;-<span class="st"> </span><span class="kw">calc_estimador_casas</span>(muestra_casas)</span>
<span id="cb180-2"><a href="intervalos-de-confianza-y-remuestreo.html#cb180-2"></a>sesgo &lt;-<span class="st"> </span><span class="kw">mean</span>(totales_boot<span class="op">$</span>total_boot) <span class="op">-</span><span class="st"> </span>total_est</span>
<span id="cb180-3"><a href="intervalos-de-confianza-y-remuestreo.html#cb180-3"></a>sesgo</span></code></pre></div>
<pre><code>## [1] 110.0851</code></pre>
<p>Este número puede parecer grande, pero sí calculamos la desviación relativa
con respecto al estimador vemos que es chico en la escala de la distribución
bootstrap:</p>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="intervalos-de-confianza-y-remuestreo.html#cb182-1"></a>sesgo_relativo &lt;-<span class="st"> </span>sesgo <span class="op">/</span><span class="st"> </span>total_est</span>
<span id="cb182-2"><a href="intervalos-de-confianza-y-remuestreo.html#cb182-2"></a>sesgo_relativo</span></code></pre></div>
<pre><code>## [1] 0.0005053678</code></pre>
<p>De forma que procedemos a construir intervalos de confianza como sigue :</p>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="intervalos-de-confianza-y-remuestreo.html#cb184-1"></a>ee_boot &lt;-<span class="st"> </span><span class="kw">sd</span>(totales_boot<span class="op">$</span>total_boot)</span>
<span id="cb184-2"><a href="intervalos-de-confianza-y-remuestreo.html#cb184-2"></a><span class="kw">c</span>(total_est <span class="op">-</span><span class="st"> </span><span class="dv">2</span><span class="op">*</span>ee_boot, total_est <span class="op">+</span><span class="st"> </span><span class="dv">2</span><span class="op">*</span>ee_boot)</span></code></pre></div>
<pre><code>## [1] 203366.6 232296.6</code></pre>
<p>Que está en miles de dólares. En millones de dólares, este intervalo es:</p>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="intervalos-de-confianza-y-remuestreo.html#cb186-1"></a>intervalo_total &lt;-<span class="st"> </span><span class="kw">c</span>(total_est <span class="op">-</span><span class="st"> </span><span class="dv">2</span><span class="op">*</span>ee_boot, total_est <span class="op">+</span><span class="st"> </span><span class="dv">2</span><span class="op">*</span>ee_boot) <span class="op">/</span><span class="st"> </span><span class="dv">1000</span></span>
<span id="cb186-2"><a href="intervalos-de-confianza-y-remuestreo.html#cb186-2"></a>intervalo_total <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>(<span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] 203.4 232.3</code></pre>
<p>Así que con 95% de confianza el verdadero total del valor de las casas vendidas
está entre 203 y 232 millones
de dólares.</p>
<p><strong>Nota:</strong> en este ejemplo mostraremos una alternativa de intervalos de confianza
que es más apropiado cuando observamos asimetría. Sin embargo, primero tendremos
que hablar de dos conceptos clave con respecto a intervalos de confianza:
calibración e interpretación.</p>
</div>
<div id="calibración-de-intervalos-de-confianza" class="section level2 unnumbered">
<h2>Calibración de intervalos de confianza</h2>
<p>¿Cómo sabemos que nuestros intervalos de confianza del 95% nominal
tienen cobertura real de 95%? Es decir, tenemos que checar:</p>
<ul>
<li>El procedimiento para construir intervalos debe dar intervalos tales
que el valor poblacional está en el intervalo de confianza para 95% de las muestras.</li>
</ul>
<p>Como solo tenemos una muestra, la calibración depende de argumentos teóricos o
estudios de simulación previos. Para nuestro ejemplo de casas tenemos la
población, así que podemos checar qué cobertura real tienen los intervalos normales:</p>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="intervalos-de-confianza-y-remuestreo.html#cb188-1"></a>simular_intervalos &lt;-<span class="st"> </span><span class="cf">function</span>(rep, <span class="dt">size =</span> <span class="dv">150</span>){</span>
<span id="cb188-2"><a href="intervalos-de-confianza-y-remuestreo.html#cb188-2"></a>  muestra_casas &lt;-<span class="st"> </span><span class="kw">sample_n</span>(poblacion_casas, <span class="dt">size =</span> size)</span>
<span id="cb188-3"><a href="intervalos-de-confianza-y-remuestreo.html#cb188-3"></a>  N &lt;-<span class="st"> </span><span class="kw">nrow</span>(poblacion_casas)</span>
<span id="cb188-4"><a href="intervalos-de-confianza-y-remuestreo.html#cb188-4"></a>  n &lt;-<span class="st"> </span><span class="kw">nrow</span>(muestra_casas)</span>
<span id="cb188-5"><a href="intervalos-de-confianza-y-remuestreo.html#cb188-5"></a>  total_est &lt;-<span class="st"> </span>(N <span class="op">/</span><span class="st"> </span>n) <span class="op">*</span><span class="st"> </span><span class="kw">sum</span>(muestra_casas<span class="op">$</span>precio_miles)</span>
<span id="cb188-6"><a href="intervalos-de-confianza-y-remuestreo.html#cb188-6"></a>  <span class="co"># paso 1: define el estimador</span></span>
<span id="cb188-7"><a href="intervalos-de-confianza-y-remuestreo.html#cb188-7"></a>  calc_estimador_casas &lt;-<span class="st"> </span><span class="cf">function</span>(datos){</span>
<span id="cb188-8"><a href="intervalos-de-confianza-y-remuestreo.html#cb188-8"></a>    total_muestra &lt;-<span class="st"> </span><span class="kw">sum</span>(datos<span class="op">$</span>precio_miles)</span>
<span id="cb188-9"><a href="intervalos-de-confianza-y-remuestreo.html#cb188-9"></a>    estimador_total &lt;-<span class="st"> </span>(N <span class="op">/</span><span class="st"> </span>n) <span class="op">*</span><span class="st"> </span>total_muestra</span>
<span id="cb188-10"><a href="intervalos-de-confianza-y-remuestreo.html#cb188-10"></a>    estimador_total</span>
<span id="cb188-11"><a href="intervalos-de-confianza-y-remuestreo.html#cb188-11"></a>  }</span>
<span id="cb188-12"><a href="intervalos-de-confianza-y-remuestreo.html#cb188-12"></a>  <span class="co"># paso 2: define el proceso de remuestreo</span></span>
<span id="cb188-13"><a href="intervalos-de-confianza-y-remuestreo.html#cb188-13"></a>  muestra_boot &lt;-<span class="st"> </span><span class="cf">function</span>(datos){</span>
<span id="cb188-14"><a href="intervalos-de-confianza-y-remuestreo.html#cb188-14"></a>    <span class="co">#tomar muestra con reemplazo del mismo tamaño</span></span>
<span id="cb188-15"><a href="intervalos-de-confianza-y-remuestreo.html#cb188-15"></a>    <span class="kw">sample_n</span>(datos, <span class="dt">size =</span> <span class="kw">nrow</span>(datos), <span class="dt">replace =</span> <span class="ot">TRUE</span>)</span>
<span id="cb188-16"><a href="intervalos-de-confianza-y-remuestreo.html#cb188-16"></a>  }</span>
<span id="cb188-17"><a href="intervalos-de-confianza-y-remuestreo.html#cb188-17"></a>  <span class="co"># paso 3: remuestrea y calcula el estimador</span></span>
<span id="cb188-18"><a href="intervalos-de-confianza-y-remuestreo.html#cb188-18"></a>  totales_boot &lt;-<span class="st"> </span><span class="kw">map_df</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">2000</span>, <span class="op">~</span><span class="kw">calc_estimador_casas</span>(<span class="kw">muestra_boot</span>(muestra_casas))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb188-19"><a href="intervalos-de-confianza-y-remuestreo.html#cb188-19"></a><span class="st">    </span><span class="kw">tibble</span>(<span class="dt">total_boot =</span> .) <span class="op">%&gt;%</span></span>
<span id="cb188-20"><a href="intervalos-de-confianza-y-remuestreo.html#cb188-20"></a><span class="st">    </span><span class="kw">summarise</span>(<span class="dt">ee_boot =</span> <span class="kw">sd</span>(total_boot)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb188-21"><a href="intervalos-de-confianza-y-remuestreo.html#cb188-21"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">inf =</span> total_est <span class="op">-</span><span class="st"> </span><span class="dv">2</span><span class="op">*</span>ee_boot, <span class="dt">sup =</span> total_est <span class="op">+</span><span class="st"> </span><span class="dv">2</span><span class="op">*</span>ee_boot, </span>
<span id="cb188-22"><a href="intervalos-de-confianza-y-remuestreo.html#cb188-22"></a>           <span class="dt">rep =</span> rep)</span>
<span id="cb188-23"><a href="intervalos-de-confianza-y-remuestreo.html#cb188-23"></a>  totales_boot</span>
<span id="cb188-24"><a href="intervalos-de-confianza-y-remuestreo.html#cb188-24"></a>}</span>
<span id="cb188-25"><a href="intervalos-de-confianza-y-remuestreo.html#cb188-25"></a><span class="co"># Para recrear, correr:</span></span>
<span id="cb188-26"><a href="intervalos-de-confianza-y-remuestreo.html#cb188-26"></a><span class="co"># sims_intervalos &lt;- map(1:100, ~ simular_intervalos(rep = .x))</span></span>
<span id="cb188-27"><a href="intervalos-de-confianza-y-remuestreo.html#cb188-27"></a><span class="co"># write_rds(sims_intervalos, &quot;cache/sims_intervalos.rds&quot;)</span></span>
<span id="cb188-28"><a href="intervalos-de-confianza-y-remuestreo.html#cb188-28"></a><span class="co"># Para usar resultados en cache:</span></span>
<span id="cb188-29"><a href="intervalos-de-confianza-y-remuestreo.html#cb188-29"></a>sims_intervalos &lt;-<span class="st"> </span><span class="kw">read_rds</span>(<span class="st">&quot;cache/sims_intervalos.rds&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb189-1"><a href="intervalos-de-confianza-y-remuestreo.html#cb189-1"></a>total &lt;-<span class="st"> </span><span class="kw">sum</span>(poblacion_casas<span class="op">$</span>precio_miles)</span>
<span id="cb189-2"><a href="intervalos-de-confianza-y-remuestreo.html#cb189-2"></a>sims_tbl &lt;-<span class="st"> </span>sims_intervalos <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb189-3"><a href="intervalos-de-confianza-y-remuestreo.html#cb189-3"></a><span class="st">  </span>bind_rows <span class="op">%&gt;%</span></span>
<span id="cb189-4"><a href="intervalos-de-confianza-y-remuestreo.html#cb189-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">cubre =</span> inf <span class="op">&lt;</span><span class="st"> </span>total <span class="op">&amp;</span><span class="st"> </span>total <span class="op">&lt;</span><span class="st"> </span>sup) </span>
<span id="cb189-5"><a href="intervalos-de-confianza-y-remuestreo.html#cb189-5"></a><span class="kw">ggplot</span>(sims_tbl, <span class="kw">aes</span>(<span class="dt">x =</span> rep)) <span class="op">+</span></span>
<span id="cb189-6"><a href="intervalos-de-confianza-y-remuestreo.html#cb189-6"></a><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> total, <span class="dt">colour =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span></span>
<span id="cb189-7"><a href="intervalos-de-confianza-y-remuestreo.html#cb189-7"></a><span class="st">  </span><span class="kw">geom_linerange</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> inf, <span class="dt">ymax =</span> sup, <span class="dt">colour =</span> cubre)) </span></code></pre></div>
<p><img src="06-remuestreo_files/figure-html/unnamed-chunk-37-1.png" width="768" style="display: block; margin: auto;" />
La cobertura para estos 100 intervalos simulados da</p>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb190-1"><a href="intervalos-de-confianza-y-remuestreo.html#cb190-1"></a>total &lt;-<span class="st"> </span><span class="kw">sum</span>(poblacion_casas<span class="op">$</span>precio_miles)</span>
<span id="cb190-2"><a href="intervalos-de-confianza-y-remuestreo.html#cb190-2"></a>sims_tbl <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb190-3"><a href="intervalos-de-confianza-y-remuestreo.html#cb190-3"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">cobertura =</span> <span class="kw">mean</span>(cubre))</span></code></pre></div>
<pre><code>## # A tibble: 1 x 1
##   cobertura
##       &lt;dbl&gt;
## 1      0.96</code></pre>
<p>que es <em>consistente</em> con una cobertura real del 95% (¿qué significa
“consistente”? ¿Cómo puedes checarlo con el bootstrap?)</p>
<p><strong>Observación.</strong> En este caso teníamos la población real, y pudimos verificar
la cobertura de nuestros intervalos. En general no la tenemos. Estos ejercicios
de simulación se pueden hacer con poblaciones sintéticas que se generen con
las características que creemos va a tener nuestra población (por ejemplo, sesgo,
colas largas, etc.).</p>

<div class="comentario">
<p>En general, no importa qué tipo de estimadores o intervalos de confianza usemos,
requerimos checar la calibración. Esto puede hacerse con ejercicios de
simulación con poblaciones sintéticas y tanto los procedimientos de muestreo
como los tamaños de muestra que nos interesa usar.</p>
</div>

<p>Verificar la cobertura de nuestros intervalos de confianza por medio simulación está
bien estudiado para algunos casos. Por ejemplo, cuando trabajamos con estimaciones para
poblaciones teóricas. En general sabemos que los procedimientos funcionan bien en casos:</p>
<ul>
<li>con distribuciones simétricas que tengan colas no muy largas;</li>
<li>estimación de proporciones donde no tratamos con casos raros o casos seguros
(probabilidades cercanas a 0 o 1).</li>
</ul>
</div>
<div id="interpretación-de-intervalos-de-confianza" class="section level2 unnumbered">
<h2>Interpretación de intervalos de confianza</h2>
<p>Como hemos visto, “intervalo de confianza” (de 90% de confianza, por ejemplo) es un
término <em>frecuentista</em>, que significa:</p>
<ul>
<li><strong>Cada muestra produce un intervalo distinto</strong>. Para el 90% de las muestras posibles, el intervalo
cubre al valor poblacional.</li>
<li>La afirmación es <em>sobre el intervalo y el mecanismo para construirlo.</em></li>
<li>Así que con <em>alta probabilidad</em>, el intervalo contiene el valor poblacional.</li>
<li>Intervalos más anchos nos dan más incertidumbre acerca de dónde está el verdadero valor poblacional
(y al revés para intervalos más angostos).</li>
</ul>
<p>Existen también “intervalos de credibilidad” (de 90% de probabilidad, por ejemplo), que se interpetan de
forma <em>bayesiana</em>:</p>
<ul>
<li>Con 90% de probabilidad (relativamente alta), creemos que el valor poblacional está dentro del intervalo de credibilidad.</li>
</ul>
<p>Esta última interpretación es más natural. Obsérvese que para hablar de intervalos de
confianza frecuentista tenemos que decir:</p>
<ul>
<li>Este intervalo particular cubre o no al verdadero valor, pero nuestro procedimiento produce intervalos
que contiene el verdadero valor para el 90% de las muestras.</li>
<li>Esta es una interpretación relativamente débil, y muchos intervalos poco útiles pueden satisfacerla.</li>
<li>La interpretación bayesiana es más natural porque expresa más claramente incertidumbre acerca
del valor poblacional.</li>
</ul>
<p>Por otro lado,</p>
<ul>
<li>La interpretación frecuentista nos da maneras empíricas de probar si los intervalos de
confianza están bien calibrados o no: es un mínimo que “intervalos del 90%” deberían satisfacer.</li>
</ul>
<p>Así que tomamos el punto de vista bayesiano en la intepretación, pero
buscamos que nuestros intervalos cumplan o
aproximen bien garantías frecuentistas (discutimos esto más adelante). Los intervalos
que producimos en esta sección pueden interpretarse de las dos maneras.</p>
</div>
<div id="intervalos-bootstrap-de-percentiles" class="section level2 unnumbered">
<h2>Intervalos bootstrap de percentiles</h2>
<p>Retomemos nuestro ejemplo del valor total del precio de las casas. A través de
remuestras bootstrap hemos verificado gráficamente que la distribución de
remuestreo es <em>ligeramente</em> asimétrica (ver la figura de abajo).</p>
<p><img src="06-remuestreo_files/figure-html/unnamed-chunk-40-1.png" width="95%" style="display: block; margin: auto;" /></p>
<p>Anteriormente hemos calculado intervalos de confianza basados en supuestos
normales por medio del error éstandar. Este intervalo está dado por</p>
<pre><code>## [1] 203.4 232.3</code></pre>
<p>y por construcción sabemos que es simétrico con respecto al valor estimado, pero
como podemos ver la distribución de muestreo no es simétrica, lo cual podemos
confirmar por ejemplo calculando el porcentaje de muestras bootstrap que caen
por arriba y por debajo del intervalo construido:</p>
<pre><code>## # A tibble: 1 x 2
##   prop_inf prop_sup
##      &lt;dbl&gt;    &lt;dbl&gt;
## 1   0.0192    0.026</code></pre>
<p>los cuales se han calculado como el porcentaje de medias bootstrap por debajo
(arriba) de la cota inferior (superior), y vemos que no coinciden con el nivel de
confianza prestablecido (2.5% para cada extremo).</p>
<p>Otra opción común que se usa específicamente cuando la distribución bootstrap
no es muy cercana a la normal son los intervalos de percentiles bootstrap:</p>

<div class="mathblock">
<p><strong>Definición.</strong> El <strong>intervalo de percentiles bootstrap</strong> al 95% de confianza
está dado por
<span class="math display">\[[q_{0.025}, q_{0.975}]\]</span>
donde <span class="math inline">\(q_f\)</span> es el percentil <span class="math inline">\(f\)</span> de la distribución bootstrap.</p>
</div>

<p>Otros intervalos comunes son el de 80% o 90% de confianza, por ejemplo,
que corresponden a <span class="math inline">\([q_{0.10}, q_{0.90}]\)</span> y <span class="math inline">\([q_{0.05}, q_{0.95}]\)</span>. <em>Ojo</em>:
intervalos de confianza muy alta (por ejemplo 99.5%) pueden tener mala calibración
o ser muy variables en su longitud pues dependen del comportamiento en las colas de la
distribución.</p>
<p>Para el ejemplo de las casas, calcularíamos simplemente</p>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="intervalos-de-confianza-y-remuestreo.html#cb194-1"></a>intervalo_<span class="dv">95</span> &lt;-<span class="st"> </span>totales_boot <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">pull</span>(total_boot) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">quantile</span>(., <span class="dt">probs =</span> <span class="kw">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>)) <span class="op">/</span><span class="st"> </span><span class="dv">1000</span></span>
<span id="cb194-2"><a href="intervalos-de-confianza-y-remuestreo.html#cb194-2"></a>(intervalo_<span class="dv">95</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>(<span class="dv">1</span>)</span></code></pre></div>
<pre><code>##  2.5% 97.5% 
## 204.3 232.5</code></pre>
<p>que está en millones de dólares. Nótese que es similar al intervalo de error estándar.</p>
<p>Otro punto interesante sobre los intervalos bootstrap de percentiles es que
lidian naturalmente con la asímetría de la distribución bootstrap. Ilustramos
esto con la distancia de las extremos del intervalo con respecto a la media:</p>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="intervalos-de-confianza-y-remuestreo.html#cb196-1"></a><span class="kw">abs</span>(intervalo_<span class="dv">95</span> <span class="op">-</span><span class="st"> </span>total_est<span class="op">/</span><span class="dv">1000</span>)</span></code></pre></div>
<pre><code>##     2.5%    97.5% 
## 13.53912 14.64674</code></pre>
<p>Los intervalos de confianza nos permiten presentar un rango de valores posibles
para el parámetro de interés. Esto es una notable diferencia con respecto a
presentar sólo un candidato como estimador. Nuestra fuente de información son
los datos. Es por esto que si vemos valores muy chicos (grandes) en nuestra
muestra, el intervalo se tiene que extender a la izquierda (derecha) para
compensar dichas observaciones.</p>

<div class="ejercicio">
Explica por qué cuando la aproximación normal es apropiada, el intervalo de percentiles
al 95% es muy similar al intervalo normal de 2 errores estándar.
</div>

<div id="ejemplo-8" class="section level3 unnumbered">
<h3>Ejemplo</h3>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="intervalos-de-confianza-y-remuestreo.html#cb198-1"></a><span class="co"># Ventajas de rsample</span></span>
<span id="cb198-2"><a href="intervalos-de-confianza-y-remuestreo.html#cb198-2"></a><span class="kw">library</span>(rsample)</span>
<span id="cb198-3"><a href="intervalos-de-confianza-y-remuestreo.html#cb198-3"></a></span>
<span id="cb198-4"><a href="intervalos-de-confianza-y-remuestreo.html#cb198-4"></a><span class="co"># Generamos 100 muestras bootstrap, y la función nos regresa un arreglo con 100 </span></span>
<span id="cb198-5"><a href="intervalos-de-confianza-y-remuestreo.html#cb198-5"></a><span class="co"># renglones, cada uno corresponde a una muestra bootstrap.</span></span>
<span id="cb198-6"><a href="intervalos-de-confianza-y-remuestreo.html#cb198-6"></a><span class="kw">set.seed</span>(<span class="dv">3897</span>)</span>
<span id="cb198-7"><a href="intervalos-de-confianza-y-remuestreo.html#cb198-7"></a>computos_boot &lt;-<span class="st"> </span><span class="kw">bootstraps</span>(propinas, <span class="dt">strata =</span> momento, <span class="dv">100</span>)</span>
<span id="cb198-8"><a href="intervalos-de-confianza-y-remuestreo.html#cb198-8"></a>computos_boot</span>
<span id="cb198-9"><a href="intervalos-de-confianza-y-remuestreo.html#cb198-9"></a><span class="co"># La columna splits tiene información de las muestras seleccionadas, para la </span></span>
<span id="cb198-10"><a href="intervalos-de-confianza-y-remuestreo.html#cb198-10"></a><span class="co"># primera vemos que de 234 observaciones en la muestra original la primera </span></span>
<span id="cb198-11"><a href="intervalos-de-confianza-y-remuestreo.html#cb198-11"></a><span class="co"># muestra bootstrap contiene 234-89=145.</span></span>
<span id="cb198-12"><a href="intervalos-de-confianza-y-remuestreo.html#cb198-12"></a></span>
<span id="cb198-13"><a href="intervalos-de-confianza-y-remuestreo.html#cb198-13"></a>first_computos_boot &lt;-<span class="st"> </span>computos_boot<span class="op">$</span>splits[[<span class="dv">1</span>]]</span>
<span id="cb198-14"><a href="intervalos-de-confianza-y-remuestreo.html#cb198-14"></a>first_computos_boot</span>
<span id="cb198-15"><a href="intervalos-de-confianza-y-remuestreo.html#cb198-15"></a><span class="co"># Los podemos extraer</span></span>
<span id="cb198-16"><a href="intervalos-de-confianza-y-remuestreo.html#cb198-16"></a><span class="kw">as_tibble</span>(first_computos_boot)</span>
<span id="cb198-17"><a href="intervalos-de-confianza-y-remuestreo.html#cb198-17"></a></span>
<span id="cb198-18"><a href="intervalos-de-confianza-y-remuestreo.html#cb198-18"></a><span class="co"># Una de las principales ventajas de usar este paquete es que es eficiente en el </span></span>
<span id="cb198-19"><a href="intervalos-de-confianza-y-remuestreo.html#cb198-19"></a><span class="co"># uso de memoria.</span></span>
<span id="cb198-20"><a href="intervalos-de-confianza-y-remuestreo.html#cb198-20"></a></span>
<span id="cb198-21"><a href="intervalos-de-confianza-y-remuestreo.html#cb198-21"></a><span class="kw">library</span>(pryr)</span>
<span id="cb198-22"><a href="intervalos-de-confianza-y-remuestreo.html#cb198-22"></a><span class="kw">object_size</span>(propinas)</span>
<span id="cb198-23"><a href="intervalos-de-confianza-y-remuestreo.html#cb198-23"></a><span class="kw">object_size</span>(computos_boot)</span>
<span id="cb198-24"><a href="intervalos-de-confianza-y-remuestreo.html#cb198-24"></a><span class="co"># tamaño por muestra</span></span>
<span id="cb198-25"><a href="intervalos-de-confianza-y-remuestreo.html#cb198-25"></a><span class="kw">object_size</span>(computos_boot)<span class="op">/</span><span class="kw">nrow</span>(computos_boot)</span>
<span id="cb198-26"><a href="intervalos-de-confianza-y-remuestreo.html#cb198-26"></a><span class="co"># el incremento en tamaño es &lt;&lt; 100</span></span>
<span id="cb198-27"><a href="intervalos-de-confianza-y-remuestreo.html#cb198-27"></a><span class="kw">as.numeric</span>(<span class="kw">object_size</span>(computos_boot)<span class="op">/</span><span class="kw">object_size</span>(propinas))</span></code></pre></div>
<p>Consideramos los datos de propinas. Queremos estimar la media de cuentas
totales para la comida y la cena. Podemos hacer bootstrap de cada grupo
por separado:</p>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="intervalos-de-confianza-y-remuestreo.html#cb199-1"></a><span class="co"># en este ejemplo usamos rsample, pero puedes</span></span>
<span id="cb199-2"><a href="intervalos-de-confianza-y-remuestreo.html#cb199-2"></a><span class="co"># escribir tu propio código</span></span>
<span id="cb199-3"><a href="intervalos-de-confianza-y-remuestreo.html#cb199-3"></a><span class="kw">library</span>(rsample)</span>
<span id="cb199-4"><a href="intervalos-de-confianza-y-remuestreo.html#cb199-4"></a>propinas &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/propinas.csv&quot;</span>)</span>
<span id="cb199-5"><a href="intervalos-de-confianza-y-remuestreo.html#cb199-5"></a>estimador &lt;-<span class="st"> </span><span class="cf">function</span>(split, ...){</span>
<span id="cb199-6"><a href="intervalos-de-confianza-y-remuestreo.html#cb199-6"></a>  muestra &lt;-<span class="st"> </span><span class="kw">analysis</span>(split) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(momento)</span>
<span id="cb199-7"><a href="intervalos-de-confianza-y-remuestreo.html#cb199-7"></a>  muestra <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb199-8"><a href="intervalos-de-confianza-y-remuestreo.html#cb199-8"></a><span class="st">    </span><span class="kw">summarise</span>(<span class="dt">estimate =</span> <span class="kw">mean</span>(cuenta_total), <span class="dt">.groups =</span> <span class="st">&#39;drop&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb199-9"><a href="intervalos-de-confianza-y-remuestreo.html#cb199-9"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">term =</span> momento)</span>
<span id="cb199-10"><a href="intervalos-de-confianza-y-remuestreo.html#cb199-10"></a>}</span>
<span id="cb199-11"><a href="intervalos-de-confianza-y-remuestreo.html#cb199-11"></a>intervalo_propinas_<span class="dv">90</span> &lt;-<span class="st"> </span><span class="kw">bootstraps</span>(propinas, <span class="dt">strata =</span> momento, <span class="dv">1000</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb199-12"><a href="intervalos-de-confianza-y-remuestreo.html#cb199-12"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">res_boot =</span> <span class="kw">map</span>(splits, estimador)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb199-13"><a href="intervalos-de-confianza-y-remuestreo.html#cb199-13"></a><span class="st">  </span><span class="kw">int_pctl</span>(res_boot, <span class="dt">alpha =</span> <span class="fl">0.10</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb199-14"><a href="intervalos-de-confianza-y-remuestreo.html#cb199-14"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="kw">across</span>(<span class="kw">where</span>(is.numeric), round, <span class="dv">2</span>))</span>
<span id="cb199-15"><a href="intervalos-de-confianza-y-remuestreo.html#cb199-15"></a>intervalo_propinas_<span class="dv">90</span></span></code></pre></div>
<pre><code>## # A tibble: 2 x 6
##   term   .lower .estimate .upper .alpha .method   
##   &lt;chr&gt;   &lt;dbl&gt;     &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;     
## 1 Cena     19.8      20.8   22.0    0.1 percentile
## 2 Comida   15.6      17.1   18.8    0.1 percentile</code></pre>
<p>Nota: <em>.estimate</em> es la media de los valores de la estadística sobre las
remuestras, <strong>no</strong> es el estimador original.</p>
<p>De la tabla anterior inferimos que la media en la cuenta en la cena es más
grande que la de la comida.
Podemos graficar agregando los estimadores plugin:</p>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="intervalos-de-confianza-y-remuestreo.html#cb201-1"></a>estimadores &lt;-<span class="st"> </span>propinas <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb201-2"><a href="intervalos-de-confianza-y-remuestreo.html#cb201-2"></a><span class="st">  </span><span class="kw">group_by</span>(momento) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb201-3"><a href="intervalos-de-confianza-y-remuestreo.html#cb201-3"></a><span class="st">  </span><span class="kw">rename</span>(<span class="dt">term =</span> momento) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb201-4"><a href="intervalos-de-confianza-y-remuestreo.html#cb201-4"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">media =</span> <span class="kw">mean</span>(cuenta_total))</span>
<span id="cb201-5"><a href="intervalos-de-confianza-y-remuestreo.html#cb201-5"></a></span>
<span id="cb201-6"><a href="intervalos-de-confianza-y-remuestreo.html#cb201-6"></a><span class="kw">ggplot</span>(intervalo_propinas_<span class="dv">90</span>, <span class="kw">aes</span>(<span class="dt">x =</span> term)) <span class="op">+</span></span>
<span id="cb201-7"><a href="intervalos-de-confianza-y-remuestreo.html#cb201-7"></a><span class="st">  </span><span class="kw">geom_linerange</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> .lower, <span class="dt">ymax =</span> .upper)) <span class="op">+</span></span>
<span id="cb201-8"><a href="intervalos-de-confianza-y-remuestreo.html#cb201-8"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> estimadores, <span class="kw">aes</span>(<span class="dt">y =</span> media), <span class="dt">colour =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">size =</span> <span class="dv">3</span>) <span class="op">+</span></span>
<span id="cb201-9"><a href="intervalos-de-confianza-y-remuestreo.html#cb201-9"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Momento&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Media de cuenta total (dólares)&quot;</span>) <span class="op">+</span></span>
<span id="cb201-10"><a href="intervalos-de-confianza-y-remuestreo.html#cb201-10"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;Intervalos de 90% para la media&quot;</span>)</span></code></pre></div>
<p><img src="06-remuestreo_files/figure-html/unnamed-chunk-48-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Nótese que el bootstrap lo hicimos por separado en cada momento del día (por eso
el argumento <em>strata</em> en la llamada a <strong>bootstraps</strong>):</p>

<div class="ejercicio">
Justifica el procedimiento de hacer el bootstrap separado para cada grupo. ¿Qué supuestos
acerca del muestreo se deben satisfacer? ¿Deben ser muestras aleatorias simples
de cada momento del día, por ejemplo? ¿Qué harías si no fuera así, por ejemplo, si
se escogieron al azar tickets de todos los disponibles en un periodo?
</div>

</div>
</div>
<div id="bootstrap-para-dos-muestras" class="section level2 unnumbered">
<h2>Bootstrap para dos muestras</h2>
<p>En el ejemplo anterior consideramos cómo hacer bootstrap cuando tenemos muestras
independientes. También podemos aplicarlo a estimadores que comparen directamente las
dos muestras:</p>
<div class="mathblock">
<p>
<strong>Bootstrap para comparar poblaciones</strong>. Dadas muestras independientes de tamaños <span class="math inline"><span class="math inline">\(m\)</span></span> y <span class="math inline"><span class="math inline">\(n\)</span></span> de dos poblaciones:
</p>
<ol style="list-style-type: decimal">
<li>
Extraer una remuestra de tamaño <span class="math inline"><span class="math inline">\(m\)</span></span> con reemplazo de la primera muestra y una remuestra separada de tamaño <span class="math inline"><span class="math inline">\(n\)</span></span> de la segunda muestra. Calcula la estadística que compara los dos grupos (por ejemplo, diferencia de medias)
</li>
<li>
Repetir este proceso muchas veces (por ejemplo, 1000 - 10000).
</li>
<li>
Construir la distribución bootstrap de la estadística. Examinar dispersión, sesgo y forma.
</li>
</ol>
</div>
<div id="ejemplo-9" class="section level3 unnumbered">
<h3>Ejemplo</h3>
<p>Supongamos que queremos comparar directamente la media de la cuenta total
en comida y cena. Podemos hacer:</p>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="intervalos-de-confianza-y-remuestreo.html#cb202-1"></a>estimador_dif &lt;-<span class="st"> </span><span class="cf">function</span>(split, ...){</span>
<span id="cb202-2"><a href="intervalos-de-confianza-y-remuestreo.html#cb202-2"></a>  muestra &lt;-<span class="st"> </span><span class="kw">analysis</span>(split) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(momento)</span>
<span id="cb202-3"><a href="intervalos-de-confianza-y-remuestreo.html#cb202-3"></a>  muestra <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb202-4"><a href="intervalos-de-confianza-y-remuestreo.html#cb202-4"></a><span class="st">    </span><span class="kw">summarise</span>(<span class="dt">estimate =</span> <span class="kw">mean</span>(cuenta_total), <span class="dt">.groups =</span> <span class="st">&quot;drop&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb202-5"><a href="intervalos-de-confianza-y-remuestreo.html#cb202-5"></a><span class="st">    </span><span class="kw">pivot_wider</span>(<span class="dt">names_from =</span> momento, <span class="dt">values_from =</span> estimate) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb202-6"><a href="intervalos-de-confianza-y-remuestreo.html#cb202-6"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">estimate =</span> Cena <span class="op">-</span><span class="st"> </span>Comida, <span class="dt">term =</span> <span class="st">&quot;diferencia&quot;</span>)</span>
<span id="cb202-7"><a href="intervalos-de-confianza-y-remuestreo.html#cb202-7"></a>}</span>
<span id="cb202-8"><a href="intervalos-de-confianza-y-remuestreo.html#cb202-8"></a>dist_boot &lt;-<span class="st"> </span><span class="kw">bootstraps</span>(propinas, <span class="dt">strata =</span> momento, <span class="dv">2000</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb202-9"><a href="intervalos-de-confianza-y-remuestreo.html#cb202-9"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">res_boot =</span> <span class="kw">map</span>(splits, estimador_dif)) </span>
<span id="cb202-10"><a href="intervalos-de-confianza-y-remuestreo.html#cb202-10"></a>g_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw">ggplot</span>(dist_boot <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">unnest</span>(res_boot), <span class="kw">aes</span>(<span class="dt">x =</span> estimate)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>(<span class="dt">bins =</span> <span class="dv">20</span>) <span class="op">+</span></span>
<span id="cb202-11"><a href="intervalos-de-confianza-y-remuestreo.html#cb202-11"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Diferencia Comida vs Cena&quot;</span>)</span>
<span id="cb202-12"><a href="intervalos-de-confianza-y-remuestreo.html#cb202-12"></a>g_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">ggplot</span>(dist_boot <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">unnest</span>(res_boot), <span class="kw">aes</span>(<span class="dt">sample =</span> estimate)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_qq</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_qq_line</span>(<span class="dt">colour =</span> <span class="st">&#39;red&#39;</span>)</span>
<span id="cb202-13"><a href="intervalos-de-confianza-y-remuestreo.html#cb202-13"></a>g_<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>g_<span class="dv">2</span></span></code></pre></div>
<p><img src="06-remuestreo_files/figure-html/unnamed-chunk-51-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>Y podemos calcular un intervalo de confianza para la diferencia de medias:</p>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="intervalos-de-confianza-y-remuestreo.html#cb203-1"></a>dist_boot <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">int_pctl</span>(res_boot, <span class="dt">alpha =</span> <span class="fl">0.01</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb203-2"><a href="intervalos-de-confianza-y-remuestreo.html#cb203-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="kw">across</span>(<span class="kw">where</span>(is.numeric), round, <span class="dv">2</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb203-3"><a href="intervalos-de-confianza-y-remuestreo.html#cb203-3"></a><span class="st">  </span><span class="kw">select</span>(term, .lower, .upper)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 3
##   term       .lower .upper
##   &lt;chr&gt;       &lt;dbl&gt;  &lt;dbl&gt;
## 1 diferencia    0.9   6.46</code></pre>
<p>Que nos indica que con alta probabilidad las cuentas son más altas que en la cena
que en la comida. La diferencia puede ir de un poco menos de un dólar hasta seis dólares
con 99% de confianza.</p>
</div>
<div id="datos-pareados" class="section level3 unnumbered">
<h3>Datos pareados</h3>
<p>En otros casos, las muestras no son independientes y están pareadas. Por ejemplo, este es un estudio
dende a 10 personas una noche se les dio una medicina para dormir y otra noche otra medicina.
Se registraron cuántas horas de sueño extra comparados con un día donde no tomaron medicina.</p>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="intervalos-de-confianza-y-remuestreo.html#cb205-1"></a>dormir &lt;-<span class="st"> </span>sleep <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb205-2"><a href="intervalos-de-confianza-y-remuestreo.html#cb205-2"></a><span class="st">  </span><span class="kw">pivot_wider</span>(<span class="dt">names_from =</span> group, </span>
<span id="cb205-3"><a href="intervalos-de-confianza-y-remuestreo.html#cb205-3"></a>              <span class="dt">names_prefix =</span> <span class="st">&quot;medicina_&quot;</span>,</span>
<span id="cb205-4"><a href="intervalos-de-confianza-y-remuestreo.html#cb205-4"></a>              <span class="dt">values_from =</span> extra)</span>
<span id="cb205-5"><a href="intervalos-de-confianza-y-remuestreo.html#cb205-5"></a>dormir</span></code></pre></div>
<pre><code>## # A tibble: 10 x 3
##    ID    medicina_1 medicina_2
##    &lt;fct&gt;      &lt;dbl&gt;      &lt;dbl&gt;
##  1 1            0.7        1.9
##  2 2           -1.6        0.8
##  3 3           -0.2        1.1
##  4 4           -1.2        0.1
##  5 5           -0.1       -0.1
##  6 6            3.4        4.4
##  7 7            3.7        5.5
##  8 8            0.8        1.6
##  9 9            0          4.6
## 10 10           2          3.4</code></pre>
<p>En este caso, el bootstrap se hace sobre individuos, y quisiéramos comparar
la medición de la medicina_1 con la medicina_2. Usaremos la media de al diferencia
entre horas de sueño entre las dos medicinas. Nuestro estimador puntual es:</p>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="intervalos-de-confianza-y-remuestreo.html#cb207-1"></a>estimador_dif &lt;-<span class="st"> </span>dormir <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb207-2"><a href="intervalos-de-confianza-y-remuestreo.html#cb207-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">dif_2_menos_1 =</span> medicina_<span class="dv">2</span> <span class="op">-</span><span class="st"> </span>medicina_<span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb207-3"><a href="intervalos-de-confianza-y-remuestreo.html#cb207-3"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">dif_media =</span> <span class="kw">mean</span>(dif_<span class="dv">2</span>_menos_<span class="dv">1</span>))</span>
<span id="cb207-4"><a href="intervalos-de-confianza-y-remuestreo.html#cb207-4"></a>estimador_dif</span></code></pre></div>
<pre><code>## # A tibble: 1 x 1
##   dif_media
##       &lt;dbl&gt;
## 1      1.58</code></pre>
<p>Esto indica que en promedio duermen hora y media más con la medicina 2 que con
la medicina 1. Como hay variabilildad considerable en el número de horas extra de
cada medicina dependiendo del individuo, es necesario hacer una intervalo de confianza
para descartar que esta diferencia haya aparecido por azar debido a la variación muestral.</p>
<p>Nótese que aquí no tenemos estratos, pues solo hay una muestra de individuo con
dos mediciones.</p>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="intervalos-de-confianza-y-remuestreo.html#cb209-1"></a>estimador_dif &lt;-<span class="st"> </span><span class="cf">function</span>(split, ...){</span>
<span id="cb209-2"><a href="intervalos-de-confianza-y-remuestreo.html#cb209-2"></a>  muestra &lt;-<span class="st"> </span><span class="kw">analysis</span>(split)</span>
<span id="cb209-3"><a href="intervalos-de-confianza-y-remuestreo.html#cb209-3"></a>  muestra <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb209-4"><a href="intervalos-de-confianza-y-remuestreo.html#cb209-4"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">dif_2_menos_1 =</span> medicina_<span class="dv">2</span> <span class="op">-</span><span class="st"> </span>medicina_<span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb209-5"><a href="intervalos-de-confianza-y-remuestreo.html#cb209-5"></a><span class="st">    </span><span class="kw">summarise</span>(<span class="dt">estimate =</span> <span class="kw">mean</span>(dif_<span class="dv">2</span>_menos_<span class="dv">1</span>), <span class="dt">.groups =</span> <span class="st">&quot;drop&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb209-6"><a href="intervalos-de-confianza-y-remuestreo.html#cb209-6"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">term =</span> <span class="st">&quot;diferencia 2 vs 1&quot;</span>)</span>
<span id="cb209-7"><a href="intervalos-de-confianza-y-remuestreo.html#cb209-7"></a>}</span>
<span id="cb209-8"><a href="intervalos-de-confianza-y-remuestreo.html#cb209-8"></a>dist_boot &lt;-<span class="st"> </span><span class="kw">bootstraps</span>(dormir,  <span class="dv">2000</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb209-9"><a href="intervalos-de-confianza-y-remuestreo.html#cb209-9"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">res_boot =</span> <span class="kw">map</span>(splits, estimador_dif)) </span>
<span id="cb209-10"><a href="intervalos-de-confianza-y-remuestreo.html#cb209-10"></a>g_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw">ggplot</span>(dist_boot <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">unnest</span>(res_boot), <span class="kw">aes</span>(<span class="dt">x =</span> estimate)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>(<span class="dt">bins =</span> <span class="dv">20</span>)</span>
<span id="cb209-11"><a href="intervalos-de-confianza-y-remuestreo.html#cb209-11"></a>g_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">ggplot</span>(dist_boot <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">unnest</span>(res_boot), <span class="kw">aes</span>(<span class="dt">sample =</span> estimate)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_qq</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_qq_line</span>(<span class="dt">colour =</span> <span class="st">&#39;red&#39;</span>)</span>
<span id="cb209-12"><a href="intervalos-de-confianza-y-remuestreo.html#cb209-12"></a>g_<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>g_<span class="dv">2</span></span></code></pre></div>
<p><img src="06-remuestreo_files/figure-html/unnamed-chunk-55-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>Nuestro intervalo de percentiles al 90% es de</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="intervalos-de-confianza-y-remuestreo.html#cb210-1"></a>dist_boot <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">int_pctl</span>(res_boot, <span class="fl">0.10</span>)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 6
##   term              .lower .estimate .upper .alpha .method   
##   &lt;chr&gt;              &lt;dbl&gt;     &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;     
## 1 diferencia 2 vs 1   1.04      1.57    2.2    0.1 percentile</code></pre>
<p>Lo que indica con alta probabilidad que la medicina 2 da entre 1 y 2 horas extras de sueño. Nota
que en este ejemplo también podríamos hacer una prueba de hipótesis por permutaciones,
suponiendo como hipótesis nula que las dos medicinas son equivalentes. Sin embargo, usualmente
es más informativo presentar este tipo de intervalos para estimar la diferencia.</p>
</div>
</div>
<div id="bootstrap-y-otras-estadísticas" class="section level2 unnumbered">
<h2>Bootstrap y otras estadísticas</h2>
<p>El bootstrap es una técnica versátil. Un ejemplo son <strong>estimadores de razón</strong>, que tienen
la forma</p>
<p><span class="math display">\[ \hat{r} = \frac{\overline y}{\overline x}\]</span>
Por ejemplo, ¿cómo haríamos estimación para el procentaje de área area habitable
de las casas en relación al tamaño del lote? Una manera de estimar esta cantidad
es dividiendo la suma del área habitable de nuestra muestra y dividirlo entre
la suma del área de los lotes de nuestra muestra, como en la fórmula anterior. Esta
fórmula es más difícil pues tanto numerador como denominador tienen variabilidad,
y estas dos cantidades no varían independientemente.</p>
<p>Con el bootstrap podemos atacar estos problemas</p>
<div id="ejemplo-estimadores-de-razón" class="section level3 unnumbered">
<h3>Ejemplo: estimadores de razón</h3>
<p>Nuestra muestra original es:</p>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="intervalos-de-confianza-y-remuestreo.html#cb212-1"></a><span class="kw">set.seed</span>(<span class="dv">250</span>)</span>
<span id="cb212-2"><a href="intervalos-de-confianza-y-remuestreo.html#cb212-2"></a>casas_muestra &lt;-<span class="st"> </span><span class="kw">sample_n</span>(poblacion_casas, <span class="dv">200</span>)</span></code></pre></div>
<p>El estimador de interés es:</p>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb213-1"><a href="intervalos-de-confianza-y-remuestreo.html#cb213-1"></a>estimador_razon &lt;-<span class="st"> </span><span class="cf">function</span>(split, ...){</span>
<span id="cb213-2"><a href="intervalos-de-confianza-y-remuestreo.html#cb213-2"></a>  muestra &lt;-<span class="st"> </span><span class="kw">analysis</span>(split)</span>
<span id="cb213-3"><a href="intervalos-de-confianza-y-remuestreo.html#cb213-3"></a>  muestra <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb213-4"><a href="intervalos-de-confianza-y-remuestreo.html#cb213-4"></a><span class="st">    </span><span class="kw">summarise</span>(<span class="dt">estimate =</span> <span class="kw">sum</span>(area_habitable_sup_m2) <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(area_lote_m2), <span class="dt">.groups =</span> <span class="st">&quot;drop&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb213-5"><a href="intervalos-de-confianza-y-remuestreo.html#cb213-5"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">term =</span> <span class="st">&quot;% area del lote construida&quot;</span>)</span>
<span id="cb213-6"><a href="intervalos-de-confianza-y-remuestreo.html#cb213-6"></a>}</span></code></pre></div>
<p>Y nuestra estimación puntual es</p>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="intervalos-de-confianza-y-remuestreo.html#cb214-1"></a>estimador &lt;-<span class="st"> </span>muestra_casas <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarise</span>(<span class="dt">estimate =</span> <span class="kw">sum</span>(area_habitable_sup_m2) <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(area_lote_m2))</span>
<span id="cb214-2"><a href="intervalos-de-confianza-y-remuestreo.html#cb214-2"></a>estimador</span></code></pre></div>
<pre><code>## # A tibble: 1 x 1
##   estimate
##      &lt;dbl&gt;
## 1    0.148</code></pre>
<p>Es decir que en promedio, un poco más de 15% del lote total es ocupado por área habitable.
Ahora hacemos bootstrap para construir un intervalo:</p>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="intervalos-de-confianza-y-remuestreo.html#cb216-1"></a>dist_boot &lt;-<span class="st"> </span><span class="kw">bootstraps</span>(casas_muestra,  <span class="dv">2000</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb216-2"><a href="intervalos-de-confianza-y-remuestreo.html#cb216-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">res_boot =</span> <span class="kw">map</span>(splits, estimador_razon)) </span>
<span id="cb216-3"><a href="intervalos-de-confianza-y-remuestreo.html#cb216-3"></a>g_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw">ggplot</span>(dist_boot <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">unnest</span>(res_boot), <span class="kw">aes</span>(<span class="dt">x =</span> estimate)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>(<span class="dt">bins =</span> <span class="dv">20</span>)</span>
<span id="cb216-4"><a href="intervalos-de-confianza-y-remuestreo.html#cb216-4"></a>g_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">ggplot</span>(dist_boot <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">unnest</span>(res_boot), <span class="kw">aes</span>(<span class="dt">sample =</span> estimate)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_qq</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_qq_line</span>(<span class="dt">colour =</span> <span class="st">&#39;red&#39;</span>)</span>
<span id="cb216-5"><a href="intervalos-de-confianza-y-remuestreo.html#cb216-5"></a>g_<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>g_<span class="dv">2</span></span></code></pre></div>
<p><img src="06-remuestreo_files/figure-html/unnamed-chunk-60-1.png" width="768" style="display: block; margin: auto;" /></p>
<p>En este caso la cola derecha parece tener menos dispersión que una distribución normal.
Usamos un intervalo de percentiles para obtener:</p>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb217-1"><a href="intervalos-de-confianza-y-remuestreo.html#cb217-1"></a>dist_boot <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">int_pctl</span>(res_boot) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb217-2"><a href="intervalos-de-confianza-y-remuestreo.html#cb217-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">estimador =</span> estimador<span class="op">$</span>estimate) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb217-3"><a href="intervalos-de-confianza-y-remuestreo.html#cb217-3"></a><span class="st">  </span><span class="kw">rename</span>(<span class="dt">media_boot =</span> .estimate) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb217-4"><a href="intervalos-de-confianza-y-remuestreo.html#cb217-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">bias =</span> media_boot <span class="op">-</span><span class="st"> </span>estimador) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb217-5"><a href="intervalos-de-confianza-y-remuestreo.html#cb217-5"></a><span class="st">  </span><span class="kw">pivot_longer</span>(is_numeric) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb217-6"><a href="intervalos-de-confianza-y-remuestreo.html#cb217-6"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">value =</span> <span class="kw">round</span>(value, <span class="dv">3</span>))</span></code></pre></div>
<pre><code>## # A tibble: 6 x 4
##   term                       .method    name        value
##   &lt;chr&gt;                      &lt;chr&gt;      &lt;chr&gt;       &lt;dbl&gt;
## 1 % area del lote construida percentile .lower      0.121
## 2 % area del lote construida percentile media_boot  0.142
## 3 % area del lote construida percentile .upper      0.159
## 4 % area del lote construida percentile .alpha      0.05 
## 5 % area del lote construida percentile estimador   0.148
## 6 % area del lote construida percentile bias       -0.006</code></pre>
<p>Nótese que el sesgo es bajo.
De modo que en esta zona, entre 12% y 16% de toda el área disponible es ocupada por
área habitable: estas son casas que tienen jardines o terrenos, garage relativamente grandes.</p>
</div>
<div id="ejemplo-suavizadores" class="section level3 unnumbered">
<h3>Ejemplo: suavizadores</h3>
<p>Podemos usar el bootstrap para juzgar
la variabilidad de un suavizador, que consideramos como nuestra
estadística:</p>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb219-1"><a href="intervalos-de-confianza-y-remuestreo.html#cb219-1"></a>graf_casas &lt;-<span class="st"> </span><span class="cf">function</span>(data){</span>
<span id="cb219-2"><a href="intervalos-de-confianza-y-remuestreo.html#cb219-2"></a>    <span class="kw">ggplot</span>(data <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(calidad_gral <span class="op">&lt;</span><span class="st"> </span><span class="dv">7</span>), </span>
<span id="cb219-3"><a href="intervalos-de-confianza-y-remuestreo.html#cb219-3"></a>        <span class="kw">aes</span>(<span class="dt">x =</span> area_habitable_sup_m2)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb219-4"><a href="intervalos-de-confianza-y-remuestreo.html#cb219-4"></a><span class="st">        </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">y =</span> precio_m2_miles), <span class="dt">alpha =</span> <span class="fl">0.75</span>) <span class="op">+</span></span>
<span id="cb219-5"><a href="intervalos-de-confianza-y-remuestreo.html#cb219-5"></a><span class="st">        </span><span class="kw">geom_smooth</span>(<span class="kw">aes</span>(<span class="dt">y =</span> precio_m2_miles), <span class="dt">method =</span> <span class="st">&quot;loess&quot;</span>, <span class="dt">span =</span> <span class="fl">0.7</span>, </span>
<span id="cb219-6"><a href="intervalos-de-confianza-y-remuestreo.html#cb219-6"></a>                <span class="dt">se =</span> <span class="ot">FALSE</span>, <span class="dt">method.args =</span> <span class="kw">list</span>(<span class="dt">degree =</span> <span class="dv">1</span>, <span class="dt">family =</span> <span class="st">&quot;symmetric&quot;</span>))     </span>
<span id="cb219-7"><a href="intervalos-de-confianza-y-remuestreo.html#cb219-7"></a>}</span>
<span id="cb219-8"><a href="intervalos-de-confianza-y-remuestreo.html#cb219-8"></a><span class="kw">graf_casas</span>(muestra_casas)</span></code></pre></div>
<p><img src="06-remuestreo_files/figure-html/unnamed-chunk-62-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>Podemos hacer bootstrap para juzgar la estabilidad del suavizador:</p>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="intervalos-de-confianza-y-remuestreo.html#cb220-1"></a>suaviza_boot &lt;-<span class="st"> </span><span class="cf">function</span>(x, data){</span>
<span id="cb220-2"><a href="intervalos-de-confianza-y-remuestreo.html#cb220-2"></a>    <span class="co"># remuestreo</span></span>
<span id="cb220-3"><a href="intervalos-de-confianza-y-remuestreo.html#cb220-3"></a>    muestra_boot &lt;-<span class="st"> </span><span class="kw">sample_n</span>(data, <span class="kw">nrow</span>(data), <span class="dt">replace =</span> T)</span>
<span id="cb220-4"><a href="intervalos-de-confianza-y-remuestreo.html#cb220-4"></a>    ajuste &lt;-<span class="st"> </span><span class="kw">loess</span>(precio_m2_miles <span class="op">~</span><span class="st"> </span>area_habitable_sup_m2, <span class="dt">data =</span> muestra_boot, </span>
<span id="cb220-5"><a href="intervalos-de-confianza-y-remuestreo.html#cb220-5"></a>                    <span class="dt">degree =</span> <span class="dv">1</span>, <span class="dt">span =</span> <span class="fl">0.7</span>, <span class="dt">family =</span> <span class="st">&quot;symmetric&quot;</span>)</span>
<span id="cb220-6"><a href="intervalos-de-confianza-y-remuestreo.html#cb220-6"></a>    datos_grafica &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">area_habitable_sup_m2 =</span> <span class="kw">seq</span>(<span class="dv">25</span>, <span class="dv">250</span>, <span class="dv">5</span>))</span>
<span id="cb220-7"><a href="intervalos-de-confianza-y-remuestreo.html#cb220-7"></a>    ajustados &lt;-<span class="st"> </span><span class="kw">predict</span>(ajuste, <span class="dt">newdata =</span> datos_grafica)</span>
<span id="cb220-8"><a href="intervalos-de-confianza-y-remuestreo.html#cb220-8"></a>    datos_grafica <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">ajustados =</span> ajustados) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb220-9"><a href="intervalos-de-confianza-y-remuestreo.html#cb220-9"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">rep =</span> x)</span>
<span id="cb220-10"><a href="intervalos-de-confianza-y-remuestreo.html#cb220-10"></a>}</span>
<span id="cb220-11"><a href="intervalos-de-confianza-y-remuestreo.html#cb220-11"></a>reps &lt;-<span class="st"> </span><span class="kw">map</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="op">~</span><span class="st"> </span><span class="kw">suaviza_boot</span>(.x, casas_muestra <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(calidad_gral <span class="op">&lt;</span><span class="st"> </span><span class="dv">7</span>))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb220-12"><a href="intervalos-de-confianza-y-remuestreo.html#cb220-12"></a><span class="st">    </span><span class="kw">bind_rows</span>()</span></code></pre></div>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb221-1"><a href="intervalos-de-confianza-y-remuestreo.html#cb221-1"></a><span class="co"># ojo: la rutina loess no tienen soporte para extrapolación</span></span>
<span id="cb221-2"><a href="intervalos-de-confianza-y-remuestreo.html#cb221-2"></a><span class="kw">graf_casas</span>(casas_muestra) <span class="op">+</span><span class="st"> </span></span>
<span id="cb221-3"><a href="intervalos-de-confianza-y-remuestreo.html#cb221-3"></a><span class="st">    </span><span class="kw">geom_line</span>(<span class="dt">data =</span> reps, <span class="kw">aes</span>(<span class="dt">y =</span> ajustados, <span class="dt">group =</span> rep), <span class="dt">alpha =</span> <span class="dv">1</span>, <span class="dt">colour =</span> <span class="st">&quot;red&quot;</span>) </span></code></pre></div>
<p><img src="06-remuestreo_files/figure-html/unnamed-chunk-64-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Donde vemos que algunas cambios de pendiente del suavizador original no son muy interpretables (por ejemplo,
para áreas chicas) y alta variabilidad en general en los extremos. Podemos hacer más iteraciones para calcular bandas de confianza:</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="intervalos-de-confianza-y-remuestreo.html#cb222-1"></a>reps &lt;-<span class="st"> </span><span class="kw">map</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">200</span>, <span class="op">~</span><span class="st"> </span><span class="kw">suaviza_boot</span>(.x, casas_muestra <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(calidad_gral <span class="op">&lt;</span><span class="st"> </span><span class="dv">7</span>))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb222-2"><a href="intervalos-de-confianza-y-remuestreo.html#cb222-2"></a><span class="st">    </span><span class="kw">bind_rows</span>()</span>
<span id="cb222-3"><a href="intervalos-de-confianza-y-remuestreo.html#cb222-3"></a><span class="co"># ojo: la rutina loess no tienen soporte para extrapolación</span></span>
<span id="cb222-4"><a href="intervalos-de-confianza-y-remuestreo.html#cb222-4"></a><span class="kw">graf_casas</span>(casas_muestra) <span class="op">+</span><span class="st"> </span></span>
<span id="cb222-5"><a href="intervalos-de-confianza-y-remuestreo.html#cb222-5"></a><span class="st">    </span><span class="kw">geom_line</span>(<span class="dt">data =</span> reps, <span class="kw">aes</span>(<span class="dt">y =</span> ajustados, <span class="dt">group =</span> rep), <span class="dt">alpha =</span> <span class="fl">0.2</span>, <span class="dt">colour =</span> <span class="st">&quot;red&quot;</span>) </span></code></pre></div>
<p><img src="06-remuestreo_files/figure-html/unnamed-chunk-65-1.png" width="672" style="display: block; margin: auto;" />
Donde observamos cómo tenemos incertidumbre en cuanto al nivel y forma de las curvas
en los extremos de los datos (casas grandes y chicas), lo cual es natural. Aunque podemos
resumir para hacer bandas de confianza, mostrar remuestras de esta manera es informativo: por ejempo:
vemos cómo es probable también que para casas de emnos de 70 metros cuadrados el precio por
metro cuadrado no cambia tanto (líneas constantes)</p>
</div>
</div>
<div id="bootstrap-y-estimadores-complejos-tablas-de-perfiles" class="section level2 unnumbered">
<h2>Bootstrap y estimadores complejos: tablas de perfiles</h2>
<p>Podemos regresar al ejemplo de la primera sesión donde calculamos perfiles de los tomadores
de distintos tés: en bolsa, suelto, o combinados. Caundo hacemos estos tipos de análisis
no es raro que los prefiles tengan variabilidad considerable que es necesario cuantificar.</p>
<table class="table table-hover table-condensed" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
price
</th>
<th style="text-align:left;">
tea bag
</th>
<th style="text-align:left;">
tea bag+unpackaged
</th>
<th style="text-align:left;">
unpackaged
</th>
<th style="text-align:right;">
promedio
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
p_upscale
</td>
<td style="text-align:left;">
<span style="     color: red !important;">-0.71</span>
</td>
<td style="text-align:left;">
<span style="     color: red !important;">-0.28</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;">0.98</span>
</td>
<td style="text-align:right;">
28
</td>
</tr>
<tr>
<td style="text-align:left;">
p_variable
</td>
<td style="text-align:left;">
<span style="     color: lightgray !important;">-0.12</span>
</td>
<td style="text-align:left;">
<span style="     color: black !important;">0.44</span>
</td>
<td style="text-align:left;">
<span style="     color: red !important;">-0.31</span>
</td>
<td style="text-align:right;">
36
</td>
</tr>
<tr>
<td style="text-align:left;">
p_cheap
</td>
<td style="text-align:left;">
<span style="     color: black !important;">0.3</span>
</td>
<td style="text-align:left;">
<span style="     color: red !important;">-0.53</span>
</td>
<td style="text-align:left;">
<span style="     color: lightgray !important;">0.23</span>
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:left;">
p_branded
</td>
<td style="text-align:left;">
<span style="     color: black !important;">0.62</span>
</td>
<td style="text-align:left;">
<span style="     color: lightgray !important;">-0.16</span>
</td>
<td style="text-align:left;">
<span style="     color: red !important;">-0.45</span>
</td>
<td style="text-align:right;">
25
</td>
</tr>
<tr>
<td style="text-align:left;">
p_private label
</td>
<td style="text-align:left;">
<span style="     color: black !important;">0.72</span>
</td>
<td style="text-align:left;">
<span style="     color: lightgray !important;">-0.22</span>
</td>
<td style="text-align:left;">
<span style="     color: red !important;">-0.49</span>
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:left;">
p_unknown
</td>
<td style="text-align:left;">
<span style="     color: black !important;">1.58</span>
</td>
<td style="text-align:left;">
<span style="     color: red !important;">-0.58</span>
</td>
<td style="text-align:left;">
<span style="     color: red !important;">-1</span>
</td>
<td style="text-align:right;">
3
</td>
</tr>
</tbody>
</table>
<p><img src="06-remuestreo_files/figure-html/unnamed-chunk-69-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>Hacemos bootstrap sobre toda la muestra, y repetimos exactamente el mismo proceso
de construción de perfiles:</p>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb223-1"><a href="intervalos-de-confianza-y-remuestreo.html#cb223-1"></a>boot_perfiles &lt;-<span class="st"> </span><span class="kw">map</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">1000</span>, <span class="cf">function</span>(x){</span>
<span id="cb223-2"><a href="intervalos-de-confianza-y-remuestreo.html#cb223-2"></a>    te_boot &lt;-<span class="st"> </span>te <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">sample_n</span>(<span class="kw">nrow</span>(te), <span class="dt">replace =</span> <span class="ot">TRUE</span>)</span>
<span id="cb223-3"><a href="intervalos-de-confianza-y-remuestreo.html#cb223-3"></a>    <span class="kw">calcular_perfiles</span>(te_boot) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">rep =</span> x)</span>
<span id="cb223-4"><a href="intervalos-de-confianza-y-remuestreo.html#cb223-4"></a>}) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">bind_rows</span>()</span></code></pre></div>
<p>Ahora resumimos y graficamos, esta vez de manera distinta:</p>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="intervalos-de-confianza-y-remuestreo.html#cb224-1"></a>resumen_perfiles &lt;-<span class="st"> </span>boot_perfiles <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(how, price) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb224-2"><a href="intervalos-de-confianza-y-remuestreo.html#cb224-2"></a><span class="st">    </span><span class="kw">summarise</span>(<span class="dt">perfil_media =</span> <span class="kw">mean</span>(perfil), <span class="dt">ymax =</span> <span class="kw">quantile</span>(perfil, <span class="fl">0.9</span>), <span class="dt">ymin =</span> <span class="kw">quantile</span>(perfil, <span class="fl">0.10</span>)) </span>
<span id="cb224-3"><a href="intervalos-de-confianza-y-remuestreo.html#cb224-3"></a>resumen_bolsa &lt;-<span class="st"> </span>resumen_perfiles <span class="op">%&gt;%</span><span class="st"> </span>ungroup <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb224-4"><a href="intervalos-de-confianza-y-remuestreo.html#cb224-4"></a><span class="st">    </span><span class="kw">filter</span>(how <span class="op">==</span><span class="st"> &quot;tea bag&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(price, <span class="dt">perfil_bolsa =</span> perfil_media)</span>
<span id="cb224-5"><a href="intervalos-de-confianza-y-remuestreo.html#cb224-5"></a>resumen_perfiles &lt;-<span class="st"> </span>resumen_perfiles <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">left_join</span>(resumen_bolsa) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb224-6"><a href="intervalos-de-confianza-y-remuestreo.html#cb224-6"></a><span class="st">    </span>ungroup <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb224-7"><a href="intervalos-de-confianza-y-remuestreo.html#cb224-7"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">price =</span> <span class="kw">fct_reorder</span>(price, perfil_bolsa))</span>
<span id="cb224-8"><a href="intervalos-de-confianza-y-remuestreo.html#cb224-8"></a><span class="kw">ggplot</span>(resumen_perfiles, <span class="kw">aes</span>(<span class="dt">x =</span> price, <span class="dt">y =</span> perfil_media, <span class="dt">ymax =</span> ymax, <span class="dt">ymin =</span> ymin)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb224-9"><a href="intervalos-de-confianza-y-remuestreo.html#cb224-9"></a><span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">colour =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">geom_linerange</span>() <span class="op">+</span></span>
<span id="cb224-10"><a href="intervalos-de-confianza-y-remuestreo.html#cb224-10"></a><span class="st">    </span><span class="kw">facet_wrap</span>(<span class="op">~</span>how) <span class="op">+</span><span class="st"> </span><span class="kw">coord_flip</span>() <span class="op">+</span></span>
<span id="cb224-11"><a href="intervalos-de-confianza-y-remuestreo.html#cb224-11"></a><span class="st">    </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">0</span>, <span class="dt">colour =</span> <span class="st">&quot;gray&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Perfil&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;Precio&quot;</span>)</span></code></pre></div>
<p><img src="06-remuestreo_files/figure-html/unnamed-chunk-71-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>Nótese una deficiencia clara del bootstrap: para los que compran té suelto,
en la muestra no existen personas
que desconocen de dónde provienen su té (No sabe/No contestó).
Esto produce un intervalo colapsado en 0 que no es razonable.</p>
<p>Podemos remediar esto de varias maneras: quitando del análisis los que no sabe o no contestaron, agrupando en otra categoría, usando un modelo, o regularizar usando proporciones calculadas con conteos modificados: por ejemplo, agregando un caso de cada combinación (agregaría 18 personas “falsas” a una muestra de 290 personas).</p>
</div>
<div id="bootstrap-y-muestras-complejas" class="section level2 unnumbered">
<h2>Bootstrap y muestras complejas</h2>
<p>La necesidad de estimaciones confiables junto con el uso eficiente de recursos
conllevan a diseños de muestras complejas. Estos diseños típicamente usan las
siguientes técnicas: muestreo sin reemplazo de una población finita, muestreo
sistemático, estratificación, conglomerados, ajustes a no-respuesta,
postestratificación. Como consecuencia, los valores de la muestra suelen no ser
independientes y los análisis de los mismos dependerá del diseño de la muestra.
Comenzaremos con definiciones para entender el problema.</p>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="intervalos-de-confianza-y-remuestreo.html#cb225-1"></a><span class="kw">set.seed</span>(<span class="dv">3872999</span>)</span>
<span id="cb225-2"><a href="intervalos-de-confianza-y-remuestreo.html#cb225-2"></a>n_escuelas &lt;-<span class="st"> </span><span class="dv">5000</span></span>
<span id="cb225-3"><a href="intervalos-de-confianza-y-remuestreo.html#cb225-3"></a></span>
<span id="cb225-4"><a href="intervalos-de-confianza-y-remuestreo.html#cb225-4"></a>tipo &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(<span class="st">&quot;rural&quot;</span>, <span class="st">&quot;urbano&quot;</span>, <span class="st">&quot;indigena&quot;</span>), n_escuelas, <span class="dt">replace =</span> <span class="ot">TRUE</span>, </span>
<span id="cb225-5"><a href="intervalos-de-confianza-y-remuestreo.html#cb225-5"></a>    <span class="dt">prob =</span> <span class="kw">c</span>(<span class="fl">0.3</span>, <span class="fl">0.5</span>, <span class="fl">0.2</span>))</span>
<span id="cb225-6"><a href="intervalos-de-confianza-y-remuestreo.html#cb225-6"></a></span>
<span id="cb225-7"><a href="intervalos-de-confianza-y-remuestreo.html#cb225-7"></a>escuela &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">ind_escuela =</span> <span class="dv">1</span><span class="op">:</span>n_escuelas, tipo, </span>
<span id="cb225-8"><a href="intervalos-de-confianza-y-remuestreo.html#cb225-8"></a>    <span class="dt">media_tipo =</span> <span class="kw">case_when</span>(tipo <span class="op">==</span><span class="st"> &quot;urbano&quot;</span> <span class="op">~</span><span class="st"> </span><span class="dv">550</span>, tipo <span class="op">==</span><span class="st"> &quot;rural&quot;</span> <span class="op">~</span><span class="st"> </span><span class="dv">400</span>, <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span><span class="dv">350</span>), </span>
<span id="cb225-9"><a href="intervalos-de-confianza-y-remuestreo.html#cb225-9"></a>    <span class="dt">media_escuela =</span> <span class="kw">rnorm</span>(n_escuelas, media_tipo, <span class="dv">30</span>), </span>
<span id="cb225-10"><a href="intervalos-de-confianza-y-remuestreo.html#cb225-10"></a>    <span class="dt">n_estudiantes =</span> <span class="kw">round</span>(<span class="kw">rnorm</span>(n_escuelas, <span class="dv">30</span>, <span class="dv">4</span>)))</span>
<span id="cb225-11"><a href="intervalos-de-confianza-y-remuestreo.html#cb225-11"></a></span>
<span id="cb225-12"><a href="intervalos-de-confianza-y-remuestreo.html#cb225-12"></a>estudiantes &lt;-<span class="st"> </span><span class="kw">uncount</span>(escuela, n_estudiantes) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb225-13"><a href="intervalos-de-confianza-y-remuestreo.html#cb225-13"></a><span class="st">    </span><span class="kw">rowwise</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb225-14"><a href="intervalos-de-confianza-y-remuestreo.html#cb225-14"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">calif =</span> <span class="kw">rnorm</span>(<span class="dv">1</span>, media_escuela, <span class="dv">70</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb225-15"><a href="intervalos-de-confianza-y-remuestreo.html#cb225-15"></a><span class="st">    </span><span class="kw">ungroup</span>()</span></code></pre></div>
<p>Imaginemos que tenemos una población de 5000,
y queremos estimar la media de las calificaciones de los estudiantes en una prueba.</p>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb226-1"><a href="intervalos-de-confianza-y-remuestreo.html#cb226-1"></a><span class="kw">head</span>(estudiantes)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 5
##   ind_escuela tipo   media_tipo media_escuela calif
##         &lt;int&gt; &lt;chr&gt;       &lt;dbl&gt;         &lt;dbl&gt; &lt;dbl&gt;
## 1           1 urbano        550          561.  488.
## 2           1 urbano        550          561.  574.
## 3           1 urbano        550          561.  456.
## 4           1 urbano        550          561.  507.
## 5           1 urbano        550          561.  598.
## 6           1 urbano        550          561.  527.</code></pre>
<p>La primera idea sería tomar una muestra aleatoria (MAS, muestreo aleatorio simple),
donde todos los estudiantes tienen igual probabilidad de ser seleccionados. Con
estas condiciones el presupuesto alcanza para seleccionar a 60 estudiantes, hacemos
esto y calculamos la media.</p>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb228-1"><a href="intervalos-de-confianza-y-remuestreo.html#cb228-1"></a>muestra &lt;-<span class="st"> </span><span class="kw">sample_n</span>(estudiantes, <span class="dv">60</span>)</span>
<span id="cb228-2"><a href="intervalos-de-confianza-y-remuestreo.html#cb228-2"></a><span class="kw">round</span>(<span class="kw">mean</span>(muestra<span class="op">$</span>calif), <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] 466.73</code></pre>
<p>Este número es muy cercano a la media verdadera de la población:
466.51, pero esta es una de muchas posibles muestras.</p>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb230-1"><a href="intervalos-de-confianza-y-remuestreo.html#cb230-1"></a>medias_mas &lt;-<span class="st"> </span><span class="kw">rerun</span>(<span class="dv">1000</span>, <span class="kw">mean</span>(<span class="kw">sample_n</span>(estudiantes, <span class="dv">60</span>)<span class="op">$</span>calif)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb230-2"><a href="intervalos-de-confianza-y-remuestreo.html#cb230-2"></a><span class="st">    </span><span class="kw">flatten_dbl</span>()</span>
<span id="cb230-3"><a href="intervalos-de-confianza-y-remuestreo.html#cb230-3"></a><span class="kw">sd</span>(medias_mas)</span></code></pre></div>
<pre><code>## [1] 14.75242</code></pre>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb232-1"><a href="intervalos-de-confianza-y-remuestreo.html#cb232-1"></a>hist_mas &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="kw">tibble</span>(medias_mas), <span class="kw">aes</span>(<span class="dt">x =</span> medias_mas)) <span class="op">+</span></span>
<span id="cb232-2"><a href="intervalos-de-confianza-y-remuestreo.html#cb232-2"></a><span class="st">    </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="dv">10</span>) <span class="op">+</span></span>
<span id="cb232-3"><a href="intervalos-de-confianza-y-remuestreo.html#cb232-3"></a><span class="st">    </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="kw">mean</span>(estudiantes<span class="op">$</span>calif), <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span></span>
<span id="cb232-4"><a href="intervalos-de-confianza-y-remuestreo.html#cb232-4"></a><span class="st">    </span><span class="kw">xlim</span>(<span class="dv">410</span>, <span class="dv">520</span>)</span>
<span id="cb232-5"><a href="intervalos-de-confianza-y-remuestreo.html#cb232-5"></a>qq_mas &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="kw">tibble</span>(medias_mas), <span class="kw">aes</span>(<span class="dt">sample =</span> medias_mas)) <span class="op">+</span></span>
<span id="cb232-6"><a href="intervalos-de-confianza-y-remuestreo.html#cb232-6"></a><span class="st">    </span><span class="kw">geom_qq</span>(<span class="dt">distribution =</span> stats<span class="op">::</span>qunif) <span class="op">+</span></span>
<span id="cb232-7"><a href="intervalos-de-confianza-y-remuestreo.html#cb232-7"></a><span class="st">    </span><span class="kw">ylim</span>(<span class="dv">410</span>, <span class="dv">520</span>)</span>
<span id="cb232-8"><a href="intervalos-de-confianza-y-remuestreo.html#cb232-8"></a></span>
<span id="cb232-9"><a href="intervalos-de-confianza-y-remuestreo.html#cb232-9"></a>hist_mas <span class="op">+</span><span class="st"> </span>qq_mas</span></code></pre></div>
<p><img src="06-remuestreo_files/figure-html/unnamed-chunk-76-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Algunas de las muestras generan valores alejados de la verdadera media, para minimizar
la probabilidad de seleccionar muestras que lleven a estimaciones alejadas del
verdadero valor poblacional podríamos tomar muestras más grandes.</p>
<p>Pero usualmente los costos limitan el tamaño de muestra. Una alternativa es
estratificar, supongamos que sabemos el tipo de cada escuela (urbana, rural o
indígena) y sabemos también que sabemos que la calificación de los estudiantes de escuelas urbanas tiende a ser distinta a las calificaciones que los estudiantes de
escuelas rurales o indígenas.</p>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb233-1"><a href="intervalos-de-confianza-y-remuestreo.html#cb233-1"></a>muestra_estrat &lt;-<span class="st"> </span>estudiantes <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb233-2"><a href="intervalos-de-confianza-y-remuestreo.html#cb233-2"></a><span class="st">    </span><span class="kw">group_by</span>(tipo) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb233-3"><a href="intervalos-de-confianza-y-remuestreo.html#cb233-3"></a><span class="st">    </span><span class="kw">sample_frac</span>(<span class="fl">0.0004</span>)</span>
<span id="cb233-4"><a href="intervalos-de-confianza-y-remuestreo.html#cb233-4"></a><span class="kw">dim</span>(muestra_estrat)</span></code></pre></div>
<pre><code>## [1] 60  5</code></pre>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb235-1"><a href="intervalos-de-confianza-y-remuestreo.html#cb235-1"></a>muestrea_estrat &lt;-<span class="st"> </span><span class="cf">function</span>(){</span>
<span id="cb235-2"><a href="intervalos-de-confianza-y-remuestreo.html#cb235-2"></a>    muestra &lt;-<span class="st"> </span>estudiantes <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb235-3"><a href="intervalos-de-confianza-y-remuestreo.html#cb235-3"></a><span class="st">        </span><span class="kw">group_by</span>(tipo) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb235-4"><a href="intervalos-de-confianza-y-remuestreo.html#cb235-4"></a><span class="st">        </span><span class="kw">sample_frac</span>(<span class="fl">0.0004</span>)</span>
<span id="cb235-5"><a href="intervalos-de-confianza-y-remuestreo.html#cb235-5"></a>    <span class="kw">mean</span>(muestra<span class="op">$</span>calif)</span>
<span id="cb235-6"><a href="intervalos-de-confianza-y-remuestreo.html#cb235-6"></a>}</span>
<span id="cb235-7"><a href="intervalos-de-confianza-y-remuestreo.html#cb235-7"></a></span>
<span id="cb235-8"><a href="intervalos-de-confianza-y-remuestreo.html#cb235-8"></a>medias_estrat &lt;-<span class="st"> </span><span class="kw">rerun</span>(<span class="dv">1000</span>, <span class="kw">muestrea_estrat</span>()) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">flatten_dbl</span>()</span>
<span id="cb235-9"><a href="intervalos-de-confianza-y-remuestreo.html#cb235-9"></a><span class="kw">sd</span>(medias_estrat)</span></code></pre></div>
<pre><code>## [1] 10.20239</code></pre>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb237-1"><a href="intervalos-de-confianza-y-remuestreo.html#cb237-1"></a>hist_estrat &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="kw">tibble</span>(medias_estrat), <span class="kw">aes</span>(<span class="dt">x =</span> medias_estrat)) <span class="op">+</span></span>
<span id="cb237-2"><a href="intervalos-de-confianza-y-remuestreo.html#cb237-2"></a><span class="st">    </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="dv">6</span>) <span class="op">+</span></span>
<span id="cb237-3"><a href="intervalos-de-confianza-y-remuestreo.html#cb237-3"></a><span class="st">    </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="kw">mean</span>(estudiantes<span class="op">$</span>calif), <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span></span>
<span id="cb237-4"><a href="intervalos-de-confianza-y-remuestreo.html#cb237-4"></a><span class="st">    </span><span class="kw">xlim</span>(<span class="dv">410</span>, <span class="dv">520</span>)</span>
<span id="cb237-5"><a href="intervalos-de-confianza-y-remuestreo.html#cb237-5"></a>qq_estrat &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="kw">tibble</span>(medias_estrat), <span class="kw">aes</span>(<span class="dt">sample =</span> medias_estrat)) <span class="op">+</span></span>
<span id="cb237-6"><a href="intervalos-de-confianza-y-remuestreo.html#cb237-6"></a><span class="st">    </span><span class="kw">geom_qq</span>(<span class="dt">distribution =</span> stats<span class="op">::</span>qunif) <span class="op">+</span></span>
<span id="cb237-7"><a href="intervalos-de-confianza-y-remuestreo.html#cb237-7"></a><span class="st">    </span><span class="kw">ylim</span>(<span class="dv">410</span>, <span class="dv">520</span>)</span>
<span id="cb237-8"><a href="intervalos-de-confianza-y-remuestreo.html#cb237-8"></a></span>
<span id="cb237-9"><a href="intervalos-de-confianza-y-remuestreo.html#cb237-9"></a>hist_estrat <span class="op">+</span><span class="st"> </span>qq_estrat</span></code></pre></div>
<p><img src="06-remuestreo_files/figure-html/unnamed-chunk-77-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>La estratificación nos sirve para reducir el error estándar de las estimaciones,
por su parte los conglomerados reducen costos. Veamos cuantas escuelas tendría
que visitar en una muestra dada (con diseño estratificado).</p>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb238-1"><a href="intervalos-de-confianza-y-remuestreo.html#cb238-1"></a><span class="kw">n_distinct</span>(muestra_estrat<span class="op">$</span>ind_escuela)</span></code></pre></div>
<pre><code>## [1] 60</code></pre>
<p>Es fácil ver que visitar una escuela para aplicar solo uno o dos exámenes no es
muy eficiente en cuestión de costos. Es por ello que se suelen tomar muestras
considerando los conglomerados naturales, en este caso la escuela. No es difícil
imaginar que una parte grande del costo del muestreo sea mandar al examinador a
la escuela y que una vez ahí examine a todos los alumnos de sexto grado. Podemos
imaginar que considerando estos costos por visita de escuela nos alcance para
visitar 40 escuelas y en cada una examinar a todos los estudiantes.</p>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb240-1"><a href="intervalos-de-confianza-y-remuestreo.html#cb240-1"></a>muestra_escuelas &lt;-<span class="st"> </span>escuela <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb240-2"><a href="intervalos-de-confianza-y-remuestreo.html#cb240-2"></a><span class="st">    </span><span class="kw">group_by</span>(tipo) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb240-3"><a href="intervalos-de-confianza-y-remuestreo.html#cb240-3"></a><span class="st">    </span><span class="kw">sample_frac</span>(<span class="dt">size =</span> <span class="fl">0.008</span>)</span>
<span id="cb240-4"><a href="intervalos-de-confianza-y-remuestreo.html#cb240-4"></a>muestra_cgl &lt;-<span class="st"> </span>muestra_escuelas <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb240-5"><a href="intervalos-de-confianza-y-remuestreo.html#cb240-5"></a><span class="st">    </span><span class="kw">left_join</span>(estudiantes) </span>
<span id="cb240-6"><a href="intervalos-de-confianza-y-remuestreo.html#cb240-6"></a><span class="kw">mean</span>(muestra_cgl<span class="op">$</span>calif)</span></code></pre></div>
<pre><code>## [1] 462.5677</code></pre>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb242-1"><a href="intervalos-de-confianza-y-remuestreo.html#cb242-1"></a>muestrea_cgl &lt;-<span class="st"> </span><span class="cf">function</span>(){</span>
<span id="cb242-2"><a href="intervalos-de-confianza-y-remuestreo.html#cb242-2"></a>    muestra_escuelas &lt;-<span class="st"> </span>escuela <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb242-3"><a href="intervalos-de-confianza-y-remuestreo.html#cb242-3"></a><span class="st">        </span><span class="kw">group_by</span>(tipo) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb242-4"><a href="intervalos-de-confianza-y-remuestreo.html#cb242-4"></a><span class="st">        </span><span class="kw">sample_frac</span>(<span class="dt">size =</span> <span class="fl">0.008</span>)</span>
<span id="cb242-5"><a href="intervalos-de-confianza-y-remuestreo.html#cb242-5"></a>  muestra_cgl &lt;-<span class="st"> </span>muestra_escuelas <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb242-6"><a href="intervalos-de-confianza-y-remuestreo.html#cb242-6"></a><span class="st">      </span><span class="kw">left_join</span>(estudiantes, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;ind_escuela&quot;</span>, <span class="st">&quot;tipo&quot;</span>))</span>
<span id="cb242-7"><a href="intervalos-de-confianza-y-remuestreo.html#cb242-7"></a>  <span class="kw">mean</span>(muestra_cgl<span class="op">$</span>calif)</span>
<span id="cb242-8"><a href="intervalos-de-confianza-y-remuestreo.html#cb242-8"></a>        </span>
<span id="cb242-9"><a href="intervalos-de-confianza-y-remuestreo.html#cb242-9"></a>}</span>
<span id="cb242-10"><a href="intervalos-de-confianza-y-remuestreo.html#cb242-10"></a></span>
<span id="cb242-11"><a href="intervalos-de-confianza-y-remuestreo.html#cb242-11"></a>medias_cgl &lt;-<span class="st"> </span><span class="kw">rerun</span>(<span class="dv">1000</span>, <span class="kw">muestrea_cgl</span>()) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">flatten_dbl</span>()</span>
<span id="cb242-12"><a href="intervalos-de-confianza-y-remuestreo.html#cb242-12"></a><span class="kw">sd</span>(medias_cgl)</span></code></pre></div>
<pre><code>## [1] 5.337327</code></pre>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb244-1"><a href="intervalos-de-confianza-y-remuestreo.html#cb244-1"></a>hist_cgl &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="kw">tibble</span>(medias_cgl), <span class="kw">aes</span>(<span class="dt">x =</span> medias_cgl)) <span class="op">+</span></span>
<span id="cb244-2"><a href="intervalos-de-confianza-y-remuestreo.html#cb244-2"></a><span class="st">    </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="dv">6</span>) <span class="op">+</span></span>
<span id="cb244-3"><a href="intervalos-de-confianza-y-remuestreo.html#cb244-3"></a><span class="st">    </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="kw">mean</span>(estudiantes<span class="op">$</span>calif), <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span></span>
<span id="cb244-4"><a href="intervalos-de-confianza-y-remuestreo.html#cb244-4"></a><span class="st">    </span><span class="kw">xlim</span>(<span class="dv">410</span>, <span class="dv">520</span>)</span>
<span id="cb244-5"><a href="intervalos-de-confianza-y-remuestreo.html#cb244-5"></a>qq_cgl &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="kw">tibble</span>(medias_cgl), <span class="kw">aes</span>(<span class="dt">sample =</span> medias_cgl)) <span class="op">+</span></span>
<span id="cb244-6"><a href="intervalos-de-confianza-y-remuestreo.html#cb244-6"></a><span class="st">    </span><span class="kw">geom_qq</span>(<span class="dt">distribution =</span> stats<span class="op">::</span>qunif) <span class="op">+</span></span>
<span id="cb244-7"><a href="intervalos-de-confianza-y-remuestreo.html#cb244-7"></a><span class="st">    </span><span class="kw">ylim</span>(<span class="dv">410</span>, <span class="dv">520</span>)</span>
<span id="cb244-8"><a href="intervalos-de-confianza-y-remuestreo.html#cb244-8"></a></span>
<span id="cb244-9"><a href="intervalos-de-confianza-y-remuestreo.html#cb244-9"></a>hist_cgl <span class="op">+</span><span class="st"> </span>qq_cgl</span></code></pre></div>
<p><img src="06-remuestreo_files/figure-html/unnamed-chunk-80-1.png" width="672" style="display: block; margin: auto;" /></p>
<div id="ejemplo-enigh" class="section level4 unnumbered">
<h4>Ejemplo: ENIGH</h4>
<p>La complejidad de los diseños de encuestas conlleva a que el cálculo de errores
estándar sea muy complicado, para atacar este problema hay dos técnicas básicas:
1) un enfoque analítico usando linearización, 2) métodos de remuestreo como
bootstrap. El incremento en el poder de cómputo ha favorecido los métodos de
remuestreo pues la linearización requiere del desarrollo de una fórmula para
cada estimación y supuestos adicionales para simplificar.</p>
<p>En 1988 <span class="citation">Rao and Wu (<a href="#ref-RaoWu" role="doc-biblioref">1988</a>)</span> propusieron un método de bootstrap para diseños
estratificados multietápicos con reemplazo de UPMs que describimos a
continuación.</p>
<p><strong>ENIGH</strong>. Usaremos como ejemplo la Encuesta Nacional de Ingresos y
Gastos de los Hogares, ENIGH 2018 <span class="citation">(INEGI <a href="#ref-enigh" role="doc-biblioref">2018</a>)</span>, esta encuesta usa un diseño de
conglomerados estratificado.</p>
<p>Antes de proceder a bootstrap debemos entender como se seleccionaron los datos,
esto es, el <a href="https://www.inegi.org.mx/contenidos/programas/enigh/nc/2018/doc/enigh18_diseno_muestral_ns.pdf">diseño de la muestra</a>:</p>
<ol style="list-style-type: decimal">
<li><p>Unidad primaria de muestreo (UPM). Las UPMs están constituidas por
agrupaciones de viviendas. Se les denomina unidades primarias pues corresponden
a la primera etapa de selección, las unidades secundarias (USMs) serían los
hogares.</p></li>
<li><p>Estratificación. Los estratos se construyen en base a estado, ámbito (urbano,
complemento urbano, rural), características sociodemográficas de los habitantes
de las viviendas, características físicas y equipamiento. El proceso de
estratificación resulta en 888 subestratos en todo el ámbito nacional.</p></li>
<li><p>La selección de la muestra es independiente para cada estrato, y una
vez que se obtiene la muestra se calculan los factores de expansión que
reflejan las distintas probabilidades de selección. Después se llevan a cabo
ajustes por no respuesta y por proyección (calibración), esta última
busca que distintos dominios de la muestra coincidan con la proyección de
población de INEGI.</p></li>
</ol>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb245-1"><a href="intervalos-de-confianza-y-remuestreo.html#cb245-1"></a>concentrado_hogar &lt;-<span class="st"> </span><span class="kw">read_csv</span>(here<span class="op">::</span><span class="kw">here</span>(<span class="st">&quot;data&quot;</span>, </span>
<span id="cb245-2"><a href="intervalos-de-confianza-y-remuestreo.html#cb245-2"></a>    <span class="st">&quot;conjunto_de_datos_enigh_2018_ns_csv&quot;</span>, </span>
<span id="cb245-3"><a href="intervalos-de-confianza-y-remuestreo.html#cb245-3"></a>    <span class="st">&quot;conjunto_de_datos_concentradohogar_enigh_2018_ns&quot;</span>, <span class="st">&quot;conjunto_de_datos&quot;</span>,</span>
<span id="cb245-4"><a href="intervalos-de-confianza-y-remuestreo.html#cb245-4"></a>    <span class="st">&quot;conjunto_de_datos_concentradohogar_enigh_2018_ns.csv&quot;</span>))</span>
<span id="cb245-5"><a href="intervalos-de-confianza-y-remuestreo.html#cb245-5"></a></span>
<span id="cb245-6"><a href="intervalos-de-confianza-y-remuestreo.html#cb245-6"></a><span class="co"># seleccionar variable de ingreso corriente</span></span>
<span id="cb245-7"><a href="intervalos-de-confianza-y-remuestreo.html#cb245-7"></a>hogar &lt;-<span class="st"> </span>concentrado_hogar <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb245-8"><a href="intervalos-de-confianza-y-remuestreo.html#cb245-8"></a><span class="st">    </span><span class="kw">mutate</span>(</span>
<span id="cb245-9"><a href="intervalos-de-confianza-y-remuestreo.html#cb245-9"></a>        <span class="dt">upm =</span> <span class="kw">as.integer</span>(upm),</span>
<span id="cb245-10"><a href="intervalos-de-confianza-y-remuestreo.html#cb245-10"></a>        <span class="dt">jefe_hombre =</span> sexo_jefe <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, </span>
<span id="cb245-11"><a href="intervalos-de-confianza-y-remuestreo.html#cb245-11"></a>        <span class="dt">edo =</span> <span class="kw">str_sub</span>(ubica_geo, <span class="dv">1</span>, <span class="dv">2</span>), </span>
<span id="cb245-12"><a href="intervalos-de-confianza-y-remuestreo.html#cb245-12"></a>        <span class="dt">jefa_50 =</span> (sexo_jefe <span class="op">==</span><span class="st"> </span><span class="dv">2</span>) <span class="op">&amp;</span><span class="st"> </span>(edad_jefe <span class="op">&gt;</span><span class="st"> </span><span class="dv">50</span>)</span>
<span id="cb245-13"><a href="intervalos-de-confianza-y-remuestreo.html#cb245-13"></a>        ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb245-14"><a href="intervalos-de-confianza-y-remuestreo.html#cb245-14"></a><span class="st">    </span><span class="kw">select</span>(folioviv, foliohog, est_dis, upm, factor, ing_cor, sexo_jefe, </span>
<span id="cb245-15"><a href="intervalos-de-confianza-y-remuestreo.html#cb245-15"></a>       edad_jefe, edo, jefa_<span class="dv">50</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb245-16"><a href="intervalos-de-confianza-y-remuestreo.html#cb245-16"></a><span class="st">    </span><span class="kw">group_by</span>(est_dis) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb245-17"><a href="intervalos-de-confianza-y-remuestreo.html#cb245-17"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">n =</span> <span class="kw">n_distinct</span>(upm)) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># número de upms por estrato</span></span>
<span id="cb245-18"><a href="intervalos-de-confianza-y-remuestreo.html#cb245-18"></a><span class="st">    </span><span class="kw">ungroup</span>()</span>
<span id="cb245-19"><a href="intervalos-de-confianza-y-remuestreo.html#cb245-19"></a>hogar</span></code></pre></div>
<pre><code>## # A tibble: 74,647 x 11
##    folioviv foliohog est_dis   upm factor ing_cor sexo_jefe edad_jefe edo  
##       &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;int&gt;  &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;
##  1   1.00e8        1       2     1    175  76404.         1        74 10   
##  2   1.00e8        1       2     1    175  42988.         1        48 10   
##  3   1.00e8        1       2     1    175 580698.         1        39 10   
##  4   1.00e8        1       2     1    175  46253.         2        70 10   
##  5   1.00e8        1       2     1    175  53837.         2        51 10   
##  6   1.00e8        1       2     2    189 237743.         2        41 10   
##  7   1.00e8        1       2     2    189  32607.         2        57 10   
##  8   1.00e8        1       2     2    189 169918.         1        53 10   
##  9   1.00e8        1       2     2    189  17311.         1        30 10   
## 10   1.00e8        1       2     3    186 120488.         1        69 10   
## # … with 74,637 more rows, and 2 more variables: jefa_50 &lt;lgl&gt;, n &lt;int&gt;</code></pre>
<p>Para el cálculo de estadísticos debemos usar los factores de expansión, por
ejemplo el ingreso trimestral total sería:</p>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb247-1"><a href="intervalos-de-confianza-y-remuestreo.html#cb247-1"></a><span class="kw">sum</span>(hogar<span class="op">$</span>factor <span class="op">*</span><span class="st"> </span>hogar<span class="op">$</span>ing_cor <span class="op">/</span><span class="st"> </span><span class="dv">1000</span>)</span></code></pre></div>
<pre><code>## [1] 1723700566</code></pre>
<p>y ingreso trimestral medio (miles pesos)</p>
<div class="sourceCode" id="cb249"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb249-1"><a href="intervalos-de-confianza-y-remuestreo.html#cb249-1"></a><span class="kw">sum</span>(hogar<span class="op">$</span>factor <span class="op">*</span><span class="st"> </span>hogar<span class="op">$</span>ing_cor <span class="op">/</span><span class="st"> </span><span class="dv">1000</span>) <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(hogar<span class="op">$</span>factor)</span></code></pre></div>
<pre><code>## [1] 49.61029</code></pre>
<p>La estimación del error estándar, por otro lado, no es sencilla y requiere
usar aproximaciones, en la metodología de INEGI proponen una aproximación con
series de Taylor.</p>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-84"></span>
<img src="images/inegi_metodologia_razon.png" alt="Extracto de estimación de errores de muestreo, ENIGH 2018." width="700px" />
<p class="caption">
Figure 6.3: Extracto de estimación de errores de muestreo, ENIGH 2018.
</p>
</div>
<p>Veamos ahora como calcular el error estándar siguiendo el bootstrap de Rao y Wu:</p>
<ol style="list-style-type: decimal">
<li>En cada estrato se seleccionan con reemplazo <span class="math inline">\(m_h\)</span> UPMs de las <span class="math inline">\(n_h\)</span> de la
muestra original. Denotamos por <span class="math inline">\(m_{hi}^*\)</span> el número de veces que se seleccionó
la UPM <span class="math inline">\(i\)</span> en el estrato <span class="math inline">\(h\)</span> (de tal manera que <span class="math inline">\(\sum m_{hi}^*=m_h\)</span>). Creamos
una replicación del ponderador correspondiente a la <span class="math inline">\(k\)</span>-ésima unidad (USM) como:</li>
</ol>
<p><span class="math display">\[d_k^*=d_k \bigg[\bigg(1-\sqrt{\frac{m_h}{n_h - 1}}\bigg) + 
\bigg(\sqrt{\frac{m_h}{n_h - 1}}\frac{n_h}{m_h}m_{h}^*\bigg)\bigg]\]</span></p>
<p>donde <span class="math inline">\(d_k\)</span> es el inverso de la probabilidad de selección. Si <span class="math inline">\(m_h&lt;(n_h -1)\)</span>
todos los pesos definidos de esta manera serán no negativos. Calculamos el
peso final <span class="math inline">\(w_k^*\)</span> aplicando a <span class="math inline">\(d_k^*\)</span> los mismos ajustes que se hicieron a los
ponderadores originales.</p>
<ol start="2" style="list-style-type: decimal">
<li><p>Calculamos el estadístico de interés <span class="math inline">\(\hat{\theta}\)</span> usando los ponderadores
<span class="math inline">\(w_k^*\)</span> en lugar de los originales <span class="math inline">\(w_k\)</span>.</p></li>
<li><p>Repetimos los pasos 1 y 2 <span class="math inline">\(B\)</span> veces para obtener <span class="math inline">\(\hat{\theta}^{*1},\hat{\theta}^{*2},...,\hat{\theta}^{*B}\)</span>.</p></li>
<li><p>Calculamos el error estándar como:</p></li>
</ol>
<p><span class="math display">\[\hat{\textsf{se}}_B = \bigg\{\frac{\sum_{b=1}^B[\hat{\theta}^*(b)-\hat{\theta}^*(\cdot)]^2 }{B}\bigg\}^{1/2}\]</span></p>
<p>Podemos elegir cualquier valor de <span class="math inline">\(m_h \geq 1\)</span>, el más sencillo es elegir
<span class="math inline">\(m_h=n_h-1\)</span>, en este caso:
<span class="math display">\[d_k^*=d_k \frac{n_h}{n_h-1}m_{hi}^*\]</span>
en este escenario las unidades que no se incluyen en la muestra tienen
un valor de cero como ponderador. Si elegimos <span class="math inline">\(n_h \ne n_h-1\)</span> las unidades que
no están en la muestra tienen ponderador distinto a cero, si <span class="math inline">\(m_h=n_h\)</span> el
ponderador podría tomar valores negativos.</p>
<p>Implementemos el bootstrap de Rao y Wu a la ENIGH, usaremos <span class="math inline">\(m_h=n_h-1\)</span></p>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb251-1"><a href="intervalos-de-confianza-y-remuestreo.html#cb251-1"></a><span class="co"># creamos una tabla con los estratos y upms</span></span>
<span id="cb251-2"><a href="intervalos-de-confianza-y-remuestreo.html#cb251-2"></a>est_upm &lt;-<span class="st"> </span>hogar <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb251-3"><a href="intervalos-de-confianza-y-remuestreo.html#cb251-3"></a><span class="st">    </span><span class="kw">distinct</span>(est_dis, upm, n)</span>
<span id="cb251-4"><a href="intervalos-de-confianza-y-remuestreo.html#cb251-4"></a></span>
<span id="cb251-5"><a href="intervalos-de-confianza-y-remuestreo.html#cb251-5"></a>hogar_factor &lt;-<span class="st"> </span>est_upm <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb251-6"><a href="intervalos-de-confianza-y-remuestreo.html#cb251-6"></a><span class="st">    </span><span class="kw">group_by</span>(est_dis) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># dentro de cada estrato tomamos muestra (n_h-1)</span></span>
<span id="cb251-7"><a href="intervalos-de-confianza-y-remuestreo.html#cb251-7"></a><span class="st">    </span><span class="kw">sample_n</span>(<span class="dt">size =</span> <span class="kw">first</span>(n) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb251-8"><a href="intervalos-de-confianza-y-remuestreo.html#cb251-8"></a><span class="st">    </span><span class="kw">add_count</span>(est_dis, upm, <span class="dt">name =</span> <span class="st">&quot;m_hi&quot;</span>, <span class="dt">wt =</span> <span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># calculamos m_hi*</span></span>
<span id="cb251-9"><a href="intervalos-de-confianza-y-remuestreo.html#cb251-9"></a><span class="st">    </span><span class="kw">left_join</span>(hogar, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;est_dis&quot;</span>, <span class="st">&quot;upm&quot;</span>, <span class="st">&quot;n&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb251-10"><a href="intervalos-de-confianza-y-remuestreo.html#cb251-10"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">factor_b =</span> factor <span class="op">*</span><span class="st"> </span>m_hi <span class="op">*</span><span class="st"> </span>n <span class="op">/</span><span class="st"> </span>(n <span class="op">-</span><span class="st"> </span><span class="dv">1</span>))</span>
<span id="cb251-11"><a href="intervalos-de-confianza-y-remuestreo.html#cb251-11"></a></span>
<span id="cb251-12"><a href="intervalos-de-confianza-y-remuestreo.html#cb251-12"></a><span class="co"># unimos los pasos anteriores en una función para replicar en cada muestra bootstrap</span></span>
<span id="cb251-13"><a href="intervalos-de-confianza-y-remuestreo.html#cb251-13"></a>svy_boot &lt;-<span class="st"> </span><span class="cf">function</span>(est_upm, hogar){</span>
<span id="cb251-14"><a href="intervalos-de-confianza-y-remuestreo.html#cb251-14"></a>    m_hi &lt;-<span class="st"> </span>est_upm <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb251-15"><a href="intervalos-de-confianza-y-remuestreo.html#cb251-15"></a><span class="st">        </span><span class="kw">split</span>(.<span class="op">$</span>est_dis) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb251-16"><a href="intervalos-de-confianza-y-remuestreo.html#cb251-16"></a><span class="st">        </span><span class="kw">map</span>(<span class="op">~</span><span class="kw">sample</span>(.<span class="op">$</span>upm, <span class="dt">size =</span> <span class="kw">first</span>(.<span class="op">$</span>n) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb251-17"><a href="intervalos-de-confianza-y-remuestreo.html#cb251-17"></a><span class="st">        </span><span class="kw">flatten_int</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb251-18"><a href="intervalos-de-confianza-y-remuestreo.html#cb251-18"></a><span class="st">        </span>plyr<span class="op">::</span><span class="kw">count</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb251-19"><a href="intervalos-de-confianza-y-remuestreo.html#cb251-19"></a><span class="st">        </span><span class="kw">select</span>(<span class="dt">upm =</span> x, <span class="dt">m_h =</span> freq)</span>
<span id="cb251-20"><a href="intervalos-de-confianza-y-remuestreo.html#cb251-20"></a>    m_hi <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb251-21"><a href="intervalos-de-confianza-y-remuestreo.html#cb251-21"></a><span class="st">        </span><span class="kw">left_join</span>(hogar, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;upm&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb251-22"><a href="intervalos-de-confianza-y-remuestreo.html#cb251-22"></a><span class="st">        </span><span class="kw">mutate</span>(<span class="dt">factor_b =</span> factor <span class="op">*</span><span class="st"> </span>m_h <span class="op">*</span><span class="st"> </span>n <span class="op">/</span><span class="st"> </span>(n <span class="op">-</span><span class="st"> </span><span class="dv">1</span>))</span>
<span id="cb251-23"><a href="intervalos-de-confianza-y-remuestreo.html#cb251-23"></a>}</span>
<span id="cb251-24"><a href="intervalos-de-confianza-y-remuestreo.html#cb251-24"></a><span class="kw">set.seed</span>(<span class="dv">1038984</span>)</span>
<span id="cb251-25"><a href="intervalos-de-confianza-y-remuestreo.html#cb251-25"></a>boot_rep &lt;-<span class="st"> </span><span class="kw">rerun</span>(<span class="dv">500</span>, <span class="kw">svy_boot</span>(est_upm, hogar))</span>
<span id="cb251-26"><a href="intervalos-de-confianza-y-remuestreo.html#cb251-26"></a></span>
<span id="cb251-27"><a href="intervalos-de-confianza-y-remuestreo.html#cb251-27"></a><span class="co"># Aplicación a ingreso medio</span></span>
<span id="cb251-28"><a href="intervalos-de-confianza-y-remuestreo.html#cb251-28"></a>wtd_mean &lt;-<span class="st"> </span><span class="cf">function</span>(w, x, <span class="dt">na.rm =</span> <span class="ot">FALSE</span>) {</span>
<span id="cb251-29"><a href="intervalos-de-confianza-y-remuestreo.html#cb251-29"></a>    <span class="kw">sum</span>(w <span class="op">*</span><span class="st"> </span>x, <span class="dt">na.rm =</span> na.rm) <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(w, <span class="dt">na.rm =</span> na.rm)</span>
<span id="cb251-30"><a href="intervalos-de-confianza-y-remuestreo.html#cb251-30"></a>} </span>
<span id="cb251-31"><a href="intervalos-de-confianza-y-remuestreo.html#cb251-31"></a></span>
<span id="cb251-32"><a href="intervalos-de-confianza-y-remuestreo.html#cb251-32"></a><span class="co"># La media es:</span></span>
<span id="cb251-33"><a href="intervalos-de-confianza-y-remuestreo.html#cb251-33"></a>hogar <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb251-34"><a href="intervalos-de-confianza-y-remuestreo.html#cb251-34"></a><span class="st">    </span><span class="kw">summarise</span>(<span class="dt">media =</span> <span class="kw">wtd_mean</span>(factor, ing_cor))</span></code></pre></div>
<pre><code>## # A tibble: 1 x 1
##    media
##    &lt;dbl&gt;
## 1 49610.</code></pre>
<p>Y el error estándar:</p>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb253-1"><a href="intervalos-de-confianza-y-remuestreo.html#cb253-1"></a><span class="kw">map_dbl</span>(boot_rep, <span class="op">~</span><span class="kw">wtd_mean</span>(<span class="dt">w =</span> .<span class="op">$</span>factor_b, <span class="dt">x =</span> .<span class="op">$</span>ing_cor)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb253-2"><a href="intervalos-de-confianza-y-remuestreo.html#cb253-2"></a><span class="st">  </span><span class="kw">sd</span>()</span></code></pre></div>
<pre><code>## [1] 441.0439</code></pre>
<p>El método bootstrap está implementado en el paquete <code>survey</code> y más recientemente
en <code>srvyr</code> que es una versión <em>tidy</em> que utiliza las funciones en <code>survey</code>.</p>
<p>Podemos comparar nuestros resultados con la implementación en <code>survey</code>.</p>
<div class="sourceCode" id="cb255"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb255-1"><a href="intervalos-de-confianza-y-remuestreo.html#cb255-1"></a><span class="co"># 1. Definimos el diseño de la encuesta</span></span>
<span id="cb255-2"><a href="intervalos-de-confianza-y-remuestreo.html#cb255-2"></a><span class="kw">library</span>(survey)</span>
<span id="cb255-3"><a href="intervalos-de-confianza-y-remuestreo.html#cb255-3"></a><span class="kw">library</span>(srvyr)</span>
<span id="cb255-4"><a href="intervalos-de-confianza-y-remuestreo.html#cb255-4"></a></span>
<span id="cb255-5"><a href="intervalos-de-confianza-y-remuestreo.html#cb255-5"></a>enigh_design &lt;-<span class="st"> </span>hogar <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb255-6"><a href="intervalos-de-confianza-y-remuestreo.html#cb255-6"></a><span class="st">    </span><span class="kw">as_survey_design</span>(<span class="dt">ids =</span> upm, <span class="dt">weights =</span> factor, <span class="dt">strata =</span> est_dis)</span>
<span id="cb255-7"><a href="intervalos-de-confianza-y-remuestreo.html#cb255-7"></a></span>
<span id="cb255-8"><a href="intervalos-de-confianza-y-remuestreo.html#cb255-8"></a><span class="co"># 2. Elegimos bootstrap como el método para el cálculo de errores estándar</span></span>
<span id="cb255-9"><a href="intervalos-de-confianza-y-remuestreo.html#cb255-9"></a><span class="kw">set.seed</span>(<span class="dv">7398731</span>)</span>
<span id="cb255-10"><a href="intervalos-de-confianza-y-remuestreo.html#cb255-10"></a>enigh_boot &lt;-<span class="st"> </span>enigh_design <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb255-11"><a href="intervalos-de-confianza-y-remuestreo.html#cb255-11"></a><span class="st">    </span><span class="kw">as_survey_rep</span>(<span class="dt">type =</span> <span class="st">&quot;subbootstrap&quot;</span>, <span class="dt">replicates =</span> <span class="dv">500</span>)</span>
<span id="cb255-12"><a href="intervalos-de-confianza-y-remuestreo.html#cb255-12"></a></span>
<span id="cb255-13"><a href="intervalos-de-confianza-y-remuestreo.html#cb255-13"></a><span class="co"># 3. Así calculamos la media</span></span>
<span id="cb255-14"><a href="intervalos-de-confianza-y-remuestreo.html#cb255-14"></a>enigh_boot <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb255-15"><a href="intervalos-de-confianza-y-remuestreo.html#cb255-15"></a><span class="st">    </span>srvyr<span class="op">::</span><span class="kw">summarise</span>(<span class="dt">mean_ingcor =</span> <span class="kw">survey_mean</span>(ing_cor))</span></code></pre></div>
<pre><code>## # A tibble: 1 x 2
##   mean_ingcor mean_ingcor_se
##         &lt;dbl&gt;          &lt;dbl&gt;
## 1      49610.           459.</code></pre>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb257-1"><a href="intervalos-de-confianza-y-remuestreo.html#cb257-1"></a>enigh_boot <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb257-2"><a href="intervalos-de-confianza-y-remuestreo.html#cb257-2"></a><span class="st">    </span><span class="kw">group_by</span>(edo) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb257-3"><a href="intervalos-de-confianza-y-remuestreo.html#cb257-3"></a><span class="st">    </span>srvyr<span class="op">::</span><span class="kw">summarise</span>(<span class="dt">mean_ingcor =</span> <span class="kw">survey_mean</span>(ing_cor)) </span></code></pre></div>
<pre><code>## # A tibble: 30 x 3
##    edo   mean_ingcor mean_ingcor_se
##    &lt;chr&gt;       &lt;dbl&gt;          &lt;dbl&gt;
##  1 10         50161.           942.
##  2 11         46142.          1252.
##  3 12         29334.          1067.
##  4 13         38783.           933.
##  5 14         60541.          1873.
##  6 15         48013.          1245.
##  7 16         42653.          1239.
##  8 17         42973.          1675.
##  9 18         48148.          1822.
## 10 19         68959.          3625.
## # … with 20 more rows</code></pre>
<p>Resumiendo:</p>
<ul>
<li><p>El bootstrap de Rao y Wu genera un estimador consistente y aproximadamente
insesgado de la varianza de estadísticos no lineales y para la varianza de un
cuantil.</p></li>
<li><p>Este método supone que la seleccion de UPMs es con reemplazo; hay variaciones
del estimador bootstrap de Rao y Wu que extienden el método que acabamos de
estudiar; sin embargo, es común ignorar este aspecto,
por ejemplo <a href="https://fcsm.sites.usa.gov/files/2014/05/2005FCSM_Mach_Dumais_Robidou_VA.pdf">Mach et al</a> estudian las propiedades del estimador de varianza bootstrap de Rao y Wu cuando
la muestra se seleccionó sin reemplazo.</p></li>
</ul>
</div>
</div>
<div id="conclusiones-y-observaciones" class="section level2 unnumbered">
<h2>Conclusiones y observaciones</h2>
<ul>
<li><p>El principio fundamental del Bootstrap no paramétrico es que podemos estimar
la distribución poblacional con la distribución empírica. Por tanto para
hacer inferencia tomamos muestras con reemplazo de la muestra y
analizamos la variación de la estadística de interés a lo largo de las
remuestras.</p></li>
<li><p>El bootstrap nos da la posibilidad de crear intervalos de confianza
cuando no contamos con fórmulas para hacerlo de manera analítica y sin
supuestos distribucionales de la población.</p></li>
<li><p>Hay muchas opciones para construir intervalos bootstrap, los que tienen
mejores propiedades son los intervalos <span class="math inline">\(BC_a\)</span>, sin embargo los más comunes son
los intervalos normales con error estándar bootstrap y los intervalos de
percentiles de la distribución bootstrap.</p></li>
<li><p>Antes de hacer intervalos normales vale la pena
graficar la distribución bootstrap y evaluar si el supuesto de normalidad es
razonable. Así como evaluar el sesgo relativo.</p></li>
<li><p>En cuanto al número de muestras bootstrap se recomienda al menos <span class="math inline">\(1,000\)</span>
al hacer pruebas, y <span class="math inline">\(10,000\)</span> o <span class="math inline">\(15,000\)</span> para los resultados finales, sobre
todo cuando se hacen intervalos de confianza de percentiles.</p></li>
<li><p>La función de distribución empírica es una mala estimación en las colas de
las distribuciones, por lo que es difícil construir intervalos de confianza
(usando bootstrap no paramétrico) para estadísticas que dependen mucho de las
colas. O en general para estadísticas que dependen de un número chico de
observaciones de una muestra grande.</p></li>
</ul>

</div>
</div>
<h3>Referencias</h3>
<div id="refs" class="references">
<div id="ref-Chihara">
<p>Chihara, Laura M., and Tim C. Hesterberg. 2018. <em>Mathematical Statistics with Resampling and R</em>. 2nd ed. Hoboken, NJ: John Wiley &amp; Sons. <a href="https://sites.google.com/site/chiharahesterberg/home">https://sites.google.com/site/chiharahesterberg/home</a>.</p>
</div>
<div id="ref-Efron">
<p>Efron, Bradley, and Robert J. Tibshirani. 1993. <em>An Introduction to the Bootstrap</em>. Monographs on Statistics and Applied Probability 57. Boca Raton, Florida, USA: Chapman &amp; Hall/CRC.</p>
</div>
<div id="ref-enigh">
<p>INEGI. 2018. “Encuesta Nacional de Ingresos Y Gastos de Los Hogares (Enigh-2018). Diseño Muestral.” <a href="http://internet.contenidos.inegi.org.mx/contenidos/Productos/prod_serv/contenidos/espanol/bvinegi/productos/nueva_estruc/702825070359.pdf">http://internet.contenidos.inegi.org.mx/contenidos/Productos/prod_serv/contenidos/espanol/bvinegi/productos/nueva_estruc/702825070359.pdf</a>.</p>
</div>
<div id="ref-RaoWu">
<p>Rao, J. N. K., and C. F. J. Wu. 1988. “Resampling Inference with Complex Survey Data.” <em>Journal of the American Statistical Association</em> 83 (401): 231–41. <a href="https://doi.org/10.1080/01621459.1988.10478591">https://doi.org/10.1080/01621459.1988.10478591</a>.</p>
</div>
<div id="ref-Wasserman">
<p>Wasserman, Larry. 2013. <em>All of Statistics: A Concise Course in Statistical Inference</em>. Springer Science &amp; Business Media.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="S-distribucion-muestreo.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="S-max-verosimilitud.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/tereom/fundamentos/edit/master/06-remuestreo.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["fundamentos-estadistica.pdf"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
